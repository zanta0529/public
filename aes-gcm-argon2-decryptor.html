<!DOCTYPE html><html lang="zh-TW"><head><meta charset="UTF-8"><meta name="viewport"content="width=device-width, initial-scale=1.0"><title>AES-GCM(Argon2id)</title><script
src="https://cdn.jsdelivr.net/npm/argon2-browser@1.18.0/dist/argon2-bundled.min.js"
onerror="this.remove(); document.getElementById('backup-argon2-script').style.display='block';"></script><script
id="backup-argon2-script"
style="display: none"
src="https://unpkg.com/argon2-browser@1.18.0/dist/argon2-bundled.min.js"></script><style>body{font-family:sans-serif;background:#667eea;display:flex;align-items:center;justify-content:center;height:100vh;margin:0}*{box-sizing:border-box}.c{background:#fff;padding:20px;border-radius:10px;width:100%;max-width:800px}.h{text-align:center;margin-bottom:15px}.g{margin-bottom:10px}
label{display:block;margin-bottom:5px;font-weight:600}
textarea,input{width:100%;padding:8px;border:1px solid#ccc;border-radius:5px;font-family:monospace;font-size:12px}
textarea{min-height:70px}
button{width:100%;padding:10px;margin-top:10px;border:none;border-radius:5px;background:#667eea;color:#fff;font-size:16px;cursor:pointer}
button:hover{opacity:.9}.r{margin-top:15px}.rb{background:#f8f9fa;border:1px solid#ccc;border-radius:5px;padding:10px;word-wrap:break-word;max-height:200px;overflow:auto}.success{border-color:#28a745;background:#d4edda;color:#155724}.error{border-color:#dc3545;background:#f8d7da;color:#721c24}.status{padding:5px;border-radius:5px;margin-bottom:10px;font-weight:600}.loading{animation:pulse 1.5s infinite}@keyframes pulse{0%,100%{opacity:1}
50%{opacity:.5}}.star{color:red;}</style></head><body><div class="c"><div class="h"><h1>🔓 AES-GCM(<span class="star">Argon2id</span>)</h1></div><div class="g"><label for="ct">加密資料：</label><textarea id="ct"placeholder="加密資料..."rows="10"></textarea></div><div class="g"><label for="pw">密碼短語：</label><input id="pw"type="password"placeholder="密碼..."></div><button onclick="dec()">解密</button><div class="r"><div id="st"></div><div id="rs"></div></div></div><script>function st(m,t){let d=document.getElementById('st');d.className='status '+t;d.textContent=m;}
function rs(c,t){let d=document.getElementById('rs');d.className='rb '+t;d.textContent=c;}
function b64d(s){s=s.replace(/-/g,'+').replace(/_/g,'/');let b=atob(s),u=new Uint8Array(b.length);for(let i=0;i<b.length;i++)u[i]=b.charCodeAt(i);return u;}
function buildAad(p){const a={version:p.version,keyDerivation:{name:p.keyDerivation.name,iterations:p.keyDerivation.iterations,memory:p.keyDerivation.memory,parallelism:p.keyDerivation.parallelism},encryptionName:p.encryption.name};const cleanObj=JSON.parse(JSON.stringify(a));return new TextEncoder().encode(JSON.stringify(cleanObj));}
async function kdf(passphrase,salt,iterations,memory,parallelism){const result=await argon2.hash({pass:passphrase,salt:salt,time:iterations,mem:memory,parallelism:parallelism,hashLen:32,type:argon2.ArgonType.Argon2id});return result.hash;}
async function gcm(key,iv,ciphertext,tag,aad){const cryptoKey=await crypto.subtle.importKey('raw',key,{name:'AES-GCM'},false,['decrypt']);const combinedCiphertext=new Uint8Array(ciphertext.length+tag.length);combinedCiphertext.set(ciphertext);combinedCiphertext.set(tag,ciphertext.length);return await crypto.subtle.decrypt({name:'AES-GCM',iv:iv,additionalData:aad,tagLength:128},cryptoKey,combinedCiphertext);}
async function dec(){const c=document.getElementById('ct').value.trim();const pw=document.getElementById('pw').value;rs('','');if(!c)return st('請輸入加密資料','error');if(!pw)return st('請輸入密碼短語','error');st('解碼中...','loading');try{const decoded=b64d(c);const p=JSON.parse(new TextDecoder().decode(decoded));if(p.keyDerivation.name!=='Argon2id'||p.encryption.name!=='AES-GCM'){return st('解密失敗: 不支援的演算法 (僅支援 Argon2id + AES-GCM)','error');}
const salt=b64d(p.keyDerivation.salt);const iterations=p.keyDerivation.iterations;const memory=p.keyDerivation.memory;const parallelism=p.keyDerivation.parallelism;const iv=b64d(p.encryption.iv);const ct=b64d(p.encryption.ciphertext);const tag=b64d(p.encryption.tag);const key=await kdf(pw,salt,iterations,memory,parallelism);const aad=buildAad(p);let decrypted;try{decrypted=await gcm(key,iv,ct,tag,aad);}catch(e){if(p.version!==2){try{decrypted=await gcm(key,iv,ct,tag,new Uint8Array(0));}catch(e2){throw new Error('密碼錯誤或加密資料已損毀');}}else{throw new Error('密碼錯誤或加密資料已損毀');}}
const plaintext=new TextDecoder().decode(decrypted);st('解密成功！','success');rs(plaintext,'success');}catch(e){st('解密失敗: '+e.message,'error');}}</script></body></html>