import{c as B,r as o,j as e,z as a,a as I}from"./index-DpD5LOw_.js";import{c as H}from"./cardService-Dr3V7M-O.js";const K=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],N=B("pen-tool",K);const O=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],$=B("search",O);function G({isOpen:A,onClose:j,onSuccess:W}){const[s,p]=o.useState("context"),[r,u]=o.useState(""),[v,h]=o.useState(""),[c,g]=o.useState(""),[b,x]=o.useState(""),[C,m]=o.useState(""),[S,y]=o.useState([]),[i,k]=o.useState(!1),[w,D]=o.useState(!1),[E,T]=o.useState(""),P=o.useRef(null);if(!A)return null;const f=n=>{const l=n.target.selectionStart,_=n.target.selectionEnd,R=n.target.value.substring(l,_).trim();R&&(u(R),x(n.target.value))},z=async()=>{if(!r.trim()){a.error("Please enter or select a word first");return}if(!I.hasKey()){a.error("Please set your API Key in Settings first");return}k(!0);const n=a.loading(`Asking Gemini about "${r}"...`);try{const l=await I.generateCardDetails(r);h(l.ipa||""),g(l.definition||""),x(l.context||b),m(l.translation||""),y(l.collocations||[]),a.success("Auto-filled!",{id:n}),s==="context"&&p("manual")}catch(l){console.error(l),a.error(l.message,{id:n})}finally{k(!1),setTimeout(()=>a.dismiss(n),3e3)}},L=async()=>{if(!r||!c){a.error("Word and Definition are required");return}try{await H.addCard({word:r,ipa:v,definition:c,context:b,translation:C,collocations:S,sourceType:s==="context"?"raw_sentence":"word_only"},{smartDeduplication:w}),a.success(`Added "${r}"`),u(""),h(""),g(""),x(""),m(""),y([]),T(""),W(),j()}catch(n){console.error(n),a.error(n.message)}},F=n=>{y(n.target.value.split(","))},d=i||!r||!c;return e.jsx("div",{style:t.overlay,children:e.jsxs("div",{style:t.modal,children:[e.jsxs("div",{style:t.header,children:[e.jsx("h2",{style:{margin:0,color:"#fff"},children:"Add New Card"}),e.jsxs("div",{style:t.tabContainer,children:[e.jsxs("button",{style:s==="context"?t.activeTab:t.tab,onClick:()=>p("context"),children:[e.jsx($,{size:16,style:{marginRight:6}})," Context First"]}),e.jsxs("button",{style:s==="manual"?t.activeTab:t.tab,onClick:()=>p("manual"),children:[e.jsx(N,{size:16,style:{marginRight:6}})," Manual / Edit"]})]})]}),s==="context"&&e.jsxs("div",{style:t.tabContent,children:[e.jsx("div",{style:t.infoBox,children:e.jsxs("p",{style:{margin:0},children:["Paste the full sentence, then ",e.jsx("strong",{children:"highlight"})," the word you want to learn."]})}),e.jsxs("div",{style:t.field,children:[e.jsx("label",{style:t.label,children:"Source Sentence / Podcast Transcript"}),e.jsx("textarea",{ref:P,style:{...t.input,height:"120px",resize:"vertical"},value:E,onChange:n=>T(n.target.value),onSelect:f,onTouchEnd:f,onKeyUp:f,placeholder:"e.g., The government is reluctant to change the law...",autoFocus:!0})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:"1rem",gap:"1rem"},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("label",{style:t.label,children:"Target Word"}),e.jsx("div",{style:t.readOnlyField,children:r||e.jsx("span",{style:{color:"#555",fontStyle:"italic"},children:"Highlight text..."})})]}),e.jsx("button",{onClick:z,disabled:i||!r,style:{...t.magicBtn,opacity:!r||i?.5:1,cursor:!r||i?"not-allowed":"pointer"},children:i?"Processing...":"✨ Analyze"})]})]}),s==="manual"&&e.jsxs("div",{style:t.tabContent,children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:e.jsx("button",{onClick:z,disabled:i,style:t.magicBtn,title:"Regenerate",children:i?"✨...":"✨ Auto-fill by Word"})}),e.jsxs("div",{style:t.field,children:[e.jsx("label",{style:t.label,children:"Word"}),e.jsx("input",{style:t.input,value:r,onChange:n=>u(n.target.value),placeholder:"e.g. Serendipity"})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{style:{...t.field,flex:1},children:[e.jsx("label",{style:t.label,children:"IPA"}),e.jsx("input",{style:t.input,value:v,onChange:n=>h(n.target.value)})]}),e.jsxs("div",{style:{...t.field,flex:1},children:[e.jsx("label",{style:t.label,children:"Translation"}),e.jsx("input",{style:t.input,value:C,onChange:n=>m(n.target.value)})]})]}),e.jsxs("div",{style:t.field,children:[e.jsx("label",{style:t.label,children:"Definition"}),e.jsx("textarea",{style:{...t.input,height:"60px"},value:c,onChange:n=>g(n.target.value)})]}),e.jsxs("div",{style:t.field,children:[e.jsx("label",{style:t.label,children:"Context / Example"}),e.jsx("textarea",{style:{...t.input,height:"60px"},value:b,onChange:n=>x(n.target.value)})]}),e.jsxs("div",{style:t.field,children:[e.jsx("label",{style:t.label,children:"Collocations"}),e.jsx("input",{style:t.input,value:S.join(", "),onChange:F,placeholder:"e.g. reluctant to, deeply reluctant"})]})]}),e.jsx("div",{style:{marginTop:"1.5rem",marginBottom:"0.5rem"},children:e.jsxs("label",{style:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:w,onChange:n=>D(n.target.checked),style:t.checkbox}),e.jsxs("div",{style:t.checkboxText,children:[e.jsx("span",{style:{color:"#e0e0e0",fontWeight:"500",fontSize:"0.9rem"},children:"Enable AI Smart Deduplication"}),e.jsx("span",{style:{color:"#888",fontSize:"0.8rem"},children:"Prevent adding synonyms or same meanings using AI check (Slower)."})]})]})}),e.jsxs("div",{style:t.actions,children:[e.jsx("button",{onClick:j,style:{...t.btn,backgroundColor:"#555"},children:"Cancel"}),e.jsx("button",{onClick:L,disabled:d,style:{...t.btn,backgroundColor:d?"#444":"#2196f3",color:d?"#888":"white",cursor:d?"not-allowed":"pointer",opacity:d?.7:1},children:"Save Card"})]})]})})}const t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},modal:{backgroundColor:"#2c2e33",padding:"1.5rem",borderRadius:"12px",width:"95%",maxWidth:"550px",boxShadow:"0 10px 25px rgba(0,0,0,0.5)",maxHeight:"90vh",overflowY:"auto"},header:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem",borderBottom:"1px solid #444",paddingBottom:"1rem"},tabContainer:{display:"flex",gap:"0.5rem",backgroundColor:"#1a1b1e",padding:"4px",borderRadius:"8px",width:"100%"},tab:{flex:1,padding:"8px 12px",backgroundColor:"transparent",border:"none",color:"#888",cursor:"pointer",borderRadius:"6px",fontSize:"0.9rem",display:"flex",alignItems:"center",justifyContent:"center"},activeTab:{flex:1,padding:"8px 12px",backgroundColor:"#2196f3",border:"none",color:"white",cursor:"pointer",borderRadius:"6px",fontSize:"0.9rem",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center"},infoBox:{backgroundColor:"rgba(33, 150, 243, 0.1)",border:"1px solid #2196f3",borderRadius:"6px",padding:"0.8rem",color:"#90caf9",fontSize:"0.9rem",marginBottom:"1rem"},field:{marginBottom:"1rem"},label:{display:"block",color:"#aaa",fontSize:"0.85rem",marginBottom:"0.3rem"},input:{width:"100%",padding:"0.8rem",borderRadius:"4px",border:"1px solid #444",backgroundColor:"#1a1b1e",color:"#fff",fontSize:"1rem",boxSizing:"border-box",fontFamily:"inherit"},readOnlyField:{padding:"0.8rem",borderRadius:"4px",backgroundColor:"#25262b",border:"1px dashed #444",color:"#e91e63",fontWeight:"bold",minHeight:"45px",display:"flex",alignItems:"center",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},magicBtn:{padding:"0.8rem 1.2rem",backgroundColor:"transparent",border:"1px solid #e91e63",borderRadius:"30px",color:"#e91e63",cursor:"pointer",fontSize:"0.9rem",transition:"all 0.2s",fontWeight:"bold",whiteSpace:"nowrap"},actions:{display:"flex",justifyContent:"flex-end",gap:"1rem",marginTop:"1.5rem"},btn:{padding:"0.8rem 1.5rem",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"bold",fontSize:"1rem"},checkboxLabel:{display:"flex",alignItems:"flex-start",cursor:"pointer",gap:"0.8rem",backgroundColor:"rgba(0,0,0,0.15)",padding:"0.8rem",borderRadius:"8px",border:"1px solid #333"},checkbox:{marginTop:"0.2rem",width:"16px",height:"16px",cursor:"pointer",accentColor:"#6366f1"},checkboxText:{display:"flex",flexDirection:"column",gap:"0.2rem"}};export{G as default};
