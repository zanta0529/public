import{r as l,z as n,j as t}from"./index-NJdXh73y.js";import{c as u}from"./cardService-DC6pRXZU.js";function T({isOpen:m,onClose:k}){const[a,C]=l.useState([]),[d,p]=l.useState(null),[s,h]=l.useState(!1),[x,b]=l.useState(0),w=l.useRef(null),[g,S]=l.useState(!1),[f,j]=l.useState(!1),[i,c]=l.useState(null);l.useEffect(()=>{m&&(y(),h(!1),b(0),p(null),c(null),S(!1))},[m]),l.useEffect(()=>(s&&x>0?w.current=setTimeout(()=>{b(e=>e-1)},1e3):s&&x===0&&h(!1),()=>clearTimeout(w.current)),[s,x]);const y=async()=>{try{const e=await u.getAllCards();e.sort((r,R)=>R.updatedAt-r.updatedAt),C(e)}catch(e){console.error(e),n.error("Failed to load cards")}},v=async e=>{if(d!==e){p(e),setTimeout(()=>{p(r=>r===e?null:r)},3e3);return}try{await u.deleteCard(e),n.success("Card deleted"),p(null),y(),c(null)}catch(r){console.error(r),n.error("Delete failed")}},D=async()=>{if(!s){h(!0),b(3);return}try{await u.clearAllCards(),n.success("All data cleared"),C([]),h(!1),c(null)}catch(e){console.error(e),n.error("Clear failed")}},I=async()=>{j(!0),c(null);const e=n.loading(g?"AI Scanning... (This may take a while)":"Scanning for duplicates...");try{const r=await u.scanForDuplicates({smartDeduplication:g});r.length===0?n.success("No duplicates found!",{id:e}):(n.success(`Found ${r.length} duplicates.`,{id:e}),c({count:r.length,ids:r}))}catch(r){console.error(r),n.error("Scan failed: "+r.message,{id:e})}finally{j(!1)}},B=async()=>{if(!i||i.count===0)return;const e=n.loading("Cleaning up...");try{await u.bulkDeleteCards(i.ids),n.success(`Deleted ${i.count} duplicate cards.`,{id:e}),c(null),y()}catch(r){console.error(r),n.error("Cleanup failed",{id:e})}};return m?t.jsx("div",{style:o.overlay,children:t.jsxs("div",{style:o.modal,children:[t.jsxs("div",{style:o.header,children:[t.jsxs("h2",{style:{margin:0,color:"#fff"},children:["Manage Cards (",a.length,")"]}),t.jsx("button",{onClick:k,style:o.closeBtn,children:"‚úï"})]}),t.jsxs("div",{style:o.toolsSection,children:[t.jsx("div",{style:o.toolHeader,children:"Maintenance Tools"}),t.jsxs("div",{style:o.toolRow,children:[t.jsxs("label",{style:o.checkboxLabel,children:[t.jsx("input",{type:"checkbox",checked:g,onChange:e=>S(e.target.checked),style:o.checkbox,disabled:f}),t.jsx("span",{style:{color:"#ccc"},children:"Enable AI Smart Deduplication"})]}),i?t.jsxs("button",{onClick:B,style:o.fixBtn,children:["Delete ",i.count," Duplicates"]}):t.jsx("button",{onClick:I,disabled:f||a.length===0,style:{...o.toolBtn,backgroundColor:f?"#444":"#2196f3",cursor:f||a.length===0?"not-allowed":"pointer",opacity:a.length===0?.5:1},children:f?"Scanning...":"Check Duplicates"})]}),g&&t.jsx("div",{style:{fontSize:"0.8rem",color:"#888",marginTop:"0.3rem",marginLeft:"26px"},children:"Uses Gemini API to detect semantic duplicates. (Slower & Costs Tokens)"}),i&&t.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"#ffb74d"},children:["‚ö†Ô∏è Found ",i.count," redundant cards (older or less reviewed)."]})]}),t.jsx("div",{style:o.listContainer,children:a.length===0?t.jsx("p",{style:{color:"#888",textAlign:"center"},children:"No cards found."}):a.map(e=>t.jsxs("div",{style:o.cardRow,children:[t.jsxs("div",{style:o.cardInfo,children:[t.jsx("div",{style:o.word,children:e.word}),t.jsxs("div",{style:o.def,children:[e.definition?.substring(0,50),"..."]})]}),t.jsx("button",{onClick:()=>v(e.id),style:{...o.deleteBtn,backgroundColor:d===e.id?"#d32f2f":"#333",color:d===e.id?"#fff":"#888",border:d===e.id?"1px solid #ff5252":"1px solid #444",width:d===e.id?"100px":"40px"},children:d===e.id?"Sure?":"üóëÔ∏è"})]},e.id))}),t.jsx("div",{style:o.footer,children:t.jsx("button",{onClick:D,style:{...o.dangerBtn,backgroundColor:s?"#d32f2f":"#3a1c1c",color:s?"#ffeb3b":"#ff6b6b",border:s?"1px solid #ffeb3b":"1px solid #ff6b6b"},children:s?`Confirm Clear All? (${x})`:"Clear All Local Data"})})]})}):null}const o={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},modal:{backgroundColor:"#1e2024",width:"90%",maxWidth:"500px",maxHeight:"80vh",borderRadius:"12px",display:"flex",flexDirection:"column",boxShadow:"0 10px 25px rgba(0,0,0,0.5)",border:"1px solid #333"},header:{padding:"1.5rem",borderBottom:"1px solid #333",display:"flex",justifyContent:"space-between",alignItems:"center"},closeBtn:{background:"none",border:"none",color:"#888",fontSize:"1.2rem",cursor:"pointer"},toolsSection:{padding:"1rem 1.5rem",backgroundColor:"rgba(0,0,0,0.2)",borderBottom:"1px solid #333"},toolHeader:{color:"#888",fontSize:"0.75rem",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"1px",marginBottom:"0.8rem"},toolRow:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},checkboxLabel:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",fontSize:"0.9rem"},checkbox:{cursor:"pointer",accentColor:"#2196f3"},toolBtn:{padding:"0.5rem 1rem",border:"none",borderRadius:"6px",color:"white",fontWeight:"bold",fontSize:"0.85rem",whiteSpace:"nowrap"},fixBtn:{padding:"0.5rem 1rem",backgroundColor:"#d32f2f",border:"1px solid #ff5252",borderRadius:"6px",color:"white",fontWeight:"bold",fontSize:"0.85rem",cursor:"pointer",whiteSpace:"nowrap",animation:"pulse 2s infinite"},listContainer:{flex:1,overflowY:"auto",padding:"1rem"},cardRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.8rem",borderBottom:"1px solid #2c2e33"},cardInfo:{flex:1,marginRight:"1rem",overflow:"hidden"},word:{color:"#e0e0e0",fontWeight:"bold",marginBottom:"0.2rem"},def:{color:"#888",fontSize:"0.85rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},deleteBtn:{padding:"0.4rem",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s ease",fontSize:"0.9rem",whiteSpace:"nowrap",display:"flex",justifyContent:"center",alignItems:"center"},footer:{padding:"1.5rem",borderTop:"1px solid #333"},dangerBtn:{width:"100%",padding:"0.8rem",borderRadius:"6px",cursor:"pointer",fontWeight:"bold",transition:"all 0.2s ease"}};export{T as default};
