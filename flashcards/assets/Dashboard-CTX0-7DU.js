import{c as g,d,r as y,j as e}from"./index-CS9ZihrP.js";const m=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],f=g("activity",m);const v=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],w=g("arrow-left",v);const j=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],k=g("book-open",j);const S=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],C=g("trending-up",S);class D{async getStats(){const[t,a,r]=await Promise.all([this.getMasteryDistribution(),this.getWeeklyActivity(),this.getRetentionStats()]);return{distribution:t,activity:a,retention:r}}async getMasteryDistribution(){const t=await d.vocab.count(),a=await d.vocab.where("status").equals("new").count(),r=await d.vocab.where("status").equals("learning").count(),l=await d.vocab.where("status").equals("review").count();return{total:t,breakdown:[{label:"New",count:a,color:"#94a3b8"},{label:"Learning",count:r,color:"#facc15"},{label:"Review",count:l,color:"#4ade80"}]}}async getWeeklyActivity(){const t=new Date,a=[],r=new Date;r.setDate(t.getDate()-6),r.setHours(0,0,0,0);const l=await d.study_logs.where("reviewTime").aboveOrEqual(r.getTime()).toArray();for(let u=0;u<7;u++){const s=new Date(r);s.setDate(s.getDate()+u);const i=s.setHours(0,0,0,0),c=s.setHours(23,59,59,999),b=l.filter(p=>p.reviewTime>=i&&p.reviewTime<=c).length;a.push({date:s.toLocaleDateString("en-US",{month:"short",day:"numeric"}),weekday:s.toLocaleDateString("en-US",{weekday:"short"}),count:b,height:0})}return a}async getRetentionStats(){const t=await d.study_logs.orderBy("reviewTime").reverse().limit(50).toArray();if(t.length===0)return{accuracy:0,count:0};const a=t.filter(l=>l.grade>=3).length;return{accuracy:Math.round(a/t.length*100),sampleSize:t.length}}}const z=new D;function T({onBack:o}){const[t,a]=y.useState(null),[r,l]=y.useState(!0);y.useEffect(()=>{u()},[]);const u=async()=>{try{const i=await z.getStats();a(i)}catch(i){console.error("Failed to load dashboard stats:",i)}finally{l(!1)}};if(r)return e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#888"},children:"Loading Stats..."});if(!t)return null;const s=Math.max(...t.activity.map(i=>i.count),1);return e.jsxs("div",{style:n.container,children:[e.jsxs("div",{style:n.header,children:[e.jsx("button",{onClick:o,style:n.backBtn,children:e.jsx(w,{size:24,color:"#e0e0e0"})}),e.jsx("h1",{style:n.title,children:"Learning Dashboard"})]}),e.jsxs("div",{style:n.grid,children:[e.jsx(x,{icon:e.jsx(k,{size:20,color:"#4dabf7"}),label:"Total Cards",value:t.distribution.total,subtext:"Vocabulary & Phrases"}),e.jsx(x,{icon:e.jsx(f,{size:20,color:"#69db7c"}),label:"7-Day Reviews",value:t.activity.reduce((i,c)=>i+c.count,0),subtext:"Cards reviewed"}),e.jsx(x,{icon:e.jsx(C,{size:20,color:"#da77f2"}),label:"Retention Rate",value:`${t.retention.accuracy}%`,subtext:`Last ${t.retention.sampleSize} reviews`})]}),e.jsxs("div",{style:n.chartsGrid,children:[e.jsxs("div",{style:n.card,children:[e.jsx("h3",{style:n.cardTitle,children:"Weekly Activity"}),e.jsx("div",{style:n.barChartContainer,children:t.activity.map((i,c)=>e.jsxs("div",{style:n.barGroup,children:[e.jsx("div",{title:`${i.count} cards`,style:{...n.bar,height:`${i.count/s*100}%`}}),e.jsx("span",{style:n.label,children:i.weekday})]},c))})]}),e.jsxs("div",{style:n.card,children:[e.jsx("h3",{style:n.cardTitle,children:"Mastery Distribution"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"2rem"},children:[e.jsxs("div",{style:{position:"relative",width:"160px",height:"160px",flexShrink:0},children:[e.jsx("div",{style:{width:"100%",height:"100%",borderRadius:"50%",background:`conic-gradient(
                    ${t.distribution.breakdown[0].color} 0% ${h(t.distribution,0)}%, 
                    ${t.distribution.breakdown[1].color} ${h(t.distribution,0)}% ${h(t.distribution,1)}%,
                    ${t.distribution.breakdown[2].color} ${h(t.distribution,1)}% 100%
                  )`}}),e.jsxs("div",{style:n.donutInner,children:[e.jsx("span",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#e0e0e0"},children:t.distribution.total}),e.jsx("span",{style:{fontSize:"0.8rem",color:"#888"},children:"Cards"})]})]}),e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.8rem"},children:t.distribution.breakdown.map((i,c)=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("span",{style:{width:"12px",height:"12px",borderRadius:"50%",marginRight:"8px",backgroundColor:i.color}}),e.jsx("span",{style:{fontSize:"0.9rem",color:"#ccc"},children:i.label})]}),e.jsx("span",{style:{fontSize:"0.9rem",fontWeight:"600",color:"#e0e0e0"},children:i.count})]},c))})]})]})]})]})}function h(o,t){if(o.total===0)return 0;let a=0;for(let r=0;r<=t;r++)a+=o.breakdown[r].count;return a/o.total*100}function x({icon:o,label:t,value:a,subtext:r}){return e.jsxs("div",{style:{...n.card,display:"flex",alignItems:"flex-start",gap:"1rem"},children:[e.jsx("div",{style:n.iconWrapper,children:o}),e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:"0.85rem",color:"#888",margin:0},children:t}),e.jsx("p",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#e0e0e0",margin:"0.2rem 0"},children:a}),e.jsx("p",{style:{fontSize:"0.75rem",color:"#666",margin:0},children:r})]})]})}const n={container:{maxWidth:"900px",width:"100%",margin:"0 auto",paddingBottom:"5rem"},header:{display:"flex",alignItems:"center",marginBottom:"1.5rem",gap:"1rem"},backBtn:{background:"none",border:"none",cursor:"pointer",padding:"0.5rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.2s"},title:{fontSize:"1.5rem",fontWeight:"bold",color:"#e0e0e0",margin:0},grid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:"1rem",marginBottom:"1.5rem"},chartsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1.5rem"},card:{backgroundColor:"#25262b",padding:"1.5rem",borderRadius:"12px",border:"1px solid #333",boxShadow:"0 4px 6px rgba(0,0,0,0.1)"},cardTitle:{fontSize:"1.1rem",fontWeight:"600",color:"#e0e0e0",marginBottom:"1.5rem",marginTop:0},iconWrapper:{padding:"0.75rem",backgroundColor:"#2c2e33",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center"},barChartContainer:{display:"flex",alignItems:"flex-end",justifyContent:"space-between",height:"180px",gap:"0.5rem"},barGroup:{display:"flex",flexDirection:"column",alignItems:"center",flex:1,height:"100%",justifyContent:"flex-end"},bar:{width:"100%",maxWidth:"30px",backgroundColor:"#339af0",borderRadius:"4px 4px 0 0",minHeight:"4px",transition:"height 0.5s ease"},label:{fontSize:"0.75rem",color:"#888",marginTop:"0.5rem",fontWeight:"500"},donutInner:{position:"absolute",inset:"16px",backgroundColor:"#25262b",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.2)"}};export{T as default};
