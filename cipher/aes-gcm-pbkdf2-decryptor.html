<!DOCTYPE html><html lang="zh-TW"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>AES-GCM(PBKDF2)</title><style>body{font-family:sans-serif;background:#667eea;display:flex;align-items:center;justify-content:center;height:100vh;margin:0}*{box-sizing:border-box}.c{background:#fff;padding:20px;border-radius:10px;width:100%;max-width:800px}.h{text-align:center;margin-bottom:15px}.g{margin-bottom:10px}label{display:block;margin-bottom:5px;font-weight:600}textarea,input{width:100%;padding:8px;border:1px solid #ccc;border-radius:5px;font-family:monospace;font-size:12px}textarea{min-height:70px}button{width:100%;padding:10px;margin-top:10px;border:none;border-radius:5px;background:#667eea;color:#fff;font-size:16px;cursor:pointer}button:hover{opacity:.9}.r{margin-top:15px}.rb{background:#f8f9fa;border:1px solid #ccc;border-radius:5px;padding:10px;word-wrap:break-word;max-height:200px;overflow:auto}.success{border-color:#28a745;background:#d4edda;color:#155724}.error{border-color:#dc3545;background:#f8d7da;color:#721c24}.status{padding:5px;border-radius:5px;margin-bottom:10px;font-weight:600}.loading{animation:pulse 1.5s infinite}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}.star{color:red;}</style></head><body><div class="c"><div class="h"><h1>🔓 AES-GCM(<span class="star">PBKDF2</span>)</h1></div><div class="g"><label for="ct">加密資料：</label><textarea id="ct" placeholder="加密資料..." rows="10"></textarea></div><div class="g"><label for="pw">密碼短語：</label><input id="pw" type="password" placeholder="密碼..."></div><button onclick="dec()">解密</button><div class="r"><div id="st"></div><div id="rs"></div></div></div><script>
function b64d(s){s=s.replace(/-/g,'+').replace(/_/g,'/');while(s.length%4)s+='=';let b=atob(s),u=new Uint8Array(b.length);for(let i=0;i<b.length;i++)u[i]=b.charCodeAt(i);return u}
async function kdf(p,s,i){let e=new TextEncoder().encode(p),k=await crypto.subtle.importKey('raw',e,{name:'PBKDF2'},0,['deriveBits']);return new Uint8Array(await crypto.subtle.deriveBits({name:'PBKDF2',salt:s,iterations:i,hash:'SHA-256'},k,256))}
function aad(p){let a={version:p.version},k={};['name','iterations','memory','parallelism','hash'].forEach(x=>p.keyDerivation[x]&&(k[x]=p.keyDerivation[x]));a.keyDerivation=k;a.encryptionName=p.encryption.name;return new TextEncoder().encode(JSON.stringify(a))}
async function gcm(k,iv,c,t,a){let ck=await crypto.subtle.importKey('raw',k,{name:'AES-GCM'},0,['decrypt']),cb=new Uint8Array(c.length+t.length);cb.set(c);cb.set(t,c.length);return new Uint8Array(await crypto.subtle.decrypt({name:'AES-GCM',iv,additionalData:a,tagLength:128},ck,cb))}
async function dec(){let c=document.getElementById('ct').value.trim(),pw=document.getElementById('pw').value;if(!c)return st('輸入加密資料','error');if(!pw)return st('輸入密碼','error');st('解碼中...','loading');try{let d=b64d(c),js=new TextDecoder().decode(d),p=JSON.parse(js);let s=b64d(p.keyDerivation.salt),iv=b64d(p.encryption.iv),ct=b64d(p.encryption.ciphertext),tg=b64d(p.encryption.tag),k=await kdf(pw,s,p.keyDerivation.iterations),a=p.version===2?aad(p):null,pl;try{pl=await gcm(k,iv,ct,tg,a)}catch(e){if(p.version!==2)pl=await gcm(k,iv,ct,tg,null);else throw e}st('解密成功!','success');rs(new TextDecoder().decode(pl),'success')}catch(e){st('解密失敗:'+e.message,'error')}}
function st(m,t){let d=document.getElementById('st');d.className='status '+t;d.textContent=m}
function rs(c,t){let d=document.getElementById('rs');d.className='rb '+t;d.textContent=c}
</script></body></html>