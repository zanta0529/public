(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=i(r);fetch(r.href,o)}})();const f={appModeSelector:document.getElementById("appModeSelector"),textModeSection:document.getElementById("text-mode-section"),fileModeSection:document.getElementById("file-mode-section"),modeSelector:document.getElementById("modeSelector"),encryptSection:document.getElementById("encrypt-section"),decryptSection:document.getElementById("decrypt-section"),mnemonic:document.getElementById("mnemonic"),ciphertextInput:document.getElementById("ciphertext-input"),passphraseEncrypt:document.getElementById("passphrase-encrypt"),passphraseDecrypt:document.getElementById("passphrase-decrypt"),algoSelectionGroup:document.getElementById("algoSelectionGroup"),kdfSelectionGroup:document.getElementById("kdfSelectionGroup"),argon2ParamsSection:document.getElementById("argon2-params-section"),argon2Memory:document.getElementById("argon2-memory"),argon2Iterations:document.getElementById("argon2-iterations"),argon2Parallelism:document.getElementById("argon2-parallelism"),encryptBtn:document.getElementById("encryptBtn"),decryptBtn:document.getElementById("decryptBtn"),parseBtn:document.getElementById("parseBtn"),benchmarkBtn:document.getElementById("benchmarkBtn"),benchmarkStatus:document.getElementById("benchmarkStatus"),selfVerifyCheckbox:document.getElementById("self-verify-checkbox"),selfVerifyFileCheckbox:document.getElementById("self-verify-file-checkbox"),passwordStrengthBarEncrypt:document.getElementById("password-strength-bar-encrypt"),passwordStrengthTextEncrypt:document.getElementById("password-strength-text-encrypt"),passwordStrengthBarFile:document.getElementById("password-strength-bar-file"),passwordStrengthTextFile:document.getElementById("password-strength-text-file"),fileEncryptInput:document.getElementById("file-encrypt-input"),fileEncryptInfo:document.getElementById("file-encrypt-info"),passphraseFileEncrypt:document.getElementById("passphrase-file-encrypt"),encryptFileBtn:document.getElementById("encryptFileBtn"),fileDecryptInput:document.getElementById("file-decrypt-input"),fileDecryptInfo:document.getElementById("file-decrypt-info"),passphraseFileDecrypt:document.getElementById("passphrase-file-decrypt"),decryptFileBtn:document.getElementById("decryptFileBtn"),pasteBtn:document.getElementById("pasteBtn"),resetBtn:document.getElementById("resetBtn"),resultsArea:document.getElementById("results-area"),textModeResults:document.getElementById("text-mode-results"),output:document.getElementById("output"),copyBtn:document.getElementById("copyBtn"),downloadBtn:document.getElementById("downloadBtn"),qrCanvas:document.getElementById("qrCanvas"),jsonView:document.getElementById("jsonView"),base64ResultView:document.getElementById("base64ResultView"),paramsDisplayArea:document.getElementById("params-display-area"),passwordToggles:document.querySelectorAll(".toggle-password-icon"),decryptionActions:document.getElementById("decryption-actions"),copyDecryptedBtn:document.getElementById("copyDecryptedBtn"),themeToggleBtn:document.getElementById("themeToggleBtn"),currentYear:document.getElementById("currentYear"),toast:document.getElementById("toast"),scrollTopBtn:document.getElementById("scroll-to-top"),accordionContainer:document.querySelector(".accordion")},D={currentAppMode:null,currentMode:null,selectedAlgorithm:null,selectedKDF:null,toastTimer:null,lastEncryptedOutput:null,lastDecryptedText:null,fileToEncrypt:null,fileToDecrypt:null},T={VERSION:3,SALT_BYTES:16,NONCE_BYTES:12,TAG_BYTES:16,TAG_LENGTH_BITS:128,KEY_LENGTH_BITS:256,PBKDF2_ITERATIONS:2e6,QR_CODE_MAX_BYTES:2953,FILE_SIZE_LIMIT_BYTES:10*1024*1024,ARGON2_MIN_MEM_MB:64,ARGON2_MIN_ITER:4,ARGON2_MIN_PARA:4,SVG_EYE_OPEN:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/><path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/></svg>',SVG_EYE_SLASH:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7.029 7.029 0 0 0 2.79-.588zM5.21 3.088A7.028 7.028 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474L5.21 3.089z"/><path d="M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829l-2.83-2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12-.708.708z"/></svg>',MODE_TEXT:"text",MODE_FILE:"file",OP_ENCRYPT:"encrypt",OP_DECRYPT:"decrypt",ALGO_AES_GCM:"AES-GCM",ALGO_CHACHA:"ChaCha20-Poly1305",KDF_ARGON2:"Argon2id",KDF_PBKDF2:"PBKDF2",HASH_SHA256:"SHA-256"},V={copyFromResult(){D.lastEncryptedOutput&&navigator.clipboard.writeText(D.lastEncryptedOutput).then(()=>this.showToast("✅ 已複製 Base64 密文！"),()=>this.showToast("❌ 複製失敗"))},copyDecryptedResult(){D.lastDecryptedText&&navigator.clipboard.writeText(D.lastDecryptedText).then(()=>this.showToast("✅ 已複製解密結果！"),()=>this.showToast("❌ 複製失敗"))},pasteTo(t){navigator.clipboard.readText().then(e=>{f[t].value=e,this.showToast("✅ 已貼上內容！")},()=>this.showToast("❌ 貼上失敗"))},downloadAsFile(t,e){const i=t instanceof Blob?t:new Blob([t],{type:"application/octet-stream"}),n=URL.createObjectURL(i),r=document.createElement("a");r.href=n,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)},showToast(t){D.toastTimer&&clearTimeout(D.toastTimer),f.toast.textContent=t,f.toast.className="show",D.toastTimer=setTimeout(()=>{f.toast.className="",D.toastTimer=null},3e3)},async checkArgon2Ready(){return typeof argon2<"u"?!0:new Promise(t=>{setTimeout(()=>{typeof argon2<"u"?t(!0):(this.showToast("❌ Argon2 函式庫載入失敗！","error"),t(!1))},1e3)})},runSecurityChecks(t,e){if(this.checkPasswordStrength(t).level==="weak"&&this.showToast("⚠️ 警告：密碼強度較弱，建議使用更複雜的密碼。"),e===T.KDF_ARGON2){const n=parseInt(f.argon2Memory.value,10),r=parseInt(f.argon2Iterations.value,10),o=parseInt(f.argon2Parallelism.value,10);if(n<T.ARGON2_MIN_MEM_MB||r<T.ARGON2_MIN_ITER||o<T.ARGON2_MIN_PARA)return this.showToast("❌ 安全性警告：Argon2 參數過低！"),!1}return!0},checkPasswordStrength(t){let e=0,i="",n="empty";return t.length===0?{score:0,message:"",level:"empty"}:(t.length>=8&&(e+=25),t.length>=12&&(e+=25),/[a-z]/.test(t)&&/[A-Z]/.test(t)&&(e+=20),/\d/.test(t)&&(e+=15),/[^a-zA-Z0-9]/.test(t)&&(e+=15),e=Math.min(e,100),e<50?(i="強度：弱",n="weak"):e<85?(i="強度：中等",n="medium"):(i="強度：強",n="strong"),{score:e,message:i,level:n})}},O={setAppMode(t){D.currentAppMode=t;const e=t===T.MODE_TEXT;this.handleOptionSelection({target:f.appModeSelector.querySelector(`[data-app-mode="${t}"]`)}),f.textModeSection.hidden=!e,f.fileModeSection.hidden=e,this.setMode(T.OP_ENCRYPT)},setMode(t){this.resetAll(),D.currentMode=t;const e=t===T.OP_ENCRYPT;this.handleOptionSelection({target:f.modeSelector.querySelector(`[data-mode="${t}"]`)}),f.encryptSection.hidden=!e,f.decryptSection.hidden=e,f.pasteBtn.hidden=e},handleOptionSelection(t,e){const i=t.target.closest(".option");return i&&!i.classList.contains("selected")?(i.parentElement.querySelector(".selected")?.classList.remove("selected"),i.classList.add("selected"),e&&(D[e]=i.dataset.value),!0):!1},toggleArgon2Params(t){f.argon2ParamsSection.hidden=!t},setOutput(t,e){f.resultsArea.hidden=!1,f.output.className=`output-box ${t}`,f.output.innerHTML=e,f.textModeResults.hidden=!0,f.decryptionActions.hidden=!0,t==="success"&&D.currentAppMode===T.MODE_TEXT&&(D.currentMode===T.OP_ENCRYPT?f.textModeResults.hidden=!1:f.decryptionActions.hidden=!1)},resetAll(){if(["mnemonic","ciphertextInput","passphraseEncrypt","passphraseDecrypt","passphraseFileEncrypt","passphraseFileDecrypt"].forEach(e=>f[e]?f[e].value="":null),this.updatePasswordStrength("","encrypt"),this.updatePasswordStrength("","file"),f.fileEncryptInput.value="",f.fileDecryptInput.value="",D.fileToEncrypt=null,D.fileToDecrypt=null,f.fileEncryptInfo.hidden=!0,f.fileDecryptInfo.hidden=!0,f.resultsArea.hidden=!0,f.textModeResults.hidden=!0,f.decryptionActions.hidden=!0,f.paramsDisplayArea.hidden=!0,D.lastEncryptedOutput=null,D.lastDecryptedText=null,D.selectedKDF=T.KDF_ARGON2,this.handleOptionSelection({target:f.kdfSelectionGroup.querySelector(`[data-value="${T.KDF_ARGON2}"]`)},"selectedKDF"),this.toggleArgon2Params(!0),f.qrCanvas){const e=f.qrCanvas.getContext("2d");e&&e.clearRect(0,0,f.qrCanvas.width,f.qrCanvas.height)}},togglePasswordVisibility(t){const e=document.getElementById(t.dataset.for);e.type==="password"?(e.type="text",t.innerHTML=T.SVG_EYE_SLASH):(e.type="password",t.innerHTML=T.SVG_EYE_OPEN)},updatePasswordStrength(t,e){const i=V.checkPasswordStrength(t),n=e==="encrypt"?f.passwordStrengthBarEncrypt:f.passwordStrengthBarFile,r=e==="encrypt"?f.passwordStrengthTextEncrypt:f.passwordStrengthTextFile;n.className="password-strength-meter-bar",i.level!=="empty"&&n.classList.add(`strength-${i.level}`),n.style.width=i.score+"%",r.textContent=i.message}},Ee={handleFileSelect(t,e){const i=t.target.files[0];if(!i)return;const n=f[`file${e.charAt(0).toUpperCase()+e.slice(1)}Info`];if(i.size>T.FILE_SIZE_LIMIT_BYTES){n.innerHTML=`<p style="color: var(--error-color);">❌ 檔案過大：${(i.size/1024/1024).toFixed(2)} MB</p>`,n.hidden=!1,D[e===T.OP_ENCRYPT?"fileToEncrypt":"fileToDecrypt"]=null;return}n.innerHTML=`檔案名稱: <span>${i.name}</span><br>檔案大小: <span>${(i.size/1024).toFixed(2)} KB</span>`,n.hidden=!1,D[e===T.OP_ENCRYPT?"fileToEncrypt":"fileToDecrypt"]=i},readFileAsArrayBuffer:t=>t.arrayBuffer(),readFileAsText:t=>t.text()};/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function qt(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ze(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Be(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Q(t,...e){if(!qt(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function tt(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function dn(t,e){Q(t);const i=e.outputLen;if(t.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}function oe(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function le(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function hn(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const gn=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function pn(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Ye(t){if(typeof t=="string")t=pn(t);else if(qt(t))t=$e(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function yn(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function mn(t,e){if(t.length!==e.length)return!1;let i=0;for(let n=0;n<t.length;n++)i|=t[n]^e[n];return i===0}const wn=(t,e)=>{function i(n,...r){if(Q(n),!gn)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const u=r[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?Q(u):Q(u,t.nonceLength)}const o=t.tagLength;o&&r[1]!==void 0&&Q(r[1]);const s=e(n,...r),a=(u,d)=>{if(d!==void 0){if(u!==2)throw new Error("cipher output not supported");Q(d)}};let c=!1;return{encrypt(u,d){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Q(u),a(s.encrypt.length,d),s.encrypt(u,d)},decrypt(u,d){if(Q(u),o&&u.length<o)throw new Error("invalid ciphertext length: smaller than tagLength="+o);return a(s.decrypt.length,d),s.decrypt(u,d)}}}return Object.assign(i,t),i};function nt(t,e,i=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(i&&!An(e))throw new Error("invalid output, must be aligned");return e}function rt(t,e,i,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,i,n);const r=BigInt(32),o=BigInt(4294967295),s=Number(i>>r&o),a=Number(i&o),c=4,l=0;t.setUint32(e+c,s,n),t.setUint32(e+l,a,n)}function En(t,e,i){ze(i);const n=new Uint8Array(16),r=hn(n);return rt(r,0,BigInt(e),i),rt(r,8,BigInt(t),i),n}function An(t){return t.byteOffset%4===0}function $e(t){return Uint8Array.from(t)}const Ht=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),Bn=Ht("expand 16-byte k"),Tn=Ht("expand 32-byte k"),Cn=oe(Bn),bn=oe(Tn);function P(t,e){return t<<e|t>>>32-e}function je(t){return t.byteOffset%4===0}const ge=64,Sn=16,Vt=2**32-1,ot=new Uint32Array;function In(t,e,i,n,r,o,s,a){const c=r.length,l=new Uint8Array(ge),u=oe(l),d=je(r)&&je(o),p=d?oe(r):ot,h=d?oe(o):ot;for(let y=0;y<c;s++){if(t(e,i,n,u,s,a),s>=Vt)throw new Error("arx: counter overflow");const C=Math.min(ge,c-y);if(d&&C===ge){const M=y/4;if(y%4!==0)throw new Error("arx: invalid block position");for(let _=0,R;_<Sn;_++)R=M+_,h[R]=p[R]^u[_];y+=ge;continue}for(let M=0,_;M<C;M++)_=y+M,o[_]=r[_]^l[M];y+=C}}function _n(t,e){const{allowShortKeys:i,extendNonceFn:n,counterLength:r,counterRight:o,rounds:s}=yn({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Be(r),Be(s),ze(o),ze(i),(a,c,l,u,d=0)=>{Q(a),Q(c),Q(l);const p=l.length;if(u===void 0&&(u=new Uint8Array(p)),Q(u),Be(d),d<0||d>=Vt)throw new Error("arx: counter overflow");if(u.length<p)throw new Error(`arx: output (${u.length}) is shorter than data (${p})`);const h=[];let y=a.length,C,M;if(y===32)h.push(C=$e(a)),M=bn;else if(y===16&&i)C=new Uint8Array(32),C.set(a),C.set(a,16),M=Cn,h.push(C);else throw new Error(`arx: invalid 32-byte key, got length=${y}`);je(c)||h.push(c=$e(c));const _=oe(C);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(M,_,oe(c.subarray(0,16)),_),c=c.subarray(16)}const R=16-r;if(R!==c.length)throw new Error(`arx: nonce must be ${R} or 16 bytes`);if(R!==12){const x=new Uint8Array(12);x.set(c,o?0:12-c.length),c=x,h.push(c)}const L=oe(c);return In(t,M,_,L,l,u,d,s),le(...h),u}}const z=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class vn{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Ye(e),Q(e,32);const i=z(e,0),n=z(e,2),r=z(e,4),o=z(e,6),s=z(e,8),a=z(e,10),c=z(e,12),l=z(e,14);this.r[0]=i&8191,this.r[1]=(i>>>13|n<<3)&8191,this.r[2]=(n>>>10|r<<6)&7939,this.r[3]=(r>>>7|o<<9)&8191,this.r[4]=(o>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=z(e,16+2*u)}process(e,i,n=!1){const r=n?0:2048,{h:o,r:s}=this,a=s[0],c=s[1],l=s[2],u=s[3],d=s[4],p=s[5],h=s[6],y=s[7],C=s[8],M=s[9],_=z(e,i+0),R=z(e,i+2),L=z(e,i+4),x=z(e,i+6),H=z(e,i+8),A=z(e,i+10),I=z(e,i+12),b=z(e,i+14);let g=o[0]+(_&8191),B=o[1]+((_>>>13|R<<3)&8191),m=o[2]+((R>>>10|L<<6)&8191),E=o[3]+((L>>>7|x<<9)&8191),w=o[4]+((x>>>4|H<<12)&8191),S=o[5]+(H>>>1&8191),N=o[6]+((H>>>14|A<<2)&8191),F=o[7]+((A>>>11|I<<5)&8191),k=o[8]+((I>>>8|b<<8)&8191),U=o[9]+(b>>>5|r),v=0,K=v+g*a+B*(5*M)+m*(5*C)+E*(5*y)+w*(5*h);v=K>>>13,K&=8191,K+=S*(5*p)+N*(5*d)+F*(5*u)+k*(5*l)+U*(5*c),v+=K>>>13,K&=8191;let G=v+g*c+B*a+m*(5*M)+E*(5*C)+w*(5*y);v=G>>>13,G&=8191,G+=S*(5*h)+N*(5*p)+F*(5*d)+k*(5*u)+U*(5*l),v+=G>>>13,G&=8191;let q=v+g*l+B*c+m*a+E*(5*M)+w*(5*C);v=q>>>13,q&=8191,q+=S*(5*y)+N*(5*h)+F*(5*p)+k*(5*d)+U*(5*u),v+=q>>>13,q&=8191;let Z=v+g*u+B*l+m*c+E*a+w*(5*M);v=Z>>>13,Z&=8191,Z+=S*(5*C)+N*(5*y)+F*(5*h)+k*(5*p)+U*(5*d),v+=Z>>>13,Z&=8191;let ne=v+g*d+B*u+m*l+E*c+w*a;v=ne>>>13,ne&=8191,ne+=S*(5*M)+N*(5*C)+F*(5*y)+k*(5*h)+U*(5*p),v+=ne>>>13,ne&=8191;let W=v+g*p+B*d+m*u+E*l+w*c;v=W>>>13,W&=8191,W+=S*a+N*(5*M)+F*(5*C)+k*(5*y)+U*(5*h),v+=W>>>13,W&=8191;let te=v+g*h+B*p+m*d+E*u+w*l;v=te>>>13,te&=8191,te+=S*c+N*a+F*(5*M)+k*(5*C)+U*(5*y),v+=te>>>13,te&=8191;let $=v+g*y+B*h+m*p+E*d+w*u;v=$>>>13,$&=8191,$+=S*l+N*c+F*a+k*(5*M)+U*(5*C),v+=$>>>13,$&=8191;let j=v+g*C+B*y+m*h+E*p+w*d;v=j>>>13,j&=8191,j+=S*u+N*l+F*c+k*a+U*(5*M),v+=j>>>13,j&=8191;let X=v+g*M+B*C+m*y+E*h+w*p;v=X>>>13,X&=8191,X+=S*d+N*u+F*l+k*c+U*a,v+=X>>>13,X&=8191,v=(v<<2)+v|0,v=v+K|0,K=v&8191,v=v>>>13,G+=v,o[0]=K,o[1]=G,o[2]=q,o[3]=Z,o[4]=ne,o[5]=W,o[6]=te,o[7]=$,o[8]=j,o[9]=X}finalize(){const{h:e,pad:i}=this,n=new Uint16Array(10);let r=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=r,r=e[a]>>>13,e[a]&=8191;e[0]+=r*5,r=e[0]>>>13,e[0]&=8191,e[1]+=r,r=e[1]>>>13,e[1]&=8191,e[2]+=r,n[0]=e[0]+5,r=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+r,r=n[a]>>>13,n[a]&=8191;n[9]-=8192;let o=(r^1)-1;for(let a=0;a<10;a++)n[a]&=o;o=~o;for(let a=0;a<10;a++)e[a]=e[a]&o|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let s=e[0]+i[0];e[0]=s&65535;for(let a=1;a<8;a++)s=(e[a]+i[a]|0)+(s>>>16)|0,e[a]=s&65535;le(n)}update(e){tt(this),e=Ye(e),Q(e);const{buffer:i,blockLen:n}=this,r=e.length;for(let o=0;o<r;){const s=Math.min(n-this.pos,r-o);if(s===n){for(;n<=r-o;o+=n)this.process(e,o);continue}i.set(e.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===n&&(this.process(i,0,!1),this.pos=0)}return this}destroy(){le(this.h,this.r,this.buffer,this.pad)}digestInto(e){tt(this),dn(e,this),this.finished=!0;const{buffer:i,h:n}=this;let{pos:r}=this;if(r){for(i[r++]=1;r<16;r++)i[r]=0;this.process(i,0,!0)}this.finalize();let o=0;for(let s=0;s<8;s++)e[o++]=n[s]>>>0,e[o++]=n[s]>>>8;return e}digest(){const{buffer:e,outputLen:i}=this;this.digestInto(e);const n=e.slice(0,i);return this.destroy(),n}}function xn(t){const e=(n,r)=>t(r).update(Ye(n)).digest(),i=t(new Uint8Array(32));return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=n=>t(n),e}const Ln=xn(t=>new vn(t));function Mn(t,e,i,n,r,o=20){let s=t[0],a=t[1],c=t[2],l=t[3],u=e[0],d=e[1],p=e[2],h=e[3],y=e[4],C=e[5],M=e[6],_=e[7],R=r,L=i[0],x=i[1],H=i[2],A=s,I=a,b=c,g=l,B=u,m=d,E=p,w=h,S=y,N=C,F=M,k=_,U=R,v=L,K=x,G=H;for(let Z=0;Z<o;Z+=2)A=A+B|0,U=P(U^A,16),S=S+U|0,B=P(B^S,12),A=A+B|0,U=P(U^A,8),S=S+U|0,B=P(B^S,7),I=I+m|0,v=P(v^I,16),N=N+v|0,m=P(m^N,12),I=I+m|0,v=P(v^I,8),N=N+v|0,m=P(m^N,7),b=b+E|0,K=P(K^b,16),F=F+K|0,E=P(E^F,12),b=b+E|0,K=P(K^b,8),F=F+K|0,E=P(E^F,7),g=g+w|0,G=P(G^g,16),k=k+G|0,w=P(w^k,12),g=g+w|0,G=P(G^g,8),k=k+G|0,w=P(w^k,7),A=A+m|0,G=P(G^A,16),F=F+G|0,m=P(m^F,12),A=A+m|0,G=P(G^A,8),F=F+G|0,m=P(m^F,7),I=I+E|0,U=P(U^I,16),k=k+U|0,E=P(E^k,12),I=I+E|0,U=P(U^I,8),k=k+U|0,E=P(E^k,7),b=b+w|0,v=P(v^b,16),S=S+v|0,w=P(w^S,12),b=b+w|0,v=P(v^b,8),S=S+v|0,w=P(w^S,7),g=g+B|0,K=P(K^g,16),N=N+K|0,B=P(B^N,12),g=g+B|0,K=P(K^g,8),N=N+K|0,B=P(B^N,7);let q=0;n[q++]=s+A|0,n[q++]=a+I|0,n[q++]=c+b|0,n[q++]=l+g|0,n[q++]=u+B|0,n[q++]=d+m|0,n[q++]=p+E|0,n[q++]=h+w|0,n[q++]=y+S|0,n[q++]=C+N|0,n[q++]=M+F|0,n[q++]=_+k|0,n[q++]=R+U|0,n[q++]=L+v|0,n[q++]=x+K|0,n[q++]=H+G|0}const Rn=_n(Mn,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Dn=new Uint8Array(16),it=(t,e)=>{t.update(e);const i=e.length%16;i&&t.update(Dn.subarray(i))},Nn=new Uint8Array(32);function st(t,e,i,n,r){const o=t(e,i,Nn),s=Ln.create(o);r&&it(s,r),it(s,n);const a=En(n.length,r?r.length:0,!0);s.update(a);const c=s.digest();return le(o,a),c}const Pn=t=>(e,i,n)=>({encrypt(o,s){const a=o.length;s=nt(a+16,s,!1),s.set(o);const c=s.subarray(0,-16);t(e,i,c,c,1);const l=st(t,e,i,c,n);return s.set(l,a),le(l),s},decrypt(o,s){s=nt(o.length-16,s,!1);const a=o.subarray(0,-16),c=o.subarray(-16),l=st(t,e,i,a,n);if(!mn(c,l))throw new Error("invalid tag");return s.set(o.subarray(0,-16)),t(e,i,s,s,1),le(l),s}}),zt=wn({blockSize:64,nonceLength:12,tagLength:16},Pn(Rn)),Yt="3.7.7",Fn=Yt,ue=typeof Buffer=="function",at=typeof TextDecoder=="function"?new TextDecoder:void 0,ct=typeof TextEncoder=="function"?new TextEncoder:void 0,On="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",he=Array.prototype.slice.call(On),pe=(t=>{let e={};return t.forEach((i,n)=>e[i]=n),e})(he),Un=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Y=String.fromCharCode.bind(String),lt=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),$t=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),jt=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),Jt=t=>{let e,i,n,r,o="";const s=t.length%3;for(let a=0;a<t.length;){if((i=t.charCodeAt(a++))>255||(n=t.charCodeAt(a++))>255||(r=t.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=i<<16|n<<8|r,o+=he[e>>18&63]+he[e>>12&63]+he[e>>6&63]+he[e&63]}return s?o.slice(0,s-3)+"===".substring(s):o},Xe=typeof btoa=="function"?t=>btoa(t):ue?t=>Buffer.from(t,"binary").toString("base64"):Jt,Je=ue?t=>Buffer.from(t).toString("base64"):t=>{let i=[];for(let n=0,r=t.length;n<r;n+=4096)i.push(Y.apply(null,t.subarray(n,n+4096)));return Xe(i.join(""))},we=(t,e=!1)=>e?$t(Je(t)):Je(t),kn=t=>{if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?Y(192|e>>>6)+Y(128|e&63):Y(224|e>>>12&15)+Y(128|e>>>6&63)+Y(128|e&63)}else{var e=65536+(t.charCodeAt(0)-55296)*1024+(t.charCodeAt(1)-56320);return Y(240|e>>>18&7)+Y(128|e>>>12&63)+Y(128|e>>>6&63)+Y(128|e&63)}},Kn=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Qt=t=>t.replace(Kn,kn),ut=ue?t=>Buffer.from(t,"utf8").toString("base64"):ct?t=>Je(ct.encode(t)):t=>Xe(Qt(t)),ce=(t,e=!1)=>e?$t(ut(t)):ut(t),ft=t=>ce(t,!0),Gn=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,qn=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),i=e-65536;return Y((i>>>10)+55296)+Y((i&1023)+56320);case 3:return Y((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return Y((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},Zt=t=>t.replace(Gn,qn),Xt=t=>{if(t=t.replace(/\s+/g,""),!Un.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,i="",n,r;for(let o=0;o<t.length;)e=pe[t.charAt(o++)]<<18|pe[t.charAt(o++)]<<12|(n=pe[t.charAt(o++)])<<6|(r=pe[t.charAt(o++)]),i+=n===64?Y(e>>16&255):r===64?Y(e>>16&255,e>>8&255):Y(e>>16&255,e>>8&255,e&255);return i},We=typeof atob=="function"?t=>atob(jt(t)):ue?t=>Buffer.from(t,"base64").toString("binary"):Xt,Wt=ue?t=>lt(Buffer.from(t,"base64")):t=>lt(We(t).split("").map(e=>e.charCodeAt(0))),en=t=>Wt(tn(t)),Hn=ue?t=>Buffer.from(t,"base64").toString("utf8"):at?t=>at.decode(Wt(t)):t=>Zt(We(t)),tn=t=>jt(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),Qe=t=>Hn(tn(t)),Vn=t=>{if(typeof t!="string")return!1;const e=t.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},nn=t=>({value:t,enumerable:!1,writable:!0,configurable:!0}),rn=function(){const t=(e,i)=>Object.defineProperty(String.prototype,e,nn(i));t("fromBase64",function(){return Qe(this)}),t("toBase64",function(e){return ce(this,e)}),t("toBase64URI",function(){return ce(this,!0)}),t("toBase64URL",function(){return ce(this,!0)}),t("toUint8Array",function(){return en(this)})},on=function(){const t=(e,i)=>Object.defineProperty(Uint8Array.prototype,e,nn(i));t("toBase64",function(e){return we(this,e)}),t("toBase64URI",function(){return we(this,!0)}),t("toBase64URL",function(){return we(this,!0)})},zn=()=>{rn(),on()},J={version:Yt,VERSION:Fn,atob:We,atobPolyfill:Xt,btoa:Xe,btoaPolyfill:Jt,fromBase64:Qe,toBase64:ce,encode:ce,encodeURI:ft,encodeURL:ft,utob:Qt,btou:Zt,decode:Qe,isValid:Vn,fromUint8Array:we,toUint8Array:en,extendString:rn,extendUint8Array:on,extendBuiltins:zn};function Yn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ae={},Te,dt;function $n(){return dt||(dt=1,Te=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),Te}var Ce={},re={},ht;function ie(){if(ht)return re;ht=1;let t;const e=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return re.getSymbolSize=function(n){if(!n)throw new Error('"version" cannot be null or undefined');if(n<1||n>40)throw new Error('"version" should be in range from 1 to 40');return n*4+17},re.getSymbolTotalCodewords=function(n){return e[n]},re.getBCHDigit=function(i){let n=0;for(;i!==0;)n++,i>>>=1;return n},re.setToSJISFunction=function(n){if(typeof n!="function")throw new Error('"toSJISFunc" is not a valid function.');t=n},re.isKanjiModeEnabled=function(){return typeof t<"u"},re.toSJIS=function(n){return t(n)},re}var be={},gt;function et(){return gt||(gt=1,function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function e(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+i)}}t.isValid=function(n){return n&&typeof n.bit<"u"&&n.bit>=0&&n.bit<4},t.from=function(n,r){if(t.isValid(n))return n;try{return e(n)}catch{return r}}}(be)),be}var Se,pt;function jn(){if(pt)return Se;pt=1;function t(){this.buffer=[],this.length=0}return t.prototype={get:function(e){const i=Math.floor(e/8);return(this.buffer[i]>>>7-e%8&1)===1},put:function(e,i){for(let n=0;n<i;n++)this.putBit((e>>>i-n-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(e){const i=Math.floor(this.length/8);this.buffer.length<=i&&this.buffer.push(0),e&&(this.buffer[i]|=128>>>this.length%8),this.length++}},Se=t,Se}var Ie,yt;function Jn(){if(yt)return Ie;yt=1;function t(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}return t.prototype.set=function(e,i,n,r){const o=e*this.size+i;this.data[o]=n,r&&(this.reservedBit[o]=!0)},t.prototype.get=function(e,i){return this.data[e*this.size+i]},t.prototype.xor=function(e,i,n){this.data[e*this.size+i]^=n},t.prototype.isReserved=function(e,i){return this.reservedBit[e*this.size+i]},Ie=t,Ie}var _e={},mt;function Qn(){return mt||(mt=1,function(t){const e=ie().getSymbolSize;t.getRowColCoords=function(n){if(n===1)return[];const r=Math.floor(n/7)+2,o=e(n),s=o===145?26:Math.ceil((o-13)/(2*r-2))*2,a=[o-7];for(let c=1;c<r-1;c++)a[c]=a[c-1]-s;return a.push(6),a.reverse()},t.getPositions=function(n){const r=[],o=t.getRowColCoords(n),s=o.length;for(let a=0;a<s;a++)for(let c=0;c<s;c++)a===0&&c===0||a===0&&c===s-1||a===s-1&&c===0||r.push([o[a],o[c]]);return r}}(_e)),_e}var ve={},wt;function Zn(){if(wt)return ve;wt=1;const t=ie().getSymbolSize,e=7;return ve.getPositions=function(n){const r=t(n);return[[0,0],[r-e,0],[0,r-e]]},ve}var xe={},Et;function Xn(){return Et||(Et=1,function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};t.isValid=function(r){return r!=null&&r!==""&&!isNaN(r)&&r>=0&&r<=7},t.from=function(r){return t.isValid(r)?parseInt(r,10):void 0},t.getPenaltyN1=function(r){const o=r.size;let s=0,a=0,c=0,l=null,u=null;for(let d=0;d<o;d++){a=c=0,l=u=null;for(let p=0;p<o;p++){let h=r.get(d,p);h===l?a++:(a>=5&&(s+=e.N1+(a-5)),l=h,a=1),h=r.get(p,d),h===u?c++:(c>=5&&(s+=e.N1+(c-5)),u=h,c=1)}a>=5&&(s+=e.N1+(a-5)),c>=5&&(s+=e.N1+(c-5))}return s},t.getPenaltyN2=function(r){const o=r.size;let s=0;for(let a=0;a<o-1;a++)for(let c=0;c<o-1;c++){const l=r.get(a,c)+r.get(a,c+1)+r.get(a+1,c)+r.get(a+1,c+1);(l===4||l===0)&&s++}return s*e.N2},t.getPenaltyN3=function(r){const o=r.size;let s=0,a=0,c=0;for(let l=0;l<o;l++){a=c=0;for(let u=0;u<o;u++)a=a<<1&2047|r.get(l,u),u>=10&&(a===1488||a===93)&&s++,c=c<<1&2047|r.get(u,l),u>=10&&(c===1488||c===93)&&s++}return s*e.N3},t.getPenaltyN4=function(r){let o=0;const s=r.data.length;for(let c=0;c<s;c++)o+=r.data[c];return Math.abs(Math.ceil(o*100/s/5)-10)*e.N4};function i(n,r,o){switch(n){case t.Patterns.PATTERN000:return(r+o)%2===0;case t.Patterns.PATTERN001:return r%2===0;case t.Patterns.PATTERN010:return o%3===0;case t.Patterns.PATTERN011:return(r+o)%3===0;case t.Patterns.PATTERN100:return(Math.floor(r/2)+Math.floor(o/3))%2===0;case t.Patterns.PATTERN101:return r*o%2+r*o%3===0;case t.Patterns.PATTERN110:return(r*o%2+r*o%3)%2===0;case t.Patterns.PATTERN111:return(r*o%3+(r+o)%2)%2===0;default:throw new Error("bad maskPattern:"+n)}}t.applyMask=function(r,o){const s=o.size;for(let a=0;a<s;a++)for(let c=0;c<s;c++)o.isReserved(c,a)||o.xor(c,a,i(r,c,a))},t.getBestMask=function(r,o){const s=Object.keys(t.Patterns).length;let a=0,c=1/0;for(let l=0;l<s;l++){o(l),t.applyMask(l,r);const u=t.getPenaltyN1(r)+t.getPenaltyN2(r)+t.getPenaltyN3(r)+t.getPenaltyN4(r);t.applyMask(l,r),u<c&&(c=u,a=l)}return a}}(xe)),xe}var ye={},At;function sn(){if(At)return ye;At=1;const t=et(),e=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],i=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return ye.getBlocksCount=function(r,o){switch(o){case t.L:return e[(r-1)*4+0];case t.M:return e[(r-1)*4+1];case t.Q:return e[(r-1)*4+2];case t.H:return e[(r-1)*4+3];default:return}},ye.getTotalCodewordsCount=function(r,o){switch(o){case t.L:return i[(r-1)*4+0];case t.M:return i[(r-1)*4+1];case t.Q:return i[(r-1)*4+2];case t.H:return i[(r-1)*4+3];default:return}},ye}var Le={},fe={},Bt;function Wn(){if(Bt)return fe;Bt=1;const t=new Uint8Array(512),e=new Uint8Array(256);return function(){let n=1;for(let r=0;r<255;r++)t[r]=n,e[n]=r,n<<=1,n&256&&(n^=285);for(let r=255;r<512;r++)t[r]=t[r-255]}(),fe.log=function(n){if(n<1)throw new Error("log("+n+")");return e[n]},fe.exp=function(n){return t[n]},fe.mul=function(n,r){return n===0||r===0?0:t[e[n]+e[r]]},fe}var Tt;function er(){return Tt||(Tt=1,function(t){const e=Wn();t.mul=function(n,r){const o=new Uint8Array(n.length+r.length-1);for(let s=0;s<n.length;s++)for(let a=0;a<r.length;a++)o[s+a]^=e.mul(n[s],r[a]);return o},t.mod=function(n,r){let o=new Uint8Array(n);for(;o.length-r.length>=0;){const s=o[0];for(let c=0;c<r.length;c++)o[c]^=e.mul(r[c],s);let a=0;for(;a<o.length&&o[a]===0;)a++;o=o.slice(a)}return o},t.generateECPolynomial=function(n){let r=new Uint8Array([1]);for(let o=0;o<n;o++)r=t.mul(r,new Uint8Array([1,e.exp(o)]));return r}}(Le)),Le}var Me,Ct;function tr(){if(Ct)return Me;Ct=1;const t=er();function e(i){this.genPoly=void 0,this.degree=i,this.degree&&this.initialize(this.degree)}return e.prototype.initialize=function(n){this.degree=n,this.genPoly=t.generateECPolynomial(this.degree)},e.prototype.encode=function(n){if(!this.genPoly)throw new Error("Encoder not initialized");const r=new Uint8Array(n.length+this.degree);r.set(n);const o=t.mod(r,this.genPoly),s=this.degree-o.length;if(s>0){const a=new Uint8Array(this.degree);return a.set(o,s),a}return o},Me=e,Me}var Re={},De={},Ne={},bt;function an(){return bt||(bt=1,Ne.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}),Ne}var ee={},St;function cn(){if(St)return ee;St=1;const t="[0-9]+",e="[A-Z $%*+\\-./:]+";let i="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";i=i.replace(/u/g,"\\u");const n="(?:(?![A-Z0-9 $%*+\\-./:]|"+i+`)(?:.|[\r
]))+`;ee.KANJI=new RegExp(i,"g"),ee.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),ee.BYTE=new RegExp(n,"g"),ee.NUMERIC=new RegExp(t,"g"),ee.ALPHANUMERIC=new RegExp(e,"g");const r=new RegExp("^"+i+"$"),o=new RegExp("^"+t+"$"),s=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return ee.testKanji=function(c){return r.test(c)},ee.testNumeric=function(c){return o.test(c)},ee.testAlphanumeric=function(c){return s.test(c)},ee}var It;function se(){return It||(It=1,function(t){const e=an(),i=cn();t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(o,s){if(!o.ccBits)throw new Error("Invalid mode: "+o);if(!e.isValid(s))throw new Error("Invalid version: "+s);return s>=1&&s<10?o.ccBits[0]:s<27?o.ccBits[1]:o.ccBits[2]},t.getBestModeForData=function(o){return i.testNumeric(o)?t.NUMERIC:i.testAlphanumeric(o)?t.ALPHANUMERIC:i.testKanji(o)?t.KANJI:t.BYTE},t.toString=function(o){if(o&&o.id)return o.id;throw new Error("Invalid mode")},t.isValid=function(o){return o&&o.bit&&o.ccBits};function n(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+r)}}t.from=function(o,s){if(t.isValid(o))return o;try{return n(o)}catch{return s}}}(De)),De}var _t;function nr(){return _t||(_t=1,function(t){const e=ie(),i=sn(),n=et(),r=se(),o=an(),s=7973,a=e.getBCHDigit(s);function c(p,h,y){for(let C=1;C<=40;C++)if(h<=t.getCapacity(C,y,p))return C}function l(p,h){return r.getCharCountIndicator(p,h)+4}function u(p,h){let y=0;return p.forEach(function(C){const M=l(C.mode,h);y+=M+C.getBitsLength()}),y}function d(p,h){for(let y=1;y<=40;y++)if(u(p,y)<=t.getCapacity(y,h,r.MIXED))return y}t.from=function(h,y){return o.isValid(h)?parseInt(h,10):y},t.getCapacity=function(h,y,C){if(!o.isValid(h))throw new Error("Invalid QR Code version");typeof C>"u"&&(C=r.BYTE);const M=e.getSymbolTotalCodewords(h),_=i.getTotalCodewordsCount(h,y),R=(M-_)*8;if(C===r.MIXED)return R;const L=R-l(C,h);switch(C){case r.NUMERIC:return Math.floor(L/10*3);case r.ALPHANUMERIC:return Math.floor(L/11*2);case r.KANJI:return Math.floor(L/13);case r.BYTE:default:return Math.floor(L/8)}},t.getBestVersionForData=function(h,y){let C;const M=n.from(y,n.M);if(Array.isArray(h)){if(h.length>1)return d(h,M);if(h.length===0)return 1;C=h[0]}else C=h;return c(C.mode,C.getLength(),M)},t.getEncodedBits=function(h){if(!o.isValid(h)||h<7)throw new Error("Invalid QR Code version");let y=h<<12;for(;e.getBCHDigit(y)-a>=0;)y^=s<<e.getBCHDigit(y)-a;return h<<12|y}}(Re)),Re}var Pe={},vt;function rr(){if(vt)return Pe;vt=1;const t=ie(),e=1335,i=21522,n=t.getBCHDigit(e);return Pe.getEncodedBits=function(o,s){const a=o.bit<<3|s;let c=a<<10;for(;t.getBCHDigit(c)-n>=0;)c^=e<<t.getBCHDigit(c)-n;return(a<<10|c)^i},Pe}var Fe={},Oe,xt;function or(){if(xt)return Oe;xt=1;const t=se();function e(i){this.mode=t.NUMERIC,this.data=i.toString()}return e.getBitsLength=function(n){return 10*Math.floor(n/3)+(n%3?n%3*3+1:0)},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(n){let r,o,s;for(r=0;r+3<=this.data.length;r+=3)o=this.data.substr(r,3),s=parseInt(o,10),n.put(s,10);const a=this.data.length-r;a>0&&(o=this.data.substr(r),s=parseInt(o,10),n.put(s,a*3+1))},Oe=e,Oe}var Ue,Lt;function ir(){if(Lt)return Ue;Lt=1;const t=se(),e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function i(n){this.mode=t.ALPHANUMERIC,this.data=n}return i.getBitsLength=function(r){return 11*Math.floor(r/2)+6*(r%2)},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(r){let o;for(o=0;o+2<=this.data.length;o+=2){let s=e.indexOf(this.data[o])*45;s+=e.indexOf(this.data[o+1]),r.put(s,11)}this.data.length%2&&r.put(e.indexOf(this.data[o]),6)},Ue=i,Ue}var ke,Mt;function sr(){if(Mt)return ke;Mt=1;const t=se();function e(i){this.mode=t.BYTE,typeof i=="string"?this.data=new TextEncoder().encode(i):this.data=new Uint8Array(i)}return e.getBitsLength=function(n){return n*8},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(i){for(let n=0,r=this.data.length;n<r;n++)i.put(this.data[n],8)},ke=e,ke}var Ke,Rt;function ar(){if(Rt)return Ke;Rt=1;const t=se(),e=ie();function i(n){this.mode=t.KANJI,this.data=n}return i.getBitsLength=function(r){return r*13},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(n){let r;for(r=0;r<this.data.length;r++){let o=e.toSJIS(this.data[r]);if(o>=33088&&o<=40956)o-=33088;else if(o>=57408&&o<=60351)o-=49472;else throw new Error("Invalid SJIS character: "+this.data[r]+`
Make sure your charset is UTF-8`);o=(o>>>8&255)*192+(o&255),n.put(o,13)}},Ke=i,Ke}var Ge={exports:{}},Dt;function cr(){return Dt||(Dt=1,function(t){var e={single_source_shortest_paths:function(i,n,r){var o={},s={};s[n]=0;var a=e.PriorityQueue.make();a.push(n,0);for(var c,l,u,d,p,h,y,C,M;!a.empty();){c=a.pop(),l=c.value,d=c.cost,p=i[l]||{};for(u in p)p.hasOwnProperty(u)&&(h=p[u],y=d+h,C=s[u],M=typeof s[u]>"u",(M||C>y)&&(s[u]=y,a.push(u,y),o[u]=l))}if(typeof r<"u"&&typeof s[r]>"u"){var _=["Could not find a path from ",n," to ",r,"."].join("");throw new Error(_)}return o},extract_shortest_path_from_predecessor_list:function(i,n){for(var r=[],o=n;o;)r.push(o),i[o],o=i[o];return r.reverse(),r},find_path:function(i,n,r){var o=e.single_source_shortest_paths(i,n,r);return e.extract_shortest_path_from_predecessor_list(o,r)},PriorityQueue:{make:function(i){var n=e.PriorityQueue,r={},o;i=i||{};for(o in n)n.hasOwnProperty(o)&&(r[o]=n[o]);return r.queue=[],r.sorter=i.sorter||n.default_sorter,r},default_sorter:function(i,n){return i.cost-n.cost},push:function(i,n){var r={value:i,cost:n};this.queue.push(r),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=e}(Ge)),Ge.exports}var Nt;function lr(){return Nt||(Nt=1,function(t){const e=se(),i=or(),n=ir(),r=sr(),o=ar(),s=cn(),a=ie(),c=cr();function l(_){return unescape(encodeURIComponent(_)).length}function u(_,R,L){const x=[];let H;for(;(H=_.exec(L))!==null;)x.push({data:H[0],index:H.index,mode:R,length:H[0].length});return x}function d(_){const R=u(s.NUMERIC,e.NUMERIC,_),L=u(s.ALPHANUMERIC,e.ALPHANUMERIC,_);let x,H;return a.isKanjiModeEnabled()?(x=u(s.BYTE,e.BYTE,_),H=u(s.KANJI,e.KANJI,_)):(x=u(s.BYTE_KANJI,e.BYTE,_),H=[]),R.concat(L,x,H).sort(function(I,b){return I.index-b.index}).map(function(I){return{data:I.data,mode:I.mode,length:I.length}})}function p(_,R){switch(R){case e.NUMERIC:return i.getBitsLength(_);case e.ALPHANUMERIC:return n.getBitsLength(_);case e.KANJI:return o.getBitsLength(_);case e.BYTE:return r.getBitsLength(_)}}function h(_){return _.reduce(function(R,L){const x=R.length-1>=0?R[R.length-1]:null;return x&&x.mode===L.mode?(R[R.length-1].data+=L.data,R):(R.push(L),R)},[])}function y(_){const R=[];for(let L=0;L<_.length;L++){const x=_[L];switch(x.mode){case e.NUMERIC:R.push([x,{data:x.data,mode:e.ALPHANUMERIC,length:x.length},{data:x.data,mode:e.BYTE,length:x.length}]);break;case e.ALPHANUMERIC:R.push([x,{data:x.data,mode:e.BYTE,length:x.length}]);break;case e.KANJI:R.push([x,{data:x.data,mode:e.BYTE,length:l(x.data)}]);break;case e.BYTE:R.push([{data:x.data,mode:e.BYTE,length:l(x.data)}])}}return R}function C(_,R){const L={},x={start:{}};let H=["start"];for(let A=0;A<_.length;A++){const I=_[A],b=[];for(let g=0;g<I.length;g++){const B=I[g],m=""+A+g;b.push(m),L[m]={node:B,lastCount:0},x[m]={};for(let E=0;E<H.length;E++){const w=H[E];L[w]&&L[w].node.mode===B.mode?(x[w][m]=p(L[w].lastCount+B.length,B.mode)-p(L[w].lastCount,B.mode),L[w].lastCount+=B.length):(L[w]&&(L[w].lastCount=B.length),x[w][m]=p(B.length,B.mode)+4+e.getCharCountIndicator(B.mode,R))}}H=b}for(let A=0;A<H.length;A++)x[H[A]].end=0;return{map:x,table:L}}function M(_,R){let L;const x=e.getBestModeForData(_);if(L=e.from(R,x),L!==e.BYTE&&L.bit<x.bit)throw new Error('"'+_+'" cannot be encoded with mode '+e.toString(L)+`.
 Suggested mode is: `+e.toString(x));switch(L===e.KANJI&&!a.isKanjiModeEnabled()&&(L=e.BYTE),L){case e.NUMERIC:return new i(_);case e.ALPHANUMERIC:return new n(_);case e.KANJI:return new o(_);case e.BYTE:return new r(_)}}t.fromArray=function(R){return R.reduce(function(L,x){return typeof x=="string"?L.push(M(x,null)):x.data&&L.push(M(x.data,x.mode)),L},[])},t.fromString=function(R,L){const x=d(R,a.isKanjiModeEnabled()),H=y(x),A=C(H,L),I=c.find_path(A.map,"start","end"),b=[];for(let g=1;g<I.length-1;g++)b.push(A.table[I[g]].node);return t.fromArray(h(b))},t.rawSplit=function(R){return t.fromArray(d(R,a.isKanjiModeEnabled()))}}(Fe)),Fe}var Pt;function ur(){if(Pt)return Ce;Pt=1;const t=ie(),e=et(),i=jn(),n=Jn(),r=Qn(),o=Zn(),s=Xn(),a=sn(),c=tr(),l=nr(),u=rr(),d=se(),p=lr();function h(A,I){const b=A.size,g=o.getPositions(I);for(let B=0;B<g.length;B++){const m=g[B][0],E=g[B][1];for(let w=-1;w<=7;w++)if(!(m+w<=-1||b<=m+w))for(let S=-1;S<=7;S++)E+S<=-1||b<=E+S||(w>=0&&w<=6&&(S===0||S===6)||S>=0&&S<=6&&(w===0||w===6)||w>=2&&w<=4&&S>=2&&S<=4?A.set(m+w,E+S,!0,!0):A.set(m+w,E+S,!1,!0))}}function y(A){const I=A.size;for(let b=8;b<I-8;b++){const g=b%2===0;A.set(b,6,g,!0),A.set(6,b,g,!0)}}function C(A,I){const b=r.getPositions(I);for(let g=0;g<b.length;g++){const B=b[g][0],m=b[g][1];for(let E=-2;E<=2;E++)for(let w=-2;w<=2;w++)E===-2||E===2||w===-2||w===2||E===0&&w===0?A.set(B+E,m+w,!0,!0):A.set(B+E,m+w,!1,!0)}}function M(A,I){const b=A.size,g=l.getEncodedBits(I);let B,m,E;for(let w=0;w<18;w++)B=Math.floor(w/3),m=w%3+b-8-3,E=(g>>w&1)===1,A.set(B,m,E,!0),A.set(m,B,E,!0)}function _(A,I,b){const g=A.size,B=u.getEncodedBits(I,b);let m,E;for(m=0;m<15;m++)E=(B>>m&1)===1,m<6?A.set(m,8,E,!0):m<8?A.set(m+1,8,E,!0):A.set(g-15+m,8,E,!0),m<8?A.set(8,g-m-1,E,!0):m<9?A.set(8,15-m-1+1,E,!0):A.set(8,15-m-1,E,!0);A.set(g-8,8,1,!0)}function R(A,I){const b=A.size;let g=-1,B=b-1,m=7,E=0;for(let w=b-1;w>0;w-=2)for(w===6&&w--;;){for(let S=0;S<2;S++)if(!A.isReserved(B,w-S)){let N=!1;E<I.length&&(N=(I[E]>>>m&1)===1),A.set(B,w-S,N),m--,m===-1&&(E++,m=7)}if(B+=g,B<0||b<=B){B-=g,g=-g;break}}}function L(A,I,b){const g=new i;b.forEach(function(S){g.put(S.mode.bit,4),g.put(S.getLength(),d.getCharCountIndicator(S.mode,A)),S.write(g)});const B=t.getSymbolTotalCodewords(A),m=a.getTotalCodewordsCount(A,I),E=(B-m)*8;for(g.getLengthInBits()+4<=E&&g.put(0,4);g.getLengthInBits()%8!==0;)g.putBit(0);const w=(E-g.getLengthInBits())/8;for(let S=0;S<w;S++)g.put(S%2?17:236,8);return x(g,A,I)}function x(A,I,b){const g=t.getSymbolTotalCodewords(I),B=a.getTotalCodewordsCount(I,b),m=g-B,E=a.getBlocksCount(I,b),w=g%E,S=E-w,N=Math.floor(g/E),F=Math.floor(m/E),k=F+1,U=N-F,v=new c(U);let K=0;const G=new Array(E),q=new Array(E);let Z=0;const ne=new Uint8Array(A.buffer);for(let X=0;X<E;X++){const Ae=X<S?F:k;G[X]=ne.slice(K,K+Ae),q[X]=v.encode(G[X]),K+=Ae,Z=Math.max(Z,Ae)}const W=new Uint8Array(g);let te=0,$,j;for($=0;$<Z;$++)for(j=0;j<E;j++)$<G[j].length&&(W[te++]=G[j][$]);for($=0;$<U;$++)for(j=0;j<E;j++)W[te++]=q[j][$];return W}function H(A,I,b,g){let B;if(Array.isArray(A))B=p.fromArray(A);else if(typeof A=="string"){let N=I;if(!N){const F=p.rawSplit(A);N=l.getBestVersionForData(F,b)}B=p.fromString(A,N||40)}else throw new Error("Invalid data");const m=l.getBestVersionForData(B,b);if(!m)throw new Error("The amount of data is too big to be stored in a QR Code");if(!I)I=m;else if(I<m)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+m+`.
`);const E=L(I,b,B),w=t.getSymbolSize(I),S=new n(w);return h(S,I),y(S),C(S,I),_(S,b,0),I>=7&&M(S,I),R(S,E),isNaN(g)&&(g=s.getBestMask(S,_.bind(null,S,b))),s.applyMask(g,S),_(S,b,g),{modules:S,version:I,errorCorrectionLevel:b,maskPattern:g,segments:B}}return Ce.create=function(I,b){if(typeof I>"u"||I==="")throw new Error("No input text");let g=e.M,B,m;return typeof b<"u"&&(g=e.from(b.errorCorrectionLevel,e.M),B=l.from(b.version),m=s.from(b.maskPattern),b.toSJISFunc&&t.setToSJISFunction(b.toSJISFunc)),H(I,B,g,m)},Ce}var qe={},He={},Ft;function ln(){return Ft||(Ft=1,function(t){function e(i){if(typeof i=="number"&&(i=i.toString()),typeof i!="string")throw new Error("Color should be defined as hex string");let n=i.slice().replace("#","").split("");if(n.length<3||n.length===5||n.length>8)throw new Error("Invalid hex color: "+i);(n.length===3||n.length===4)&&(n=Array.prototype.concat.apply([],n.map(function(o){return[o,o]}))),n.length===6&&n.push("F","F");const r=parseInt(n.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:r&255,hex:"#"+n.slice(0,6).join("")}}t.getOptions=function(n){n||(n={}),n.color||(n.color={});const r=typeof n.margin>"u"||n.margin===null||n.margin<0?4:n.margin,o=n.width&&n.width>=21?n.width:void 0,s=n.scale||4;return{width:o,scale:o?4:s,margin:r,color:{dark:e(n.color.dark||"#000000ff"),light:e(n.color.light||"#ffffffff")},type:n.type,rendererOpts:n.rendererOpts||{}}},t.getScale=function(n,r){return r.width&&r.width>=n+r.margin*2?r.width/(n+r.margin*2):r.scale},t.getImageWidth=function(n,r){const o=t.getScale(n,r);return Math.floor((n+r.margin*2)*o)},t.qrToImageData=function(n,r,o){const s=r.modules.size,a=r.modules.data,c=t.getScale(s,o),l=Math.floor((s+o.margin*2)*c),u=o.margin*c,d=[o.color.light,o.color.dark];for(let p=0;p<l;p++)for(let h=0;h<l;h++){let y=(p*l+h)*4,C=o.color.light;if(p>=u&&h>=u&&p<l-u&&h<l-u){const M=Math.floor((p-u)/c),_=Math.floor((h-u)/c);C=d[a[M*s+_]?1:0]}n[y++]=C.r,n[y++]=C.g,n[y++]=C.b,n[y]=C.a}}}(He)),He}var Ot;function fr(){return Ot||(Ot=1,function(t){const e=ln();function i(r,o,s){r.clearRect(0,0,o.width,o.height),o.style||(o.style={}),o.height=s,o.width=s,o.style.height=s+"px",o.style.width=s+"px"}function n(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}t.render=function(o,s,a){let c=a,l=s;typeof c>"u"&&(!s||!s.getContext)&&(c=s,s=void 0),s||(l=n()),c=e.getOptions(c);const u=e.getImageWidth(o.modules.size,c),d=l.getContext("2d"),p=d.createImageData(u,u);return e.qrToImageData(p.data,o,c),i(d,l,u),d.putImageData(p,0,0),l},t.renderToDataURL=function(o,s,a){let c=a;typeof c>"u"&&(!s||!s.getContext)&&(c=s,s=void 0),c||(c={});const l=t.render(o,s,c),u=c.type||"image/png",d=c.rendererOpts||{};return l.toDataURL(u,d.quality)}}(qe)),qe}var Ve={},Ut;function dr(){if(Ut)return Ve;Ut=1;const t=ln();function e(r,o){const s=r.a/255,a=o+'="'+r.hex+'"';return s<1?a+" "+o+'-opacity="'+s.toFixed(2).slice(1)+'"':a}function i(r,o,s){let a=r+o;return typeof s<"u"&&(a+=" "+s),a}function n(r,o,s){let a="",c=0,l=!1,u=0;for(let d=0;d<r.length;d++){const p=Math.floor(d%o),h=Math.floor(d/o);!p&&!l&&(l=!0),r[d]?(u++,d>0&&p>0&&r[d-1]||(a+=l?i("M",p+s,.5+h+s):i("m",c,0),c=0,l=!1),p+1<o&&r[d+1]||(a+=i("h",u),u=0)):c++}return a}return Ve.render=function(o,s,a){const c=t.getOptions(s),l=o.modules.size,u=o.modules.data,d=l+c.margin*2,p=c.color.light.a?"<path "+e(c.color.light,"fill")+' d="M0 0h'+d+"v"+d+'H0z"/>':"",h="<path "+e(c.color.dark,"stroke")+' d="'+n(u,l,c.margin)+'"/>',y='viewBox="0 0 '+d+" "+d+'"',M='<svg xmlns="http://www.w3.org/2000/svg" '+(c.width?'width="'+c.width+'" height="'+c.width+'" ':"")+y+' shape-rendering="crispEdges">'+p+h+`</svg>
`;return typeof a=="function"&&a(null,M),M},Ve}var kt;function hr(){if(kt)return ae;kt=1;const t=$n(),e=ur(),i=fr(),n=dr();function r(o,s,a,c,l){const u=[].slice.call(arguments,1),d=u.length,p=typeof u[d-1]=="function";if(!p&&!t())throw new Error("Callback required as last argument");if(p){if(d<2)throw new Error("Too few arguments provided");d===2?(l=a,a=s,s=c=void 0):d===3&&(s.getContext&&typeof l>"u"?(l=c,c=void 0):(l=c,c=a,a=s,s=void 0))}else{if(d<1)throw new Error("Too few arguments provided");return d===1?(a=s,s=c=void 0):d===2&&!s.getContext&&(c=a,a=s,s=void 0),new Promise(function(h,y){try{const C=e.create(a,c);h(o(C,s,c))}catch(C){y(C)}})}try{const h=e.create(a,c);l(null,o(h,s,c))}catch(h){l(h)}}return ae.create=e.create,ae.toCanvas=r.bind(null,i.render),ae.toDataURL=r.bind(null,i.renderToDataURL),ae.toString=r.bind(null,function(o,s,a){return n.render(o,a)}),ae}var gr=hr();const pr=Yn(gr);function yr(t){return t instanceof DOMException||t.message&&(t.message.includes("Cannot decrypt")||t.message.includes("tag")||t.message.includes("Invalid password")||t.message.includes("key.usages"))}function un(t){if(t===null||typeof t!="object"||Array.isArray(t))return t;const e={};return Object.keys(t).sort().forEach(i=>{e[i]=un(t[i])}),e}function fn(t){const e=t.keyDerivation,i={version:t.version,keyDerivation:{name:e.name,iterations:e.iterations,memory:e.memory,parallelism:e.parallelism,hash:e.hash},encryptionName:t.encryption.name};Object.keys(i).forEach(r=>i[r]===void 0&&delete i[r]),Object.keys(i.keyDerivation).forEach(r=>i.keyDerivation[r]===void 0&&delete i.keyDerivation[r]);const n=un(i);return new TextEncoder().encode(JSON.stringify(n))}async function Ze(t,e){const i=J.toUint8Array(e.salt);if(e.name===T.KDF_ARGON2){if(!await V.checkArgon2Ready())throw new Error("Argon2 函式庫未成功載入，無法執行。請檢查網路連線或瀏覽器控制台。");return(await window.argon2.hash({pass:t,salt:i,time:e.iterations,mem:e.memory,parallelism:e.parallelism,hashLen:32,type:window.argon2.ArgonType.Argon2id})).hash}if(e.name===T.KDF_PBKDF2){const n=await crypto.subtle.importKey("raw",new TextEncoder().encode(t),{name:T.KDF_PBKDF2},!1,["deriveKey","deriveBits"]),r=e.purpose===T.OP_ENCRYPT?["encrypt"]:["decrypt"];if(e.cipher===T.ALGO_AES_GCM)return await crypto.subtle.deriveKey({name:T.KDF_PBKDF2,salt:i,iterations:e.iterations,hash:T.HASH_SHA256},n,{name:T.ALGO_AES_GCM,length:T.KEY_LENGTH_BITS},!1,r);{const o=await crypto.subtle.deriveBits({name:T.KDF_PBKDF2,salt:i,iterations:e.iterations,hash:T.HASH_SHA256},n,T.KEY_LENGTH_BITS);return new Uint8Array(o)}}throw new Error("不支援的密鑰衍生演算法。")}async function Kt(t,e,i,n){const r=crypto.getRandomValues(new Uint8Array(T.SALT_BYTES));let o,s,a;n===T.KDF_ARGON2?(o={name:T.KDF_ARGON2,salt:J.fromUint8Array(r,!0),iterations:parseInt(f.argon2Iterations.value,10),memory:parseInt(f.argon2Memory.value,10)*1024,parallelism:parseInt(f.argon2Parallelism.value,10)},s=await Ze(e,o),a={name:o.name,iterations:o.iterations,memory:o.memory,parallelism:o.parallelism}):(o={name:T.KDF_PBKDF2,salt:J.fromUint8Array(r,!0),iterations:T.PBKDF2_ITERATIONS,purpose:T.OP_ENCRYPT,cipher:i},s=await Ze(e,o),a={name:T.KDF_PBKDF2,iterations:o.iterations,hash:T.HASH_SHA256});const c={version:T.VERSION,keyDerivation:{...a},encryption:{name:i}},l=fn(c);let u;const d=crypto.getRandomValues(new Uint8Array(T.NONCE_BYTES));if(i===T.ALGO_AES_GCM){const h=s instanceof CryptoKey?s:await crypto.subtle.importKey("raw",s,{name:T.ALGO_AES_GCM},!1,["encrypt"]),y=await crypto.subtle.encrypt({name:T.ALGO_AES_GCM,iv:d,tagLength:T.TAG_LENGTH_BITS,additionalData:l},h,t),C=y.slice(0,y.byteLength-T.TAG_BYTES),M=y.slice(y.byteLength-T.TAG_BYTES);u={name:T.ALGO_AES_GCM,nonce:J.fromUint8Array(d,!0),ciphertext:J.fromUint8Array(new Uint8Array(C),!0),tag:J.fromUint8Array(new Uint8Array(M),!0)}}else{const y=zt(s,d,l).encrypt(new Uint8Array(t)),C=y.slice(0,y.length-T.TAG_BYTES),M=y.slice(y.length-T.TAG_BYTES);u={name:T.ALGO_CHACHA,nonce:J.fromUint8Array(d,!0),ciphertext:J.fromUint8Array(C,!0),tag:J.fromUint8Array(M,!0)}}const p={version:T.VERSION,keyDerivation:{...a,salt:J.fromUint8Array(r,!0)},encryption:u};return{finalBase64:J.encode(JSON.stringify(p),!0),jsonOutput:p}}async function me(t,e){const i=J.decode(t),n=JSON.parse(i);if(!n.keyDerivation||!n.encryption||n.version!==T.VERSION)throw new Error("無效或不支援的密文格式 (僅支援 v3.0)。");const r={name:n.keyDerivation.name,salt:n.keyDerivation.salt,iterations:n.keyDerivation.iterations,memory:n.keyDerivation.memory,parallelism:n.keyDerivation.parallelism,purpose:T.OP_DECRYPT,cipher:n.encryption.name},o=await Ze(e,r),s=n.encryption,a=fn(n),c=J.toUint8Array(s.nonce),l=J.toUint8Array(s.ciphertext),u=J.toUint8Array(s.tag);try{if(s.name===T.ALGO_AES_GCM){const d=o instanceof CryptoKey?o:await crypto.subtle.importKey("raw",o,{name:T.ALGO_AES_GCM},!1,["decrypt"]),p=new Uint8Array(l.length+u.length);return p.set(l,0),p.set(u,l.length),await crypto.subtle.decrypt({name:T.ALGO_AES_GCM,iv:c,tagLength:T.TAG_LENGTH_BITS,additionalData:a},d,p)}else if(s.name===T.ALGO_CHACHA){const d=o instanceof Uint8Array?o:await crypto.subtle.exportKey("raw",o),p=new Uint8Array(l.length+u.length);return p.set(l),p.set(u,l.length),zt(d,c,a).decrypt(p)}throw new Error("不支援的解密演算法。")}catch(d){throw yr(d)?new Error("密碼短語不正確，或密文已被竄改。"):d}}const de={async encryptText(){const t=f.mnemonic.value.trim(),e=f.passphraseEncrypt.value;if(!t||!e)return V.showToast("❌ 明文和密碼短語不能為空。");if(!V.runSecurityChecks(e,D.selectedKDF))return;O.setOutput("info","⏳ 正在加密，請稍候..."),await new Promise(n=>setTimeout(n,50));const i=performance.now();try{const{finalBase64:n,jsonOutput:r}=await Kt(new TextEncoder().encode(t),e,D.selectedAlgorithm,D.selectedKDF),o=((performance.now()-i)/1e3).toFixed(3);if(D.lastEncryptedOutput=n,O.setOutput("success",`✅ 加密成功！ (處理時間：${o} 秒)`),f.selfVerifyCheckbox.checked){O.setOutput("info","✅ 加密成功！<br>...正在進行自我驗證..."),await new Promise(s=>setTimeout(s,20));try{await me(n,e),O.setOutput("success",`✅ 加密與驗證均成功！ (總時間：${((performance.now()-i)/1e3).toFixed(3)} 秒)`)}catch(s){O.setOutput("error",`❌ 嚴重錯誤：加密後驗證失敗！請勿使用此密文，並回報此問題。<br>錯誤訊息：${s.message}`);return}}f.base64ResultView.value=n,f.jsonView.value=JSON.stringify(r,null,2),f.qrCanvas.hidden=n.length>=T.QR_CODE_MAX_BYTES,f.qrCanvas.hidden||pr.toCanvas(f.qrCanvas,n,{errorCorrectionLevel:"L",width:320})}catch(n){O.setOutput("error",`❌ 加密失敗：${n.message}`)}},async decryptText(){const t=f.ciphertextInput.value.trim(),e=f.passphraseDecrypt.value;if(!t||!e)return V.showToast("❌ 密文和密碼短語不能為空。");O.setOutput("info","⏳ 正在解密，請稍候..."),await new Promise(n=>setTimeout(n,50));const i=performance.now();try{const n=await me(t,e),r=((performance.now()-i)/1e3).toFixed(3),o=new TextDecoder().decode(n);D.lastDecryptedText=o;let s=`✅ 解密成功 (處理時間：${r} 秒)<br><br><strong style="font-size: 1.1em; white-space: pre-wrap; word-break: break-word;">${o}</strong>`;O.setOutput("success",s)}catch(n){O.setOutput("error",`❌ 解密失敗：${n.message}`)}},async encryptFile(){const t=D.fileToEncrypt,e=f.passphraseFileEncrypt.value;if(!t||!e)return V.showToast("❌ 請選擇檔案並輸入密碼短語。");const i=T.KDF_ARGON2;if(!V.runSecurityChecks(e,i,!0))return;O.setOutput("info",`⏳ 正在使用 ${i} 加密檔案 ${t.name}，請稍候...`),await new Promise(r=>setTimeout(r,50));const n=performance.now();try{const r=await Ee.readFileAsArrayBuffer(t),{finalBase64:o}=await Kt(r,e,D.selectedAlgorithm,i);let s=((performance.now()-n)/1e3).toFixed(3);if(O.setOutput("success",`✅ 檔案加密成功！ (處理時間：${s} 秒)`),f.selfVerifyFileCheckbox.checked){O.setOutput("info","✅ 檔案加密成功！<br>...正在進行自我驗證..."),await new Promise(a=>setTimeout(a,20));try{await me(o,e),s=((performance.now()-n)/1e3).toFixed(3),O.setOutput("success",`✅ 檔案加密與驗證均成功！已開始下載。 (總時間: ${s} 秒)`)}catch(a){O.setOutput("error",`❌ 嚴重錯誤：檔案加密後驗證失敗！請勿使用此檔案。<br>錯誤訊息：${a.message}`);return}}V.downloadAsFile(o,t.name+".enc"),f.selfVerifyFileCheckbox.checked||O.setOutput("success",`✅ 檔案加密成功！已開始下載 ${t.name+".enc"} (處理時間：${s} 秒)`)}catch(r){O.setOutput("error",`❌ 檔案加密失敗：${r.message}`)}},async decryptFile(){const t=D.fileToDecrypt,e=f.passphraseFileDecrypt.value;if(!t||!e)return V.showToast("❌ 請選擇檔案並輸入密碼短語。");O.setOutput("info",`⏳ 正在解密檔案 ${t.name}，請稍候...`),await new Promise(n=>setTimeout(n,50));const i=performance.now();try{const n=await Ee.readFileAsText(t),r=await me(n,e),o=((performance.now()-i)/1e3).toFixed(3),s=t.name.endsWith(".enc")?t.name.slice(0,-4):`decrypted-${t.name}`;V.downloadAsFile(new Blob([r]),s);let a=`✅ 檔案解密成功！已開始下載 ${s} (處理時間：${o} 秒)`;O.setOutput("success",a)}catch(n){O.setOutput("error",`❌ 解密失敗：${n.message}`)}},async parseParameters(){const t=f.ciphertextInput.value.trim();if(!t)return V.showToast("請先貼上密文");try{const e=JSON.parse(J.decode(t)),i=e.keyDerivation,n=e.encryption;if(!i||!n)throw new Error("JSON 結構不符");let r=`${i.name}`;i.name===T.KDF_PBKDF2?r+=` (${i.hash}, ${i.iterations.toLocaleString("en-US")} 迭代)`:i.name===T.KDF_ARGON2&&(r+=` (mem: ${i.memory/1024}MB, iter: ${i.iterations}, parallel: ${i.parallelism})`);const o=e.version===T.VERSION?`v${e.version}`:`不支援的版本 (${e.version})`;f.paramsDisplayArea.innerHTML=`<p>格式版本：<span>${o}</span></p><p>金鑰衍生：<span>${r}</span></p><p>加密演算法：<span>${n.name}</span></p><p style="color: var(--success-color);">狀態：<span>參數已載入 ✅</span></p>`,f.paramsDisplayArea.hidden=!1}catch{f.paramsDisplayArea.innerHTML='<p style="color: var(--error-color);">❌ 解析失敗：無效的密文格式。</p>',f.paramsDisplayArea.hidden=!1}}},Gt={init(){const t=localStorage.getItem("my-app-theme")||"dark";this.apply(t)},apply(t){document.documentElement.setAttribute("data-theme",t),f.themeToggleBtn.textContent=t==="dark"?"☀️":"🌙",localStorage.setItem("my-app-theme",t)},toggle(){const t=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";this.apply(t)}},mr={toggle(t){const e=t.classList.contains("active");t.classList.toggle("active"),t.setAttribute("aria-expanded",!e),t.nextElementSibling.setAttribute("aria-hidden",e)}},wr={async run(){if(!await V.checkArgon2Ready())return V.showToast("❌ Argon2 函式庫未就緒，無法測試。");f.benchmarkBtn.disabled=!0,f.encryptBtn.disabled=!0,f.benchmarkStatus.textContent="⏱️ 正在執行基準測試，請稍候...";try{const i=navigator.hardwareConcurrency||4,n=[1024,512,256,128,64,32];let r=256;for(const o of n){const s=o*1024,a=performance.now();if(await window.argon2.hash({pass:"benchmark",salt:"benchmark-salt",time:4,mem:s,parallelism:i,hashLen:32,type:window.argon2.ArgonType.Argon2id}),performance.now()-a<1e3){r=o;break}await new Promise(l=>setTimeout(l,50))}f.argon2Memory.value=r,f.argon2Iterations.value=4,f.argon2Parallelism.value=i,f.benchmarkStatus.textContent="✅ 測試完成！",V.showToast("✅ 建議參數已產生並填入！")}catch(t){f.benchmarkStatus.textContent="❌ 測試失敗",V.showToast(`❌ 基準測試失敗: ${t.message}`)}finally{f.benchmarkBtn.disabled=!1,f.encryptBtn.disabled=!1,setTimeout(()=>{f.benchmarkStatus.textContent=""},4e3)}}};function Er(){f.currentYear.textContent=new Date().getFullYear(),Gt.init(),D.currentAppMode=T.MODE_TEXT,D.selectedAlgorithm=T.ALGO_AES_GCM,D.selectedKDF=T.KDF_ARGON2,O.setAppMode(D.currentAppMode),V.checkArgon2Ready(),f.themeToggleBtn.addEventListener("click",()=>Gt.toggle()),f.scrollTopBtn.addEventListener("click",()=>window.scrollTo({top:0,behavior:"smooth"})),window.addEventListener("scroll",()=>f.scrollTopBtn.classList.toggle("active",window.scrollY>300)),f.appModeSelector.addEventListener("click",e=>{const i=e.target.closest(".option");i?.dataset.appMode&&O.setAppMode(i.dataset.appMode)}),f.modeSelector.addEventListener("click",e=>{const i=e.target.closest(".option");i?.dataset.mode&&O.setMode(i.dataset.mode)}),f.algoSelectionGroup.addEventListener("click",e=>O.handleOptionSelection(e,"selectedAlgorithm")),f.kdfSelectionGroup.addEventListener("click",e=>{O.handleOptionSelection(e,"selectedKDF")&&O.toggleArgon2Params(D.selectedKDF===T.KDF_ARGON2)}),f.passphraseEncrypt.addEventListener("input",e=>O.updatePasswordStrength(e.target.value,"encrypt")),f.passphraseFileEncrypt.addEventListener("input",e=>O.updatePasswordStrength(e.target.value,"file")),f.encryptBtn.addEventListener("click",()=>de.encryptText()),f.decryptBtn.addEventListener("click",()=>de.decryptText()),f.parseBtn.addEventListener("click",()=>de.parseParameters()),f.benchmarkBtn.addEventListener("click",()=>wr.run()),f.fileEncryptInput.addEventListener("change",e=>Ee.handleFileSelect(e,T.OP_ENCRYPT)),f.fileDecryptInput.addEventListener("change",e=>Ee.handleFileSelect(e,T.OP_DECRYPT)),f.encryptFileBtn.addEventListener("click",()=>de.encryptFile()),f.decryptFileBtn.addEventListener("click",()=>de.decryptFile()),f.resetBtn.addEventListener("click",()=>O.resetAll()),f.pasteBtn.addEventListener("click",()=>V.pasteTo("ciphertextInput")),f.copyBtn.addEventListener("click",()=>V.copyFromResult()),f.copyDecryptedBtn.addEventListener("click",()=>V.copyDecryptedResult()),f.downloadBtn.addEventListener("click",()=>{D.lastEncryptedOutput&&V.downloadAsFile(D.lastEncryptedOutput,`encrypted-v3-${Date.now()}.enc`)}),f.passwordToggles.forEach(e=>{e.innerHTML=T.SVG_EYE_OPEN,e.addEventListener("click",i=>O.togglePasswordVisibility(i.currentTarget))});const t=(e,i)=>{e&&(["dragenter","dragover","dragleave","drop"].forEach(n=>{e.addEventListener(n,r=>{r.preventDefault(),r.stopPropagation()})}),["dragenter","dragover"].forEach(n=>e.addEventListener(n,()=>e.classList.add("drag-over"))),["dragleave","drop"].forEach(n=>e.addEventListener(n,()=>e.classList.remove("drag-over"))),e.addEventListener("drop",n=>{n.dataTransfer.files.length>0&&(i.files=n.dataTransfer.files,i.dispatchEvent(new Event("change",{bubbles:!0})))}))};t(f.fileEncryptInput.closest(".file-input-wrapper"),f.fileEncryptInput),t(f.fileDecryptInput.closest(".file-input-wrapper"),f.fileDecryptInput),f.accordionContainer&&f.accordionContainer.addEventListener("click",e=>{const i=e.target.closest(".accordion-header");i&&mr.toggle(i)})}document.addEventListener("DOMContentLoaded",Er);
