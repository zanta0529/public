<!DOCTYPE html>
<html lang="zh-Hant" data-theme="dark">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ÊñáÂ≠óÂ£ìÁ∏Æ/Ëß£Â£ìÁ∏ÆÂ∑•ÂÖ∑</title>
        <style>
            /* --- CSS ËÆäÊï∏ÂÆöÁæ© (Ê∑∫Ëâ≤ & Ê∑±Ëâ≤‰∏ªÈ°å) --- */
            :root {
                /* Ê∑∫Ëâ≤‰∏ªÈ°å (Light Theme) */
                --primary-color: #007bff;
                --primary-hover-color: #0056b3;
                --secondary-color: #6c757d;
                --bg-color: #f8f9fa;
                --container-bg: #ffffff;
                --text-color: #212529;
                --border-color: #ced4da;
                --input-bg: #c3ddbf;
                --input-focus-shadow: rgba(0, 123, 255, 0.25);
                --stats-bg: #e9ecef;
                --stats-text: #495057;
                --stats-strong-text: var(--primary-hover-color);
                --button-copy-bg: #28a745;
                --button-copy-hover-bg: #218838;
                --button-disabled-bg: #ccc;
                --box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.07);
            }

            :root[data-theme="dark"] {
                /* Ê∑±Ëâ≤‰∏ªÈ°å (Dark Theme) - ÂèÉËÄÉ decrypt_text.html */
                --primary-color: #1e90ff;
                --primary-hover-color: #4ca8ff;
                --secondary-color: #778899;
                --bg-color: #1e1e2f;
                --container-bg: #2f2f4f;
                --text-color: #e8e8f0;
                --border-color: #4a4a5f;
                --input-bg: #444;
                --input-focus-shadow: rgba(30, 144, 255, 0.4);
                --stats-bg: #252540;
                --stats-text: #c0c0e0;
                --stats-strong-text: var(--primary-color);
                --button-copy-bg: #2a9d8f;
                --button-copy-hover-bg: #268c7f;
                --button-disabled-bg: #5a5a70;
                --box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            }

            /* --- Âü∫Á§é & ‰ΩàÂ±ÄÊ®£Âºè --- */
            body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
                margin: 0;
                padding: 2rem;
                background-color: var(--bg-color);
                color: var(--text-color);
                line-height: 1.6;
                display: flex;
                flex-direction: column;
                align-items: center;
                min-height: 100vh;
                box-sizing: border-box;
                transition: background-color 0.3s, color 0.3s;
            }

            .container {
                background-color: var(--container-bg);
                padding: 2rem;
                border-radius: 0.5rem;
                box-shadow: var(--box-shadow);
                width: 100%;
                max-width: 80%;
                margin-bottom: 2rem;
                box-sizing: border-box;
                border: 1px solid var(--border-color);
                transition: background-color 0.3s, border-color 0.3s;
            }

            h1 {
                text-align: center;
                color: var(--text-color);
                margin-bottom: 2rem;
                font-weight: 700;
            }

            /* --- Ê®°ÂºèÈÅ∏ÊìáÂô® --- */
            .mode-selector {
                display: flex;
                justify-content: center;
                gap: 1rem;
                margin-bottom: 1.5rem;
            }

            .mode-selector label {
                background-color: var(--input-bg);
                padding: 0.75rem 1.25rem;
                border-radius: 0.5rem;
                border: 1px solid var(--border-color);
                cursor: pointer;
                transition: background-color 0.2s ease, transform 0.1s ease, border-color 0.2s;
                display: flex;
                align-items: center;
                gap: 0.5rem;
                font-weight: 500;
            }

            .mode-selector input[type="radio"]:checked + label {
                background-color: var(--primary-color);
                color: white;
                border-color: var(--primary-color);
                transform: translateY(-2px);
            }

            .mode-selector input[type="radio"] {
                display: none; /* Hide the actual radio button */
            }

            /* --- Ë°®ÂñÆ & Ëº∏ÂÖ•Ê°Ü --- */
            .form-group {
                margin-bottom: 1rem;
            }

            label {
                display: block;
                margin-bottom: 0.5rem;
                font-weight: 600;
            }

            textarea {
                width: 100%;
                min-height: 200px;
                padding: 0.75rem;
                border: 1px solid var(--border-color);
                border-radius: 0.5rem;
                font-size: 1em;
                resize: vertical;
                box-sizing: border-box;
                background-color: var(--input-bg);
                color: var(--text-color);
                transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.3s;
            }

            textarea:focus {
                border-color: var(--primary-color);
                box-shadow: 0 0 0 0.2rem var(--input-focus-shadow);
                outline: none;
            }

            /* --- ÊåâÈàïÁæ§ÁµÑ --- */
            .button-group {
                display: flex;
                gap: 1rem;
                margin-top: 1rem;
                margin-bottom: 1rem;
            }

            .button-group button {
                flex: 1;
                padding: 0.75rem 1.5rem;
                background-color: var(--primary-color);
                color: white;
                border: none;
                border-radius: 0.5rem;
                cursor: pointer;
                font-size: 1.1em;
                font-weight: 600;
                transition: background-color 0.3s ease, transform 0.1s ease;
                box-sizing: border-box;
            }

            .button-group button:hover:not(:disabled) {
                background-color: var(--primary-hover-color);
                transform: translateY(-2px);
            }
            .button-group button:disabled {
                background-color: var(--button-disabled-bg);
                cursor: not-allowed;
                opacity: 0.7;
            }

            #copyButton {
                background-color: var(--button-copy-bg);
            }

            #copyButton:hover:not(:disabled) {
                background-color: var(--button-copy-hover-bg);
            }

            /* --- Áµ±Ë®à & È†ÅÂ∞æ --- */
            .stats {
                margin-top: 1.5rem;
                font-size: 0.95em;
                background-color: var(--stats-bg);
                padding: 1rem;
                border-radius: 0.5rem;
                border: 1px solid var(--border-color);
                color: var(--stats-text);
                transition: background-color 0.3s, border-color 0.3s;
            }

            .stats p {
                margin: 0.5rem 0;
            }
            .stats span {
                font-weight: 700;
                color: var(--stats-strong-text);
            }

            footer {
                margin-top: 2rem;
                padding-top: 1.5rem;
                border-top: 1px solid var(--border-color);
                width: 100%;
                max-width: 1024px;
                box-sizing: border-box;
                text-align: center;
                color: var(--secondary-color);
                font-size: 0.9em;
                transition: border-color 0.3s;
            }

            #themeToggleBtn {
                /* */
                background: none;
                border: 1px solid var(--border-color);
                color: var(--text-color);
                padding: 5px 10px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 1.2em;
                margin-left: 10px;
                vertical-align: middle;
                transition: background-color 0.3s, border-color 0.3s;
            }

            #themeToggleBtn:hover {
                background-color: var(--border-color);
            }

            /* --- ÈüøÊáâÂºèË®≠Ë®à --- */
            @media (max-width: 600px) {
                body {
                    padding: 1rem;
                }
                .container {
                    padding: 1rem;
                }
                .mode-selector {
                    flex-direction: column;
                    gap: 0.5rem;
                }
                .button-group {
                    flex-direction: column;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ÊñáÂ≠óÂ£ìÁ∏Æ / Ëß£Â£ìÁ∏ÆÂ∑•ÂÖ∑</h1>

            <div class="mode-selector">
                <input type="radio" id="compressMode" name="mode" value="compress" checked />
                <label for="compressMode">Â£ìÁ∏ÆÊ®°Âºè</label>

                <input type="radio" id="decompressMode" name="mode" value="decompress" />
                <label for="decompressMode">Ëß£Â£ìÁ∏ÆÊ®°Âºè</label>
            </div>

            <div class="form-group">
                <label for="inputText">Ëº∏ÂÖ•ÊñáÂ≠ó</label>
                <textarea id="inputText" placeholder="Âú®Ê≠§Ëº∏ÂÖ•ÊñáÂ≠ó..."></textarea>
            </div>

            <div class="button-group">
                <button id="actionButton">Â£ìÁ∏Æ</button>
            </div>

            <div class="form-group">
                <label for="outputText">ÁµêÊûú</label>
                <textarea id="outputText" readonly placeholder="ÁµêÊûúÂ∞áÈ°ØÁ§∫Âú®Ê≠§..."></textarea>
            </div>

            <div class="button-group">
                <button id="copyButton" disabled>Ë§áË£ΩÁµêÊûú</button>
            </div>

            <div id="stats" class="stats" role="status" aria-live="polite" style="display: none">
                <p>ÁµêÊûúÂ§ßÂ∞èÔºö<span id="resultSize">0</span> characters</p>
                <p>ÂéüÂßãÂ§ßÂ∞èÔºö<span id="originalSize">0</span> bytes</p>
                <p>Â£ìÁ∏ÆÊØîÁéáÔºö<span id="compressionRatio">N/A</span>ÔºàÁµêÊûúÂ§ßÂ∞è/ÂéüÂßãÂ§ßÂ∞èÔºâ</p>
            </div>
        </div>

        <footer>
            <p>
                &copy; <span id="currentYear"></span> Zanta's Tools Enhanced
                <button id="themeToggleBtn" title="ÂàáÊèõ‰∏ªÈ°å">üåô</button>
            </p>
        </footer>

        <script>
            // --- DOM ÂÖÉÁ¥†ÂºïÁî® ---
            const inputText = document.getElementById("inputText");
            const outputText = document.getElementById("outputText");
            const actionButton = document.getElementById("actionButton");
            const copyButton = document.getElementById("copyButton");
            const modeRadios = document.querySelectorAll('input[name="mode"]');
            const statsDiv = document.getElementById("stats");
            const originalSizeSpan = document.getElementById("originalSize");
            const resultSizeSpan = document.getElementById("resultSize");
            const compressionRatioSpan = document.getElementById("compressionRatio");
            const themeToggleBtn = document.getElementById("themeToggleBtn");
            document.getElementById("currentYear").textContent = new Date().getFullYear();

            let currentMode = "compress";

            // --- Ê†∏ÂøÉÂäüËÉΩ (Â£ìÁ∏Æ/Ëß£Â£ìÁ∏Æ) ---
            async function streamToUint8Array(readableStream) {
                const reader = readableStream.getReader();
                const chunks = [];
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    chunks.push(value);
                }
                const blob = new Blob(chunks);
                return new Uint8Array(await blob.arrayBuffer());
            }

            async function compressText(text) {
                if (!text) {
                    outputText.value = "ÈåØË™§ÔºöËº∏ÂÖ•ÊñáÂ≠ó‰∏çËÉΩÁÇ∫Á©∫„ÄÇ";
                    statsDiv.style.display = "none";
                    copyButton.disabled = true;
                    return;
                }
                actionButton.disabled = true;
                actionButton.textContent = "Â£ìÁ∏Æ‰∏≠...";
                copyButton.disabled = true;

                try {
                    const data = new TextEncoder().encode(text);
                    const compressionStream = new CompressionStream("gzip");
                    const writer = compressionStream.writable.getWriter();
                    writer.write(data);
                    writer.close();
                    const compressedData = await streamToUint8Array(compressionStream.readable);
                    const base64Encoded = btoa(String.fromCharCode.apply(null, compressedData));

                    outputText.value = base64Encoded;
                    copyButton.disabled = false;

                    const originalByteLength = data.byteLength;
                    const resultCharLength = base64Encoded.length;
                    originalSizeSpan.textContent = originalByteLength;
                    resultSizeSpan.textContent = resultCharLength;
                    compressionRatioSpan.textContent =
                        originalByteLength > 0
                            ? `${((resultCharLength / originalByteLength) * 100).toFixed(2)}%`
                            : "N/A";
                    statsDiv.style.display = "block";
                } catch (error) {
                    console.error("Â£ìÁ∏ÆÈåØË™§:", error);
                    outputText.value = `Â£ìÁ∏ÆÈåØË™§: ${error.message}`;
                    statsDiv.style.display = "none";
                    copyButton.disabled = true;
                } finally {
                    actionButton.disabled = false;
                    actionButton.textContent = "Â£ìÁ∏Æ";
                }
            }

            async function decompressText(base64Text) {
                if (!base64Text) {
                    outputText.value = "ÈåØË™§ÔºöËº∏ÂÖ•ÊñáÂ≠ó‰∏çËÉΩÁÇ∫Á©∫„ÄÇ";
                    copyButton.disabled = true;
                    return;
                }
                actionButton.disabled = true;
                actionButton.textContent = "Ëß£Â£ìÁ∏Æ‰∏≠...";
                copyButton.disabled = true;

                try {
                    const binaryString = atob(base64Text);
                    const compressedData = Uint8Array.from(binaryString, (char) => char.charCodeAt(0));
                    const decompressionStream = new DecompressionStream("gzip");
                    const writer = decompressionStream.writable.getWriter();
                    writer.write(compressedData);
                    writer.close();
                    const decompressedData = await streamToUint8Array(decompressionStream.readable);
                    const originalText = new TextDecoder().decode(decompressedData);

                    outputText.value = originalText;
                    copyButton.disabled = false;
                    statsDiv.style.display = "none";
                } catch (error) {
                    console.error("Ëß£Â£ìÁ∏ÆÈåØË™§:", error);
                    outputText.value = `Ëß£Â£ìÁ∏ÆÈåØË™§: ${error.message}. Ë´ãÁ¢∫Ë™çËº∏ÂÖ•ÁöÑÊòØÊúâÊïàÁöÑ Base64 Á∑®Á¢º Gzip Â£ìÁ∏ÆÂ≠ó‰∏≤„ÄÇ`;
                    statsDiv.style.display = "none";
                    copyButton.disabled = true;
                } finally {
                    actionButton.disabled = false;
                    actionButton.textContent = "Ëß£Â£ìÁ∏Æ";
                }
            }

            // --- ‰∫ã‰ª∂ËôïÁêÜ ---
            function handleModeChange() {
                currentMode = document.querySelector('input[name="mode"]:checked').value;
                inputText.value = "";
                outputText.value = "";
                statsDiv.style.display = "none";
                copyButton.disabled = true;

                if (currentMode === "compress") {
                    actionButton.textContent = "Â£ìÁ∏Æ";
                    inputText.placeholder = "Âú®Ê≠§Ëº∏ÂÖ•Ë¶ÅÂ£ìÁ∏ÆÁöÑÊñáÂ≠ó...";
                    outputText.placeholder = "Â£ìÁ∏ÆÂæåÁöÑ Base64 ÁµêÊûúÂ∞áÈ°ØÁ§∫Âú®Ê≠§...";
                } else {
                    actionButton.textContent = "Ëß£Â£ìÁ∏Æ";
                    inputText.placeholder = "Âú®Ê≠§Ë≤º‰∏ä Base64 Á∑®Á¢ºÁöÑÂ£ìÁ∏ÆÊñáÂ≠ó...";
                    outputText.placeholder = "Ëß£Â£ìÁ∏ÆÂæåÁöÑÂéüÂßãÊñáÂ≠óÂ∞áÈ°ØÁ§∫Âú®Ê≠§...";
                }
            }

            function handleActionButtonClick() {
                const text = inputText.value.trim();
                if (currentMode === "compress") {
                    compressText(text);
                } else {
                    decompressText(text);
                }
            }

            async function copyOutputText() {
                if (!outputText.value) return;
                try {
                    await navigator.clipboard.writeText(outputText.value);
                    alert("ÁµêÊûúÂ∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÔºÅ");
                } catch (err) {
                    console.error("ÁÑ°Ê≥ïË§áË£ΩÊñáÂ≠ó: ", err);
                    alert("Ë§áË£ΩÂ§±ÊïóÔºåË´ãÊâãÂãïË§áË£Ω„ÄÇ");
                }
            }

            // --- ‰∏ªÈ°åÂàáÊèõÈÇèËºØ (‰æÜËá™ decrypt_text.html) ---
            function applyTheme(theme) {
                document.documentElement.setAttribute("data-theme", theme);
                themeToggleBtn.textContent = theme === "dark" ? "‚òÄÔ∏è" : "üåô";
                localStorage.setItem("theme", theme);
            }

            function toggleTheme() {
                const currentTheme = document.documentElement.getAttribute("data-theme") || "dark";
                const newTheme = currentTheme === "dark" ? "light" : "dark";
                applyTheme(newTheme);
            }

            // --- ‰∫ã‰ª∂Áõ£ËÅΩÂô® ---
            actionButton.addEventListener("click", handleActionButtonClick);
            copyButton.addEventListener("click", copyOutputText);
            modeRadios.forEach((radio) => {
                radio.addEventListener("change", handleModeChange);
            });
            themeToggleBtn.addEventListener("click", toggleTheme); // Êñ∞Â¢û

            // --- ÂàùÂßãË®≠ÂÆö ---
            document.addEventListener("DOMContentLoaded", () => {
                // ÂàùÂßãÂåñÊ®°ÂºèÈÅ∏ÊìáÂô®
                handleModeChange();

                // ÂàùÂßãÂåñ‰∏ªÈ°å
                let initialTheme = localStorage.getItem("theme");
                if (!initialTheme) {
                    initialTheme = "dark"; // È†êË®≠ÁÇ∫Ê∑±Ëâ≤Ê®°Âºè
                }
                applyTheme(initialTheme);
            });
        </script>
    </body>
</html>
