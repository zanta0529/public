<!DOCTYPE html>

<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ å¯†è³‡æ–™è§£ç¢¼å™¨</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

```
    .container {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        backdrop-filter: blur(10px);
    }

    h1 {
        text-align: center;
        color: #4a5568;
        margin-bottom: 30px;
        font-size: 2.2em;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .form-group {
        margin-bottom: 25px;
    }

    label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #2d3748;
        font-size: 1.1em;
    }

    textarea {
        width: 100%;
        padding: 15px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 14px;
        font-family: 'Courier New', monospace;
        resize: vertical;
        transition: border-color 0.3s ease;
    }

    textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    input[type="password"] {
        width: 100%;
        padding: 15px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s ease;
    }

    input[type="password"]:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        margin: 8px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    button:active {
        transform: translateY(0);
    }

    button:disabled {
        background: #a0aec0;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    .params-display {
        background: #f7fafc;
        padding: 20px;
        border-radius: 8px;
        border-left: 4px solid #667eea;
        margin: 20px 0;
        font-family: 'Courier New', monospace;
        white-space: pre-wrap;
        word-break: break-all;
    }

    .result {
        background: #f0fff4;
        padding: 20px;
        border-radius: 8px;
        border-left: 4px solid #38a169;
        margin: 20px 0;
        font-family: 'Courier New', monospace;
        white-space: pre-wrap;
        word-break: break-all;
    }

    .error {
        background: #fed7d7;
        color: #c53030;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #e53e3e;
        margin: 20px 0;
    }

    .status {
        margin: 10px 0;
        padding: 10px;
        border-radius: 6px;
        font-weight: 500;
    }

    .status.success {
        background: #c6f6d5;
        color: #22543d;
    }

    .status.info {
        background: #bee3f8;
        color: #2a4365;
    }

    .button-group {
        text-align: center;
        margin: 20px 0;
    }

    .param-item {
        margin: 8px 0;
        padding: 8px 12px;
        background: white;
        border-radius: 6px;
        border: 1px solid #e2e8f0;
    }

    .param-label {
        font-weight: 600;
        color: #2d3748;
        margin-right: 10px;
    }

    .param-value {
        color: #4a5568;
        word-break: break-all;
    }
</style>

</head>
<body>
    <div class="container">
        <h1>ğŸ” åŠ å¯†è³‡æ–™è§£ç¢¼å™¨</h1>
    <div class="form-group">
        <label for="ciphertext">åŠ å¯†è³‡æ–™ (Base64)ï¼š</label>
        <textarea id="ciphertext" rows="8" placeholder="è«‹è¼¸å…¥Base64åŠ å¯†è³‡æ–™..."></textarea>
    </div>

    <div class="button-group">
        <button onclick="parseParameters()">ğŸ” è§£æåƒæ•¸</button>
    </div>

    <div id="paramsDisplay" class="params-display" style="display: none;"></div>

    <div class="form-group">
        <label for="password">è§£å¯†å¯†ç¢¼ï¼š</label>
        <input type="password" id="password" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
    </div>

    <div class="button-group">
        <button id="decryptBtn" onclick="decrypt()" disabled>ğŸ”“ è§£å¯†</button>
        <button onclick="clearAll()">ğŸ—‘ï¸ æ¸…é™¤</button>
    </div>

    <div id="status"></div>
    <div id="result" class="result" style="display: none;"></div>
</div>

<script>
    let parsedData = null;

    function showStatus(message, type = 'info') {
        const statusDiv = document.getElementById('status');
        statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        setTimeout(() => {
            if (statusDiv.innerHTML.includes(message)) {
                statusDiv.innerHTML = '';
            }
        }, 5000);
    }

    function showError(message) {
        const statusDiv = document.getElementById('status');
        statusDiv.innerHTML = `<div class="error">${message}</div>`;
    }

    function parseParameters() {
        const ciphertext = document.getElementById('ciphertext').value.trim();
        
        if (!ciphertext) {
            showError('è«‹è¼¸å…¥åŠ å¯†è³‡æ–™');
            return;
        }

        try {
            // è§£ç¢¼Base64
            const decodedData = atob(ciphertext);
            parsedData = JSON.parse(decodedData);

            // é¡¯ç¤ºè§£æçµæœ
            const paramsDiv = document.getElementById('paramsDisplay');
            let html = '<h3>ğŸ“‹ è§£æåƒæ•¸çµæœï¼š</h3>';

            // é‡‘é‘°æ´¾ç”Ÿåƒæ•¸
            html += '<div class="param-item">';
            html += '<div class="param-label">é‡‘é‘°æ´¾ç”Ÿæ–¹æ³•ï¼š</div>';
            html += '<div class="param-value">' + parsedData.keyDerivation.name + '</div>';
            html += '</div>';

            html += '<div class="param-item">';
            html += '<div class="param-label">é¹½å€¼ (Salt)ï¼š</div>';
            html += '<div class="param-value">' + parsedData.keyDerivation.salt + '</div>';
            html += '</div>';

            html += '<div class="param-item">';
            html += '<div class="param-label">è¿­ä»£æ¬¡æ•¸ï¼š</div>';
            html += '<div class="param-value">' + parsedData.keyDerivation.iterations.toLocaleString() + ' æ¬¡</div>';
            html += '</div>';

            html += '<div class="param-item">';
            html += '<div class="param-label">é›œæ¹Šç®—æ³•ï¼š</div>';
            html += '<div class="param-value">' + parsedData.keyDerivation.hash + '</div>';
            html += '</div>';

            // åŠ å¯†åƒæ•¸
            html += '<div class="param-item">';
            html += '<div class="param-label">åŠ å¯†æ–¹æ³•ï¼š</div>';
            html += '<div class="param-value">' + parsedData.encryption.name + '</div>';
            html += '</div>';

            html += '<div class="param-item">';
            html += '<div class="param-label">åˆå§‹å‘é‡ (IV)ï¼š</div>';
            html += '<div class="param-value">' + parsedData.encryption.iv + '</div>';
            html += '</div>';

            html += '<div class="param-item">';
            html += '<div class="param-label">å¯†æ–‡ï¼š</div>';
            html += '<div class="param-value">' + parsedData.encryption.ciphertext + '</div>';
            html += '</div>';

            html += '<div class="param-item">';
            html += '<div class="param-label">é©—è­‰æ¨™ç±¤ï¼š</div>';
            html += '<div class="param-value">' + parsedData.encryption.tag + '</div>';
            html += '</div>';

            html += '<div class="param-item">';
            html += '<div class="param-label">æ¨™ç±¤é•·åº¦ï¼š</div>';
            html += '<div class="param-value">' + parsedData.encryption.tagLength + ' ä½å…ƒ</div>';
            html += '</div>';

            paramsDiv.innerHTML = html;
            paramsDiv.style.display = 'block';

            // å•Ÿç”¨è§£å¯†æŒ‰éˆ•
            document.getElementById('decryptBtn').disabled = false;
            showStatus('åƒæ•¸è§£ææˆåŠŸï¼', 'success');

        } catch (error) {
            showError('è§£æå¤±æ•—ï¼š' + error.message);
            parsedData = null;
            document.getElementById('decryptBtn').disabled = true;
        }
    }

    async function decrypt() {
        if (!parsedData) {
            showError('è«‹å…ˆè§£æåƒæ•¸');
            return;
        }

        const password = document.getElementById('password').value;
        if (!password) {
            showError('è«‹è¼¸å…¥å¯†ç¢¼');
            return;
        }

        try {
            showStatus('æ­£åœ¨è§£å¯†ä¸­...', 'info');

            // å°‡Base64å­—ä¸²è½‰æ›ç‚ºUint8Array
            const salt = Uint8Array.from(atob(parsedData.keyDerivation.salt), c => c.charCodeAt(0));
            const iv = Uint8Array.from(atob(parsedData.encryption.iv), c => c.charCodeAt(0));
            const ciphertext = Uint8Array.from(atob(parsedData.encryption.ciphertext), c => c.charCodeAt(0));
            const tag = Uint8Array.from(atob(parsedData.encryption.tag), c => c.charCodeAt(0));

            // å°‡å¯†ç¢¼è½‰ç‚ºArrayBuffer
            const passwordBuffer = new TextEncoder().encode(password);

            // åŒ¯å…¥å¯†ç¢¼ä½œç‚ºåŸºç¤é‡‘é‘°
            const baseKey = await crypto.subtle.importKey(
                'raw',
                passwordBuffer,
                'PBKDF2',
                false,
                ['deriveBits', 'deriveKey']
            );

            // ä½¿ç”¨PBKDF2æ´¾ç”Ÿé‡‘é‘°
            const derivedKey = await crypto.subtle.deriveKey(
                {
                    name: 'PBKDF2',
                    salt: salt,
                    iterations: parsedData.keyDerivation.iterations,
                    hash: parsedData.keyDerivation.hash
                },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                false,
                ['decrypt']
            );

            // åˆä½µå¯†æ–‡å’Œæ¨™ç±¤
            const encryptedData = new Uint8Array(ciphertext.length + tag.length);
            encryptedData.set(ciphertext, 0);
            encryptedData.set(tag, ciphertext.length);

            // ä½¿ç”¨AES-GCMè§£å¯†
            const decryptedData = await crypto.subtle.decrypt(
                {
                    name: 'AES-GCM',
                    iv: iv,
                    tagLength: parsedData.encryption.tagLength
                },
                derivedKey,
                encryptedData
            );

            // å°‡è§£å¯†çµæœè½‰ç‚ºå­—ä¸²
            const decryptedText = new TextDecoder('utf-8').decode(decryptedData);

            // é¡¯ç¤ºçµæœ
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<h3>âœ… è§£å¯†æˆåŠŸï¼</h3><div class="param-value">' + escapeHtml(decryptedText) + '</div>';
            resultDiv.style.display = 'block';

            showStatus('è§£å¯†å®Œæˆï¼', 'success');

        } catch (error) {
            showError('è§£å¯†å¤±æ•—ï¼š' + error.message + 'ï¼ˆè«‹æª¢æŸ¥å¯†ç¢¼æ˜¯å¦æ­£ç¢ºï¼‰');
        }
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function clearAll() {
        document.getElementById('ciphertext').value = '';
        document.getElementById('password').value = '';
        document.getElementById('paramsDisplay').style.display = 'none';
        document.getElementById('result').style.display = 'none';
        document.getElementById('status').innerHTML = '';
        document.getElementById('decryptBtn').disabled = true;
        parsedData = null;
    }

    // ç›£è½å¯†ç¢¼è¼¸å…¥æ¡†çš„Enteréµ
    document.getElementById('password').addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !document.getElementById('decryptBtn').disabled) {
            decrypt();
        }
    });

    // ç›£è½å¯†æ–‡è¼¸å…¥æ¡†è®ŠåŒ–ï¼Œè‡ªå‹•æ¸…é™¤è§£æçµæœ
    document.getElementById('ciphertext').addEventListener('input', function() {
        if (parsedData) {
            document.getElementById('paramsDisplay').style.display = 'none';
            document.getElementById('result').style.display = 'none';
            document.getElementById('decryptBtn').disabled = true;
            parsedData = null;
        }
    });
</script>
```

</body>
</html>