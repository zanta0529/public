(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))e(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const x of l.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&e(x)}).observe(document,{childList:!0,subtree:!0});function s(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function e(r){if(r.ep)return;r.ep=!0;const l=s(r);fetch(r.href,l)}})();var At=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ct(f){if(Object.prototype.hasOwnProperty.call(f,"__esModule"))return f;var n=f.default;if(typeof n=="function"){var s=function e(){var r=!1;try{r=this instanceof e}catch{}return r?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};s.prototype=n.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(f).forEach(function(e){var r=Object.getOwnPropertyDescriptor(f,e);Object.defineProperty(s,e,r.get?r:{enumerable:!0,get:function(){return f[e]}})}),s}var K={exports:{}};const kt={},Nt=Object.freeze(Object.defineProperty({__proto__:null,default:kt},Symbol.toStringTag,{value:"Module"})),ct=Ct(Nt);/**
 * [js-sha256]{@link https://github.com/emn178/js-sha256}
 *
 * @version 0.11.1
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2025
 * @license MIT
 */var ht;function Ot(){return ht||(ht=1,function(f){(function(){var n="input is invalid type",s=typeof window=="object",e=s?window:{};e.JS_SHA256_NO_WINDOW&&(s=!1);var r=!s&&typeof self=="object",l=!e.JS_SHA256_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node&&process.type!="renderer";l?e=At:r&&(e=self);var x=!e.JS_SHA256_NO_COMMON_JS&&!0&&f.exports,g=!e.JS_SHA256_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",o="0123456789abcdef".split(""),M=[-2147483648,8388608,32768,128],v=[24,16,8,0],_=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],A=["hex","array","digest","arrayBuffer"],b=[];(e.JS_SHA256_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(t){return Object.prototype.toString.call(t)==="[object Array]"}),g&&(e.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(t){return typeof t=="object"&&t.buffer&&t.buffer.constructor===ArrayBuffer});var U=function(t,h){return function(u){return new E(h,!0).update(u)[t]()}},it=function(t){var h=U("hex",t);l&&(h=_t(h,t)),h.create=function(){return new E(t)},h.update=function(d){return h.create().update(d)};for(var u=0;u<A.length;++u){var c=A[u];h[c]=U(c,t)}return h},_t=function(t,h){var u=ct,c=ct.Buffer,d=h?"sha224":"sha256",a;c.from&&!e.JS_SHA256_NO_BUFFER_FROM?a=c.from:a=function(i){return new c(i)};var p=function(i){if(typeof i=="string")return u.createHash(d).update(i,"utf8").digest("hex");if(i==null)throw new Error(n);return i.constructor===ArrayBuffer&&(i=new Uint8Array(i)),Array.isArray(i)||ArrayBuffer.isView(i)||i.constructor===c?u.createHash(d).update(a(i)).digest("hex"):t(i)};return p},ot=function(t,h){return function(u,c){return new P(u,h,!0).update(c)[t]()}},at=function(t){var h=ot("hex",t);h.create=function(d){return new P(d,t)},h.update=function(d,a){return h.create(d).update(a)};for(var u=0;u<A.length;++u){var c=A[u];h[c]=ot(c,t)}return h};function E(t,h){h?(b[0]=b[16]=b[1]=b[2]=b[3]=b[4]=b[5]=b[6]=b[7]=b[8]=b[9]=b[10]=b[11]=b[12]=b[13]=b[14]=b[15]=0,this.blocks=b):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=t}E.prototype.update=function(t){if(!this.finalized){var h,u=typeof t;if(u!=="string"){if(u==="object"){if(t===null)throw new Error(n);if(g&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!Array.isArray(t)&&(!g||!ArrayBuffer.isView(t)))throw new Error(n)}else throw new Error(n);h=!0}for(var c,d=0,a,p=t.length,i=this.blocks;d<p;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,this.block=i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),h)for(a=this.start;d<p&&a<64;++d)i[a>>>2]|=t[d]<<v[a++&3];else for(a=this.start;d<p&&a<64;++d)c=t.charCodeAt(d),c<128?i[a>>>2]|=c<<v[a++&3]:c<2048?(i[a>>>2]|=(192|c>>>6)<<v[a++&3],i[a>>>2]|=(128|c&63)<<v[a++&3]):c<55296||c>=57344?(i[a>>>2]|=(224|c>>>12)<<v[a++&3],i[a>>>2]|=(128|c>>>6&63)<<v[a++&3],i[a>>>2]|=(128|c&63)<<v[a++&3]):(c=65536+((c&1023)<<10|t.charCodeAt(++d)&1023),i[a>>>2]|=(240|c>>>18)<<v[a++&3],i[a>>>2]|=(128|c>>>12&63)<<v[a++&3],i[a>>>2]|=(128|c>>>6&63)<<v[a++&3],i[a>>>2]|=(128|c&63)<<v[a++&3]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=i[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},E.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,h=this.lastByteIndex;t[16]=this.block,t[h>>>2]|=M[h&3],this.block=t[16],h>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.hBytes<<3|this.bytes>>>29,t[15]=this.bytes<<3,this.hash()}},E.prototype.hash=function(){var t=this.h0,h=this.h1,u=this.h2,c=this.h3,d=this.h4,a=this.h5,p=this.h6,i=this.h7,m=this.blocks,F,B,I,k,y,N,O,j,Q,V,q;for(F=16;F<64;++F)y=m[F-15],B=(y>>>7|y<<25)^(y>>>18|y<<14)^y>>>3,y=m[F-2],I=(y>>>17|y<<15)^(y>>>19|y<<13)^y>>>10,m[F]=m[F-16]+B+m[F-7]+I<<0;for(q=h&u,F=0;F<64;F+=4)this.first?(this.is224?(j=300032,y=m[0]-1413257819,i=y-150054599<<0,c=y+24177077<<0):(j=704751109,y=m[0]-210244248,i=y-1521486534<<0,c=y+143694565<<0),this.first=!1):(B=(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),I=(d>>>6|d<<26)^(d>>>11|d<<21)^(d>>>25|d<<7),j=t&h,k=j^t&u^q,O=d&a^~d&p,y=i+I+O+_[F]+m[F],N=B+k,i=c+y<<0,c=y+N<<0),B=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),I=(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),Q=c&t,k=Q^c&h^j,O=i&d^~i&a,y=p+I+O+_[F+1]+m[F+1],N=B+k,p=u+y<<0,u=y+N<<0,B=(u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),I=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7),V=u&c,k=V^u&t^Q,O=p&i^~p&d,y=a+I+O+_[F+2]+m[F+2],N=B+k,a=h+y<<0,h=y+N<<0,B=(h>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),I=(a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7),q=h&u,k=q^h&c^V,O=a&p^~a&i,y=d+I+O+_[F+3]+m[F+3],N=B+k,d=t+y<<0,t=y+N<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+t<<0,this.h1=this.h1+h<<0,this.h2=this.h2+u<<0,this.h3=this.h3+c<<0,this.h4=this.h4+d<<0,this.h5=this.h5+a<<0,this.h6=this.h6+p<<0,this.h7=this.h7+i<<0},E.prototype.hex=function(){this.finalize();var t=this.h0,h=this.h1,u=this.h2,c=this.h3,d=this.h4,a=this.h5,p=this.h6,i=this.h7,m=o[t>>>28&15]+o[t>>>24&15]+o[t>>>20&15]+o[t>>>16&15]+o[t>>>12&15]+o[t>>>8&15]+o[t>>>4&15]+o[t&15]+o[h>>>28&15]+o[h>>>24&15]+o[h>>>20&15]+o[h>>>16&15]+o[h>>>12&15]+o[h>>>8&15]+o[h>>>4&15]+o[h&15]+o[u>>>28&15]+o[u>>>24&15]+o[u>>>20&15]+o[u>>>16&15]+o[u>>>12&15]+o[u>>>8&15]+o[u>>>4&15]+o[u&15]+o[c>>>28&15]+o[c>>>24&15]+o[c>>>20&15]+o[c>>>16&15]+o[c>>>12&15]+o[c>>>8&15]+o[c>>>4&15]+o[c&15]+o[d>>>28&15]+o[d>>>24&15]+o[d>>>20&15]+o[d>>>16&15]+o[d>>>12&15]+o[d>>>8&15]+o[d>>>4&15]+o[d&15]+o[a>>>28&15]+o[a>>>24&15]+o[a>>>20&15]+o[a>>>16&15]+o[a>>>12&15]+o[a>>>8&15]+o[a>>>4&15]+o[a&15]+o[p>>>28&15]+o[p>>>24&15]+o[p>>>20&15]+o[p>>>16&15]+o[p>>>12&15]+o[p>>>8&15]+o[p>>>4&15]+o[p&15];return this.is224||(m+=o[i>>>28&15]+o[i>>>24&15]+o[i>>>20&15]+o[i>>>16&15]+o[i>>>12&15]+o[i>>>8&15]+o[i>>>4&15]+o[i&15]),m},E.prototype.toString=E.prototype.hex,E.prototype.digest=function(){this.finalize();var t=this.h0,h=this.h1,u=this.h2,c=this.h3,d=this.h4,a=this.h5,p=this.h6,i=this.h7,m=[t>>>24&255,t>>>16&255,t>>>8&255,t&255,h>>>24&255,h>>>16&255,h>>>8&255,h&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255,p>>>24&255,p>>>16&255,p>>>8&255,p&255];return this.is224||m.push(i>>>24&255,i>>>16&255,i>>>8&255,i&255),m},E.prototype.array=E.prototype.digest,E.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(this.is224?28:32),h=new DataView(t);return h.setUint32(0,this.h0),h.setUint32(4,this.h1),h.setUint32(8,this.h2),h.setUint32(12,this.h3),h.setUint32(16,this.h4),h.setUint32(20,this.h5),h.setUint32(24,this.h6),this.is224||h.setUint32(28,this.h7),t};function P(t,h,u){var c,d=typeof t;if(d==="string"){var a=[],p=t.length,i=0,m;for(c=0;c<p;++c)m=t.charCodeAt(c),m<128?a[i++]=m:m<2048?(a[i++]=192|m>>>6,a[i++]=128|m&63):m<55296||m>=57344?(a[i++]=224|m>>>12,a[i++]=128|m>>>6&63,a[i++]=128|m&63):(m=65536+((m&1023)<<10|t.charCodeAt(++c)&1023),a[i++]=240|m>>>18,a[i++]=128|m>>>12&63,a[i++]=128|m>>>6&63,a[i++]=128|m&63);t=a}else if(d==="object"){if(t===null)throw new Error(n);if(g&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!Array.isArray(t)&&(!g||!ArrayBuffer.isView(t)))throw new Error(n)}else throw new Error(n);t.length>64&&(t=new E(h,!0).update(t).array());var F=[],B=[];for(c=0;c<64;++c){var I=t[c]||0;F[c]=92^I,B[c]=54^I}E.call(this,h,u),this.update(B),this.oKeyPad=F,this.inner=!0,this.sharedMemory=u}P.prototype=new E,P.prototype.finalize=function(){if(E.prototype.finalize.call(this),this.inner){this.inner=!1;var t=this.array();E.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(t),E.prototype.finalize.call(this)}};var C=it();C.sha256=C,C.sha224=it(!0),C.sha256.hmac=at(),C.sha224.hmac=at(!0),x?f.exports=C:(e.sha256=C.sha256,e.sha224=C.sha224)})()}(K)),K.exports}var mt=Ot();class gt{constructor(n,s,e){if(s<2||e<2||e>s||s>255||e>255)throw new Error("k 和 n 必須是 2 到 255 之間的整數，且 k <= n。");if(typeof n!="string")throw new Error("秘密必須是字串。");this.n=s,this.k=e,this.config={bits:8,radix:16,maxShares:255,primitivePolynomials:[null,null,1,3,3,5,3,3,29],logs:new Array(256),exps:new Array(256)},this._secretsJS_initGF(this.config.bits);const r=this._str2hex(n);let l="1"+this._hex2bin(r);const x=this.config.bits,g=l.length%x;g&&(l="0".repeat(x-g)+l),this.processedSecretElements=this._splitNumStringToIntArray(l,x)}_secretsJS_initGF(n){const s=this.config.primitivePolynomials[n];if(!s)throw new Error(`Unsupported bit size for GF: ${n}`);let e=1;for(let r=0;r<this.config.maxShares;r++)this.config.exps[r]=e,this.config.logs[e]=r,e<<=1,e>=256&&(e^=s,e&=this.config.maxShares)}_padLeft(n,s){let e=n.length%s;return e?"0".repeat(s-e)+n:n}_str2hex(n){let s="";for(let e=0;e<n.length;e++){let r=n.charCodeAt(e);r<128?s+=r.toString(16).padStart(2,"0"):r<2048?(s+=(192|r>>6).toString(16).padStart(2,"0"),s+=(128|r&63).toString(16).padStart(2,"0")):r<55296||r>=57344?(s+=(224|r>>12).toString(16).padStart(2,"0"),s+=(128|r>>6&63).toString(16).padStart(2,"0"),s+=(128|r&63).toString(16).padStart(2,"0")):(r=65536+((r&1023)<<10|n.charCodeAt(++e)&1023),s+=(240|r>>18).toString(16).padStart(2,"0"),s+=(128|r>>12&63).toString(16).padStart(2,"0"),s+=(128|r>>6&63).toString(16).padStart(2,"0"),s+=(128|r&63).toString(16).padStart(2,"0"))}return s}_hex2bin(n){let s="";for(let e=0;e<n.length;e++){let r=parseInt(n[e],16);if(isNaN(r))throw new Error("Invalid hex character in _hex2bin.");s+=r.toString(2).padStart(4,"0")}return s}_bin2hex(n){let s="";n=this._padLeft(n,4);for(let e=0;e<n.length;e+=4){let r=n.substring(e,e+4);s+=parseInt(r,2).toString(16)}return s}_hex2str(n){let s="",e=0;for(;e<n.length;){let r,l=parseInt(n.substring(e,e+2),16);if(e+=2,l<128)r=l;else if((l&224)===192){let x=parseInt(n.substring(e,e+2),16);e+=2,r=(l&31)<<6|x&63}else if((l&240)===224){let x=parseInt(n.substring(e,e+2),16);e+=2;let g=parseInt(n.substring(e,e+2),16);e+=2,r=(l&15)<<12|(x&63)<<6|g&63}else if((l&248)===240){let x=parseInt(n.substring(e,e+2),16);e+=2;let g=parseInt(n.substring(e,e+2),16);e+=2;let o=parseInt(n.substring(e,e+2),16);e+=2,r=(l&7)<<18|(x&63)<<12|(g&63)<<6|o&63}else throw new Error("Invalid UTF-8 sequence in hex string.");s+=String.fromCodePoint(r)}return s}_splitNumStringToIntArray(n,s){const e=[];for(let r=0;r<n.length;r+=s)e.push(parseInt(n.substring(r,r+s),2));return e}_getRandomByte(){const n=new Uint8Array(1);return window.crypto.getRandomValues(n),n[0]}_evalPolynomialSJS(n,s){let e=0;const r=this.config.logs[n];for(let l=s.length-1;l>=0;l--)e===0?e=s[l]:e=this.config.exps[(r+this.config.logs[e])%this.config.maxShares]^s[l];return e}generateShares(){const n=[];for(let s=0;s<this.n;s++)n[s]={id:s+1,value:new Array(this.processedSecretElements.length)};for(let s=0;s<this.processedSecretElements.length;s++){const r=[this.processedSecretElements[s]];for(let l=1;l<this.k;l++)r[l]=this._getRandomByte();for(let l=0;l<this.n;l++){const x=n[l].id;n[l].value[s]=this._evalPolynomialSJS(x,r)}}return n}_reconstructElementSJS(n,s){let e=0;const r=0;for(let l=0;l<this.k;l++){if(s[l]===0)continue;let x=this.config.logs[s[l]];for(let g=0;g<this.k;g++)if(l!==g){if(r===n[g]){x=-1;break}x=(x+this.config.logs[r^n[g]]-this.config.logs[n[l]^n[g]]+this.config.maxShares)%this.config.maxShares}e=x===-1?e:e^this.config.exps[x]}return e}reconstructSecret(n){if(n.length<this.k)throw new Error(`至少需要 ${this.k} 份分割值才能重建。`);const s=n.slice(0,this.k),e=s[0].value.length;if(!s.every(o=>o.value.length===e))throw new Error("所有用於重建的分割值長度必須一致。");let r="";const l=s.map(o=>o.id);for(let o=0;o<e;o++){const M=s.map(_=>_.value[o]),v=this._reconstructElementSJS(l,M);r+=this._padLeft(v.toString(2),this.config.bits)}const x=r.slice(r.indexOf("1")+1),g=this._bin2hex(x);return this._hex2str(g)}}const yt=document.createElement("script");yt.src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js";document.head.appendChild(yt);const Y=document.getElementById("modeSplitBtn"),G=document.getElementById("modeReconstructBtn"),lt=document.getElementById("splitSection"),ft=document.getElementById("reconstructSection"),bt=document.getElementById("originalString"),L=document.getElementById("n"),R=document.getElementById("k"),$=document.getElementById("kErrorMessage"),X=document.getElementById("generateBtn"),Rt=document.getElementById("clearSplitBtn"),Z=document.getElementById("splitError"),tt=document.getElementById("splitResultArea"),et=document.querySelector("#splitResultTable tbody"),ut=document.getElementById("queueProgress"),dt=document.getElementById("queueList"),xt=document.getElementById("customShareInput"),Lt=document.getElementById("addCustomShareBtn"),Ft=document.getElementById("reconstructBtn"),Tt=document.getElementById("clearQueueBtn"),D=document.getElementById("reconstructionResult"),vt=document.getElementById("themeToggleBtn"),z=document.getElementById("qrModal"),pt=document.getElementById("qrCodeContainer"),H=document.getElementById("toast");let w=null,S=[];document.getElementById("currentYear").textContent=new Date().getFullYear();const Et="zanta-shamir-secret-sharing-theme",rt=f=>{H.textContent=f,H.className="show",setTimeout(()=>{H.className=H.className.replace("show","")},3e3)},st=f=>{f==="split"?(Y.classList.add("active"),G.classList.remove("active"),lt.classList.add("active"),ft.classList.remove("active")):(Y.classList.remove("active"),G.classList.add("active"),lt.classList.remove("active"),ft.classList.add("active"))},W=f=>{Z.textContent=f,Z.style.display="block"},St=()=>{Z.style.display="none"},nt=(f,n)=>{D.textContent=f,D.className=`output-box ${n}`,D.style.display="block"},wt=()=>{D.style.display="none"},T=()=>{dt.innerHTML="";const f=w?w.k:S.length>=2?"k?":"?";S.length===0?ut.textContent="請先產生或手動加入分割值":ut.textContent=`已選擇 ${S.length} / ${f} 份分割值`,S.forEach(s=>{const e=document.createElement("div");e.className="queue-item";const r=`ID: ${s.id}`,l=document.createElement("span");l.textContent=`${r}`,e.appendChild(l);const x=document.createElement("button");x.textContent="移除",x.onclick=()=>{S=S.filter(g=>g.id!==s.id),T()},e.appendChild(x),dt.appendChild(e)});let n=!1;w?n=S.length>=w.k:n=S.length>=(parseInt(R.value)||2),Ft.disabled=!n},Bt=f=>{if(S.some(n=>n.id===f.id)){rt(`ID 為 ${f.id} 的分割值已在佇列中。`);return}S.push(f),T(),st("reconstruct")},J=()=>{const f=L.value,n=R.value;let s=!0;if($.textContent="",document.getElementById("nErrorMessage").textContent="",f===""&&n==="")return X.disabled=!0,!1;const e=parseInt(f),r=parseInt(n);return(f===""||isNaN(e)||e<2||e>255)&&(document.getElementById("nErrorMessage").textContent="n 必須是 2 到 255 之間的數字",s=!1),(n===""||isNaN(r)||r<2||r>255)&&($.textContent="k 必須是 2 到 255 之間的數字",s=!1),s&&r>e&&($.textContent="k (門檻值) 不能大於 n (總分割數)",s=!1),X.disabled=!s,s};L.addEventListener("input",J);R.addEventListener("input",J);Y.addEventListener("click",()=>st("split"));G.addEventListener("click",()=>st("reconstruct"));X.addEventListener("click",()=>{St(),tt.style.display="none",et.innerHTML="";try{const f=bt.value,n=parseInt(L.value),s=parseInt(R.value);if(f===""&&!confirm("您確定要分享一個空字串嗎？"))return;if(!L.value||!R.value)throw new Error("n 和 k 皆必須填寫。");if(!J()){W("請修正 n 或 k 的錯誤。");return}w=new gt(f,n,s),w.generateShares().forEach(r=>{const l={v:"1.1",n:w.n,k:w.k,id:r.id,share:r.value},x=mt.sha256(JSON.stringify(l)).substring(0,8);l.chk=x;const g=btoa(JSON.stringify(l)),o=et.insertRow();o.insertCell(0).textContent=r.id,o.insertCell(1).textContent=g;const M=o.insertCell(2),v=document.createElement("div");v.className="action-button-container";const _=document.createElement("button");_.textContent="加入",_.title="加入重建佇列",_.className="action-btn",_.onclick=()=>Bt(r);const A=document.createElement("button");A.textContent="複製",A.title="複製 Base64 分割值",A.className="action-btn secondary",A.onclick=()=>{navigator.clipboard.writeText(g).then(()=>rt(`ID ${r.id} 的分割值已複製！`)).catch(U=>rt("複製失敗: "+U))};const b=document.createElement("button");b.textContent="QR",b.title="產生此分割值的 QR Code",b.className="action-btn qr",b.onclick=()=>{pt.innerHTML="",typeof QRCode<"u"?(new QRCode(pt,{text:g,width:256,height:256,colorDark:document.documentElement.getAttribute("data-theme")==="dark"?"#e8e8f0":"#000000",colorLight:document.documentElement.getAttribute("data-theme")==="dark"?"#2f2f4f":"#ffffff",correctLevel:QRCode.CorrectLevel.M}),z.style.display="flex"):W("QR Code 函式庫載入失敗。")},v.appendChild(_),v.appendChild(A),v.appendChild(b),M.appendChild(v)}),tt.style.display="block",S=[],T()}catch(f){console.error("Generate Error:",f),W(`錯誤: ${f.message}`)}});Rt.addEventListener("click",()=>{bt.value="",L.value="",R.value="",$.textContent="",document.getElementById("nErrorMessage").textContent="",St(),tt.style.display="none",et.innerHTML="",w=null,S=[],T(),J()});Lt.addEventListener("click",()=>{wt();try{const f=xt.value.trim();if(!f)throw new Error("輸入不能為空。");const n=atob(f),s=JSON.parse(n),{chk:e,...r}=s;if(!e)throw new Error("格式不正確：缺少校驗碼 (chk) 欄位。請使用 v1.1 或更高版本產生的分割值。");const l=mt.sha256(JSON.stringify(r)).substring(0,8);if(e!==l)throw new Error("Checksum 驗證失敗！此分割值可能已損毀或被竄改。");const x={id:r.id,value:r.share};if(typeof x.id!="number"||!Array.isArray(x.value))throw new Error("Base64 解碼後的格式不正確，缺少 id 或 share (必須是陣列) 欄位。");if(!x.value.every(g=>typeof g=="number"&&g>=0&&g<=255))throw new Error("分割值中的 share 陣列包含無效的數字 (應為 0-255 之間的數字)。");Bt(x),xt.value=""}catch(f){console.error("Add Custom Share Error:",f),nt(`加入失敗: ${f.message}`,"error")}});Tt.addEventListener("click",()=>{S=[],wt(),T()});Ft.addEventListener("click",()=>{try{if(S.length===0)throw new Error("重建佇列是空的。請加入分割值。");let f=w?w.k:parseInt(R.value),n=w?w.n:parseInt(L.value);if(isNaN(f)||f<2)throw new Error("錯誤：無法確定重建所需的門檻值 (k)。請在「分割」頁面設定 k 值。");if(S.length<f)throw new Error(`需要 ${f} 份分割值，目前只有 ${S.length} 份。`);let s=w;s||((isNaN(n)||n<f||n>255)&&(n=255),s=new gt("temp",n,f));const e=s.reconstructSecret(S);nt(e,"success")}catch(f){console.error("Reconstruct Error:",f),nt(`重建失敗: ${f.message}`,"error")}});z.addEventListener("click",f=>{f.target===z&&(z.style.display="none")});const It=f=>{document.documentElement.setAttribute("data-theme",f),vt.textContent=f==="dark"?"☀️":"🌙",localStorage.setItem(Et,f)};vt.addEventListener("click",()=>{const f=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";It(f)});It(localStorage.getItem(Et)||"dark");J();T();
