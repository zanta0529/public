(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const l of e)if(l.type==="childList")for(const x of l.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&s(x)}).observe(document,{childList:!0,subtree:!0});function a(e){const l={};return e.integrity&&(l.integrity=e.integrity),e.referrerPolicy&&(l.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?l.credentials="include":e.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(e){if(e.ep)return;e.ep=!0;const l=a(e);fetch(e.href,l)}})();class et{constructor(o,a,s){if(a<2||s<2||s>a||a>255||s>255)throw new Error("k å’Œ n å¿…é ˆæ˜¯ 2 åˆ° 255 ä¹‹é–“çš„æ•´æ•¸ï¼Œä¸” k <= nã€‚");if(typeof o!="string")throw new Error("ç§˜å¯†å¿…é ˆæ˜¯å­—ä¸²ã€‚");this.n=a,this.k=s,this.config={bits:8,radix:16,maxShares:255,primitivePolynomials:[null,null,1,3,3,5,3,3,29],logs:new Array(256),exps:new Array(256)},this._secretsJS_initGF(this.config.bits);const e=this._str2hex(o);let l="1"+this._hex2bin(e);const x=this.config.bits,p=l.length%x;p&&(l="0".repeat(x-p)+l),this.processedSecretElements=this._splitNumStringToIntArray(l,x)}_secretsJS_initGF(o){const a=this.config.primitivePolynomials[o];if(!a)throw new Error(`Unsupported bit size for GF: ${o}`);let s=1;for(let e=0;e<this.config.maxShares;e++)this.config.exps[e]=s,this.config.logs[s]=e,s<<=1,s>=256&&(s^=a,s&=this.config.maxShares)}_padLeft(o,a){let s=o.length%a;return s?"0".repeat(a-s)+o:o}_str2hex(o){let a="";for(let s=0;s<o.length;s++){let e=o.charCodeAt(s);e<128?a+=e.toString(16).padStart(2,"0"):e<2048?(a+=(192|e>>6).toString(16).padStart(2,"0"),a+=(128|e&63).toString(16).padStart(2,"0")):e<55296||e>=57344?(a+=(224|e>>12).toString(16).padStart(2,"0"),a+=(128|e>>6&63).toString(16).padStart(2,"0"),a+=(128|e&63).toString(16).padStart(2,"0")):(e=65536+((e&1023)<<10|o.charCodeAt(++s)&1023),a+=(240|e>>18).toString(16).padStart(2,"0"),a+=(128|e>>12&63).toString(16).padStart(2,"0"),a+=(128|e>>6&63).toString(16).padStart(2,"0"),a+=(128|e&63).toString(16).padStart(2,"0"))}return a}_hex2bin(o){let a="";for(let s=0;s<o.length;s++){let e=parseInt(o[s],16);if(isNaN(e))throw new Error("Invalid hex character in _hex2bin.");a+=e.toString(2).padStart(4,"0")}return a}_bin2hex(o){let a="";o=this._padLeft(o,4);for(let s=0;s<o.length;s+=4){let e=o.substring(s,s+4);a+=parseInt(e,2).toString(16)}return a}_hex2str(o){let a="",s=0;for(;s<o.length;){let e,l=parseInt(o.substring(s,s+2),16);if(s+=2,l<128)e=l;else if((l&224)===192){let x=parseInt(o.substring(s,s+2),16);s+=2,e=(l&31)<<6|x&63}else if((l&240)===224){let x=parseInt(o.substring(s,s+2),16);s+=2;let p=parseInt(o.substring(s,s+2),16);s+=2,e=(l&15)<<12|(x&63)<<6|p&63}else if((l&248)===240){let x=parseInt(o.substring(s,s+2),16);s+=2;let p=parseInt(o.substring(s,s+2),16);s+=2;let r=parseInt(o.substring(s,s+2),16);s+=2,e=(l&7)<<18|(x&63)<<12|(p&63)<<6|r&63}else throw new Error("Invalid UTF-8 sequence in hex string.");a+=String.fromCodePoint(e)}return a}_splitNumStringToIntArray(o,a){const s=[];for(let e=0;e<o.length;e+=a)s.push(parseInt(o.substring(e,e+a),2));return s}_getRandomByte(){const o=new Uint8Array(1);return window.crypto.getRandomValues(o),o[0]}_evalPolynomialSJS(o,a){let s=0;const e=this.config.logs[o];for(let l=a.length-1;l>=0;l--)s===0?s=a[l]:s=this.config.exps[(e+this.config.logs[s])%this.config.maxShares]^a[l];return s}generateShares(){const o=[];for(let a=0;a<this.n;a++)o[a]={id:a+1,value:new Array(this.processedSecretElements.length)};for(let a=0;a<this.processedSecretElements.length;a++){const e=[this.processedSecretElements[a]];for(let l=1;l<this.k;l++)e[l]=this._getRandomByte();for(let l=0;l<this.n;l++){const x=o[l].id;o[l].value[a]=this._evalPolynomialSJS(x,e)}}return o}_reconstructElementSJS(o,a){let s=0;const e=0;for(let l=0;l<this.k;l++){if(a[l]===0)continue;let x=this.config.logs[a[l]];for(let p=0;p<this.k;p++)if(l!==p){if(e===o[p]){x=-1;break}x=(x+this.config.logs[e^o[p]]-this.config.logs[o[l]^o[p]]+this.config.maxShares)%this.config.maxShares}s=x===-1?s:s^this.config.exps[x]}return s}reconstructSecret(o){if(o.length<this.k)throw new Error(`è‡³å°‘éœ€è¦ ${this.k} ä»½åˆ†å‰²å€¼æ‰èƒ½é‡å»ºã€‚`);const a=o.slice(0,this.k),s=a[0].value.length;if(!a.every(r=>r.value.length===s))throw new Error("æ‰€æœ‰ç”¨æ–¼é‡å»ºçš„åˆ†å‰²å€¼é•·åº¦å¿…é ˆä¸€è‡´ã€‚");let e="";const l=a.map(r=>r.id);for(let r=0;r<s;r++){const E=a.map(P=>P.value[r]),k=this._reconstructElementSJS(l,E);e+=this._padLeft(k.toString(2),this.config.bits)}const x=e.slice(e.indexOf("1")+1),p=this._bin2hex(x);return this._hex2str(p)}}var at=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ct(I){if(Object.prototype.hasOwnProperty.call(I,"__esModule"))return I;var o=I.default;if(typeof o=="function"){var a=function s(){var e=!1;try{e=this instanceof s}catch{}return e?Reflect.construct(o,arguments,this.constructor):o.apply(this,arguments)};a.prototype=o.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(I).forEach(function(s){var e=Object.getOwnPropertyDescriptor(I,s);Object.defineProperty(a,s,e.get?e:{enumerable:!0,get:function(){return I[s]}})}),a}var tt={exports:{}};const ht={},lt=Object.freeze(Object.defineProperty({__proto__:null,default:ht},Symbol.toStringTag,{value:"Module"})),rt=ct(lt);var nt;function ft(){return nt||(nt=1,(function(I){(function(){var o="input is invalid type",a=typeof window=="object",s=a?window:{};s.JS_SHA256_NO_WINDOW&&(a=!1);var e=!a&&typeof self=="object",l=!s.JS_SHA256_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node&&process.type!="renderer";l?s=at:e&&(s=self);var x=!s.JS_SHA256_NO_COMMON_JS&&!0&&I.exports,p=!s.JS_SHA256_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",r="0123456789abcdef".split(""),E=[-2147483648,8388608,32768,128],k=[24,16,8,0],P=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],J=["hex","array","digest","arrayBuffer"],w=[];(s.JS_SHA256_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(t){return Object.prototype.toString.call(t)==="[object Array]"}),p&&(s.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(t){return typeof t=="object"&&t.buffer&&t.buffer.constructor===ArrayBuffer});var z=function(t,h){return function(u){return new A(h,!0).update(u)[t]()}},Q=function(t){var h=z("hex",t);l&&(h=Y(h,t)),h.create=function(){return new A(t)},h.update=function(f){return h.create().update(f)};for(var u=0;u<J.length;++u){var c=J[u];h[c]=z(c,t)}return h},Y=function(t,h){var u=rt,c=rt.Buffer,f=h?"sha224":"sha256",n;c.from&&!s.JS_SHA256_NO_BUFFER_FROM?n=c.from:n=function(i){return new c(i)};var g=function(i){if(typeof i=="string")return u.createHash(f).update(i,"utf8").digest("hex");if(i==null)throw new Error(o);return i.constructor===ArrayBuffer&&(i=new Uint8Array(i)),Array.isArray(i)||ArrayBuffer.isView(i)||i.constructor===c?u.createHash(f).update(n(i)).digest("hex"):t(i)};return g},G=function(t,h){return function(u,c){return new q(u,h,!0).update(c)[t]()}},V=function(t){var h=G("hex",t);h.create=function(f){return new q(f,t)},h.update=function(f,n){return h.create(f).update(n)};for(var u=0;u<J.length;++u){var c=J[u];h[c]=G(c,t)}return h};function A(t,h){h?(w[0]=w[16]=w[1]=w[2]=w[3]=w[4]=w[5]=w[6]=w[7]=w[8]=w[9]=w[10]=w[11]=w[12]=w[13]=w[14]=w[15]=0,this.blocks=w):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=t}A.prototype.update=function(t){if(!this.finalized){var h,u=typeof t;if(u!=="string"){if(u==="object"){if(t===null)throw new Error(o);if(p&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!Array.isArray(t)&&(!p||!ArrayBuffer.isView(t)))throw new Error(o)}else throw new Error(o);h=!0}for(var c,f=0,n,g=t.length,i=this.blocks;f<g;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,this.block=i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),h)for(n=this.start;f<g&&n<64;++f)i[n>>>2]|=t[f]<<k[n++&3];else for(n=this.start;f<g&&n<64;++f)c=t.charCodeAt(f),c<128?i[n>>>2]|=c<<k[n++&3]:c<2048?(i[n>>>2]|=(192|c>>>6)<<k[n++&3],i[n>>>2]|=(128|c&63)<<k[n++&3]):c<55296||c>=57344?(i[n>>>2]|=(224|c>>>12)<<k[n++&3],i[n>>>2]|=(128|c>>>6&63)<<k[n++&3],i[n>>>2]|=(128|c&63)<<k[n++&3]):(c=65536+((c&1023)<<10|t.charCodeAt(++f)&1023),i[n>>>2]|=(240|c>>>18)<<k[n++&3],i[n>>>2]|=(128|c>>>12&63)<<k[n++&3],i[n>>>2]|=(128|c>>>6&63)<<k[n++&3],i[n>>>2]|=(128|c&63)<<k[n++&3]);this.lastByteIndex=n,this.bytes+=n-this.start,n>=64?(this.block=i[16],this.start=n-64,this.hash(),this.hashed=!0):this.start=n}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},A.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,h=this.lastByteIndex;t[16]=this.block,t[h>>>2]|=E[h&3],this.block=t[16],h>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.hBytes<<3|this.bytes>>>29,t[15]=this.bytes<<3,this.hash()}},A.prototype.hash=function(){var t=this.h0,h=this.h1,u=this.h2,c=this.h3,f=this.h4,n=this.h5,g=this.h6,i=this.h7,m=this.blocks,v,_,C,O,y,R,j,M,$,D,d;for(v=16;v<64;++v)y=m[v-15],_=(y>>>7|y<<25)^(y>>>18|y<<14)^y>>>3,y=m[v-2],C=(y>>>17|y<<15)^(y>>>19|y<<13)^y>>>10,m[v]=m[v-16]+_+m[v-7]+C<<0;for(d=h&u,v=0;v<64;v+=4)this.first?(this.is224?(M=300032,y=m[0]-1413257819,i=y-150054599<<0,c=y+24177077<<0):(M=704751109,y=m[0]-210244248,i=y-1521486534<<0,c=y+143694565<<0),this.first=!1):(_=(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),C=(f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7),M=t&h,O=M^t&u^d,j=f&n^~f&g,y=i+C+j+P[v]+m[v],R=_+O,i=c+y<<0,c=y+R<<0),_=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),C=(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),$=c&t,O=$^c&h^M,j=i&f^~i&n,y=g+C+j+P[v+1]+m[v+1],R=_+O,g=u+y<<0,u=y+R<<0,_=(u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),C=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7),D=u&c,O=D^u&t^$,j=g&i^~g&f,y=n+C+j+P[v+2]+m[v+2],R=_+O,n=h+y<<0,h=y+R<<0,_=(h>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),C=(n>>>6|n<<26)^(n>>>11|n<<21)^(n>>>25|n<<7),d=h&u,O=d^h&c^D,j=n&g^~n&i,y=f+C+j+P[v+3]+m[v+3],R=_+O,f=t+y<<0,t=y+R<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+t<<0,this.h1=this.h1+h<<0,this.h2=this.h2+u<<0,this.h3=this.h3+c<<0,this.h4=this.h4+f<<0,this.h5=this.h5+n<<0,this.h6=this.h6+g<<0,this.h7=this.h7+i<<0},A.prototype.hex=function(){this.finalize();var t=this.h0,h=this.h1,u=this.h2,c=this.h3,f=this.h4,n=this.h5,g=this.h6,i=this.h7,m=r[t>>>28&15]+r[t>>>24&15]+r[t>>>20&15]+r[t>>>16&15]+r[t>>>12&15]+r[t>>>8&15]+r[t>>>4&15]+r[t&15]+r[h>>>28&15]+r[h>>>24&15]+r[h>>>20&15]+r[h>>>16&15]+r[h>>>12&15]+r[h>>>8&15]+r[h>>>4&15]+r[h&15]+r[u>>>28&15]+r[u>>>24&15]+r[u>>>20&15]+r[u>>>16&15]+r[u>>>12&15]+r[u>>>8&15]+r[u>>>4&15]+r[u&15]+r[c>>>28&15]+r[c>>>24&15]+r[c>>>20&15]+r[c>>>16&15]+r[c>>>12&15]+r[c>>>8&15]+r[c>>>4&15]+r[c&15]+r[f>>>28&15]+r[f>>>24&15]+r[f>>>20&15]+r[f>>>16&15]+r[f>>>12&15]+r[f>>>8&15]+r[f>>>4&15]+r[f&15]+r[n>>>28&15]+r[n>>>24&15]+r[n>>>20&15]+r[n>>>16&15]+r[n>>>12&15]+r[n>>>8&15]+r[n>>>4&15]+r[n&15]+r[g>>>28&15]+r[g>>>24&15]+r[g>>>20&15]+r[g>>>16&15]+r[g>>>12&15]+r[g>>>8&15]+r[g>>>4&15]+r[g&15];return this.is224||(m+=r[i>>>28&15]+r[i>>>24&15]+r[i>>>20&15]+r[i>>>16&15]+r[i>>>12&15]+r[i>>>8&15]+r[i>>>4&15]+r[i&15]),m},A.prototype.toString=A.prototype.hex,A.prototype.digest=function(){this.finalize();var t=this.h0,h=this.h1,u=this.h2,c=this.h3,f=this.h4,n=this.h5,g=this.h6,i=this.h7,m=[t>>>24&255,t>>>16&255,t>>>8&255,t&255,h>>>24&255,h>>>16&255,h>>>8&255,h&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,g>>>24&255,g>>>16&255,g>>>8&255,g&255];return this.is224||m.push(i>>>24&255,i>>>16&255,i>>>8&255,i&255),m},A.prototype.array=A.prototype.digest,A.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(this.is224?28:32),h=new DataView(t);return h.setUint32(0,this.h0),h.setUint32(4,this.h1),h.setUint32(8,this.h2),h.setUint32(12,this.h3),h.setUint32(16,this.h4),h.setUint32(20,this.h5),h.setUint32(24,this.h6),this.is224||h.setUint32(28,this.h7),t};function q(t,h,u){var c,f=typeof t;if(f==="string"){var n=[],g=t.length,i=0,m;for(c=0;c<g;++c)m=t.charCodeAt(c),m<128?n[i++]=m:m<2048?(n[i++]=192|m>>>6,n[i++]=128|m&63):m<55296||m>=57344?(n[i++]=224|m>>>12,n[i++]=128|m>>>6&63,n[i++]=128|m&63):(m=65536+((m&1023)<<10|t.charCodeAt(++c)&1023),n[i++]=240|m>>>18,n[i++]=128|m>>>12&63,n[i++]=128|m>>>6&63,n[i++]=128|m&63);t=n}else if(f==="object"){if(t===null)throw new Error(o);if(p&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!Array.isArray(t)&&(!p||!ArrayBuffer.isView(t)))throw new Error(o)}else throw new Error(o);t.length>64&&(t=new A(h,!0).update(t).array());var v=[],_=[];for(c=0;c<64;++c){var C=t[c]||0;v[c]=92^C,_[c]=54^C}A.call(this,h,u),this.update(_),this.oKeyPad=v,this.inner=!0,this.sharedMemory=u}q.prototype=new A,q.prototype.finalize=function(){if(A.prototype.finalize.call(this),this.inner){this.inner=!1;var t=this.array();A.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(t),A.prototype.finalize.call(this)}};var T=Q();T.sha256=T,T.sha224=Q(!0),T.sha256.hmac=V(),T.sha224.hmac=V(!0),x?I.exports=T:(s.sha256=T.sha256,s.sha224=T.sha224)})()})(tt)),tt.exports}var st=ft(),X={exports:{}},dt=X.exports,it;function ut(){return it||(it=1,(function(I){(function(){var o,a,s,e;for(s=(I!==null?I.exports:void 0)||(window.Base58={}),o="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",a={},e=0;e<o.length;)a[o.charAt(e)]=e,e++;s.encode=function(l){var x,p,r;if(l.length===0)return"";for(e=void 0,r=void 0,p=[0],e=0;e<l.length;){for(r=0;r<p.length;)p[r]<<=8,r++;for(p[0]+=l[e],x=0,r=0;r<p.length;)p[r]+=x,x=p[r]/58|0,p[r]%=58,++r;for(;x;)p.push(x%58),x=x/58|0;e++}for(e=0;l[e]===0&&e<l.length-1;)p.push(0),e++;return p.reverse().map(function(E){return o[E]}).join("")},s.decode=function(l){var x,p,r,E;if(l.length===0)return new(typeof Uint8Array<"u"&&Uint8Array!==null?Uint8Array:Buffer)(0);for(e=void 0,E=void 0,x=[0],e=0;e<l.length;){if(p=l[e],!(p in a))throw"Base58.decode received unacceptable input. Character '"+p+"' is not in the Base58 alphabet.";for(E=0;E<x.length;)x[E]*=58,E++;for(x[0]+=a[p],r=0,E=0;E<x.length;)x[E]+=r,r=x[E]>>8,x[E]&=255,++E;for(;r;)x.push(r&255),r>>=8;e++}for(e=0;l[e]==="1"&&e<l.length-1;)x.push(0),e++;return new(typeof Uint8Array<"u"&&Uint8Array!==null?Uint8Array:Buffer)(x.reverse())}}).call(dt)})(X)),X.exports}var ot=ut();document.addEventListener("DOMContentLoaded",()=>{const I=document.createElement("script");I.src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js",I.onload=()=>console.log("QRCode.js loaded."),document.head.appendChild(I);const o=document.getElementById("modeSplitBtn"),a=document.getElementById("modeReconstructBtn"),s=document.getElementById("splitSection"),e=document.getElementById("reconstructSection"),l=document.getElementById("originalString"),x=document.getElementById("n"),p=document.getElementById("k"),r=document.getElementById("kErrorMessage"),E=document.getElementById("generateBtn"),k=document.getElementById("clearSplitBtn"),P=document.getElementById("splitError"),J=document.getElementById("splitResultArea"),w=document.querySelector("#splitResultTable tbody"),z=document.getElementById("queueProgress"),Q=document.getElementById("queueList"),Y=document.getElementById("customShareInput"),G=document.getElementById("addCustomShareBtn"),V=document.getElementById("reconstructBtn"),A=document.getElementById("clearQueueBtn"),q=document.getElementById("reconstructionResult"),T=document.getElementById("themeToggleBtn"),t=document.getElementById("qrModal"),h=document.getElementById("qrCodeContainer"),u=document.getElementById("toast"),c=document.getElementById("encodingToggle");let f=null,n=[],g=[];document.getElementById("currentYear").textContent=new Date().getFullYear();const i="zanta-shamir-secret-sharing-theme",m=d=>{u.textContent=d,u.className="show",setTimeout(()=>{u.className=u.className.replace("show","")},3e3)},v=d=>{d==="split"?(o.classList.add("active"),a.classList.remove("active"),s.classList.add("active"),e.classList.remove("active")):(o.classList.remove("active"),a.classList.add("active"),s.classList.remove("active"),e.classList.add("active"))},_=d=>{P.textContent=d,P.style.display="block"},C=()=>{P.style.display="none"},O=(d,b)=>{q.textContent=d,q.className=`output-box ${b}`,q.style.display="block"},y=()=>{q.style.display="none"},R=()=>{Q.innerHTML="";const d=f?f.k:n.length>=2?"k?":"?";n.length===0?z.textContent="è«‹å…ˆç”¢ç”Ÿæˆ–æ‰‹å‹•åŠ å…¥åˆ†å‰²å€¼":z.textContent=`å·²é¸æ“‡ ${n.length} / ${d} ä»½åˆ†å‰²å€¼`,n.forEach(F=>{const S=document.createElement("div");S.className="queue-item";const B=`ID: ${F.id}`,U=document.createElement("span");U.textContent=`${B}`,S.appendChild(U);const N=document.createElement("button");N.textContent="ç§»é™¤",N.onclick=()=>{n=n.filter(L=>L.id!==F.id),R()},S.appendChild(N),Q.appendChild(S)});let b=!1;f?b=n.length>=f.k:b=n.length>=(parseInt(p.value)||2),V.disabled=!b},j=d=>{if(n.some(b=>b.id===d.id)){m(`ID ç‚º ${d.id} çš„åˆ†å‰²å€¼å·²åœ¨ä½‡åˆ—ä¸­ã€‚`);return}n.push(d),R(),v("reconstruct")},M=()=>{const d=x.value,b=p.value;let F=!0;if(r.textContent="",document.getElementById("nErrorMessage").textContent="",d===""&&b==="")return E.disabled=!0,!1;const S=parseInt(d),B=parseInt(b);return(d===""||isNaN(S)||S<2||S>255)&&(document.getElementById("nErrorMessage").textContent="n å¿…é ˆæ˜¯ 2 åˆ° 255 ä¹‹é–“çš„æ•¸å­—",F=!1),(b===""||isNaN(B)||B<2||B>255)&&(r.textContent="k å¿…é ˆæ˜¯ 2 åˆ° 255 ä¹‹é–“çš„æ•¸å­—",F=!1),F&&B>S&&(r.textContent="k (é–€æª»å€¼) ä¸èƒ½å¤§æ–¼ n (ç¸½åˆ†å‰²æ•¸)",F=!1),E.disabled=!F,F};function $(d,b){w.innerHTML="",d.forEach(F=>{let S;const B=JSON.stringify(F);if(b==="base58"){const Z=new TextEncoder().encode(B);S=ot.encode(Z)}else S=btoa(B);const U=w.insertRow();U.insertCell(0).textContent=F.id,U.insertCell(1).textContent=S;const N=U.insertCell(2),L=document.createElement("div");L.className="action-button-container";const H=document.createElement("button");H.textContent="åŠ å…¥",H.title="åŠ å…¥é‡å»ºä½‡åˆ—",H.className="action-btn",H.onclick=()=>j({id:F.id,value:F.share});const K=document.createElement("button");K.textContent="è¤‡è£½",K.title="è¤‡è£½ç·¨ç¢¼å¾Œçš„åˆ†å‰²å€¼",K.className="action-btn secondary",K.onclick=()=>{navigator.clipboard.writeText(S).then(()=>m(`ID ${F.id} çš„åˆ†å‰²å€¼å·²è¤‡è£½ï¼`)).catch(Z=>m("è¤‡è£½å¤±æ•—: "+Z))};const W=document.createElement("button");W.textContent="QR",W.title="ç”¢ç”Ÿæ­¤åˆ†å‰²å€¼çš„ QR Code",W.className="action-btn qr",W.onclick=()=>{h.innerHTML="",typeof QRCode<"u"?(new QRCode(h,{text:S,width:256,height:256,colorDark:document.documentElement.getAttribute("data-theme")==="dark"?"#e8e8f0":"#000000",colorLight:document.documentElement.getAttribute("data-theme")==="dark"?"#2f2f4f":"#ffffff",correctLevel:QRCode.CorrectLevel.M}),t.style.display="flex"):_("QR Code å‡½å¼åº«è¼‰å…¥å¤±æ•—ã€‚")},L.appendChild(H),L.appendChild(K),L.appendChild(W),N.appendChild(L)})}x.addEventListener("input",M),p.addEventListener("input",M),o.addEventListener("click",()=>v("split")),a.addEventListener("click",()=>v("reconstruct")),E.addEventListener("click",()=>{C(),J.style.display="none";try{const d=l.value,b=parseInt(x.value),F=parseInt(p.value);if(d===""&&!confirm("æ‚¨ç¢ºå®šè¦åˆ†äº«ä¸€å€‹ç©ºå­—ä¸²å—ï¼Ÿ"))return;if(!x.value||!p.value)throw new Error("n å’Œ k çš†å¿…é ˆå¡«å¯«ã€‚");if(!M()){_("è«‹ä¿®æ­£ n æˆ– k çš„éŒ¯èª¤ã€‚");return}f=new et(d,b,F),g=f.generateShares().map(U=>{const N={v:"1.2",n:f.n,k:f.k,p:"1D",enc:"utf8",pad:"secrets.js-1bit",cs:"sha256-4",id:U.id,share:U.value},L=st.sha256(JSON.stringify(N)).substring(0,8);return N.chk=L,N});const B=c.checked?"base58":"base64";$(g,B),J.style.display="block",n=[],R()}catch(d){console.error("Generate Error:",d),_(`éŒ¯èª¤: ${d.message}`)}}),c.addEventListener("change",d=>{const b=d.target.checked?"base58":"base64";g.length>0&&$(g,b)}),k.addEventListener("click",()=>{l.value="",x.value="",p.value="",r.textContent="",document.getElementById("nErrorMessage").textContent="",C(),J.style.display="none",f=null,n=[],g=[],R(),M()}),G.addEventListener("click",()=>{y();try{const d=Y.value.trim();if(!d)throw new Error("è¼¸å…¥ä¸èƒ½ç‚ºç©ºã€‚");let b;try{b=atob(d)}catch{try{const H=ot.decode(d);b=new TextDecoder().decode(H)}catch{throw new Error("ç„¡æ³•è§£æè¼¸å…¥ï¼Œè«‹ç¢ºèªå…¶ç‚ºæœ‰æ•ˆçš„ Base64 æˆ– Base58 ç·¨ç¢¼ã€‚")}}const F=JSON.parse(b),{chk:S,...B}=F;if(!S)throw new Error("æ ¼å¼ä¸æ­£ç¢ºï¼šç¼ºå°‘æ ¡é©—ç¢¼ (chk) æ¬„ä½ã€‚");const U=st.sha256(JSON.stringify(B)).substring(0,8);if(S!==U)throw new Error("Checksum é©—è­‰å¤±æ•—ï¼æ­¤åˆ†å‰²å€¼å¯èƒ½å·²ææ¯€æˆ–è¢«ç«„æ”¹ã€‚");B.v!=="1.2"&&B.v!=="1.1"&&console.warn(`[ç›¸å®¹æ€§è­¦å‘Š] æ­¤åˆ†å‰²å€¼ç‰ˆæœ¬ç‚º ${B.v}ï¼Œç›®å‰ç‰ˆæœ¬ç‚º 1.2ã€‚`),B.v==="1.2"&&(!B.pad||B.pad!=="secrets.js-1bit")&&console.warn("[ç›¸å®¹æ€§è­¦å‘Š] æ­¤ v1.2 åˆ†å‰²å€¼ç¼ºå°‘ 'pad' æ¬„ä½æˆ– 'pad' é¡å‹ä¸å—æ”¯æ´ã€‚å°‡å‡å®šä½¿ç”¨ 'secrets.js-1bit' æ–¹æ¡ˆé€²è¡Œé‡å»ºã€‚");const N={id:B.id,value:B.share};if(typeof N.id!="number"||!Array.isArray(N.value))throw new Error("Base64 è§£ç¢¼å¾Œçš„æ ¼å¼ä¸æ­£ç¢ºï¼Œç¼ºå°‘ id æˆ– share (å¿…é ˆæ˜¯é™£åˆ—) æ¬„ä½ã€‚");if(!N.value.every(L=>typeof L=="number"&&L>=0&&L<=255))throw new Error("åˆ†å‰²å€¼ä¸­çš„ share é™£åˆ—åŒ…å«ç„¡æ•ˆçš„æ•¸å­— (æ‡‰ç‚º 0-255 ä¹‹é–“çš„æ•¸å­—)ã€‚");j(N),Y.value=""}catch(d){console.error("Add Custom Share Error:",d),O(`åŠ å…¥å¤±æ•—: ${d.message}`,"error")}}),A.addEventListener("click",()=>{n=[],y(),R()}),V.addEventListener("click",()=>{try{if(n.length===0)throw new Error("é‡å»ºä½‡åˆ—æ˜¯ç©ºçš„ã€‚è«‹åŠ å…¥åˆ†å‰²å€¼ã€‚");let d=f?f.k:parseInt(p.value),b=f?f.n:parseInt(x.value);if(isNaN(d)||d<2)if(n.length>0&&n[0].k)d=n[0].k;else throw new Error("éŒ¯èª¤ï¼šç„¡æ³•ç¢ºå®šé‡å»ºæ‰€éœ€çš„é–€æª»å€¼ (k)ã€‚è«‹åœ¨ã€Œåˆ†å‰²ã€é é¢è¨­å®š k å€¼ï¼Œæˆ–ä½¿ç”¨ v1.1+ æ ¼å¼çš„åˆ†å‰²å€¼ã€‚");if(n.length<d)throw new Error(`éœ€è¦ ${d} ä»½åˆ†å‰²å€¼ï¼Œç›®å‰åªæœ‰ ${n.length} ä»½ã€‚`);let F=f;F||((isNaN(b)||b<d||b>255)&&(b=255),F=new et("temp",b,d));const S=F.reconstructSecret(n);O(S,"success")}catch(d){console.error("Reconstruct Error:",d),O(`é‡å»ºå¤±æ•—: ${d.message}`,"error")}}),t.addEventListener("click",d=>{d.target===t&&(t.style.display="none")});const D=d=>{document.documentElement.setAttribute("data-theme",d),T.textContent=d==="dark"?"â˜€ï¸":"ğŸŒ™",localStorage.setItem(i,d)};T.addEventListener("click",()=>{const d=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";D(d)}),D(localStorage.getItem(i)||"dark"),M(),R()});
