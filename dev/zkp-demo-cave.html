<!DOCTYPE html>
<html lang="zh-Hant">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>零知識證明互動展示 (ZKP Demo)</title>

        <!-- Tailwind CSS -->
        <script src="https://cdn.tailwindcss.com"></script>

        <!-- React & ReactDOM (UMD) -->
        <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
        <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

        <!-- Babel Standalone for in-browser JSX compilation -->
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

        <style>
            @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap");

            body {
                font-family: "Inter", "Noto Sans TC", sans-serif;
                background-color: #020617; /* slate-950 */
                color: #e2e8f0; /* slate-200 */
            }

            /* Custom Scrollbar */
            .custom-scrollbar::-webkit-scrollbar {
                width: 6px;
            }
            .custom-scrollbar::-webkit-scrollbar-track {
                background: #1e293b;
            }
            .custom-scrollbar::-webkit-scrollbar-thumb {
                background: #475569;
                border-radius: 3px;
            }
            .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                background: #64748b;
            }
        </style>
        <script type="importmap">
            {
                "imports": {
                    "react": "https://aistudiocdn.com/react@^19.2.0",
                    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.554.0",
                    "react/": "https://aistudiocdn.com/react@^19.2.0/",
                    "framer-motion": "https://aistudiocdn.com/framer-motion@^12.23.24"
                }
            }
        </script>
    </head>
    <body>
        <div id="root"></div>

        <script type="text/babel">
            const { useState, useEffect, useCallback } = React;

            // --- Icons (Inline SVGs to remove dependency) ---
            const Icons = {
                Key: (props) => (
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        {...props}
                    >
                        <circle cx="7.5" cy="15.5" r="5.5" />
                        <path d="m21 2-9.6 9.6" />
                        <path d="m15.5 7.5 3 3L22 7l-3-3" />
                    </svg>
                ),
                Shield: (props) => (
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        {...props}
                    >
                        <path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z" />
                    </svg>
                ),
                Eye: (props) => (
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        {...props}
                    >
                        <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" />
                        <circle cx="12" cy="12" r="3" />
                    </svg>
                ),
                Lock: (props) => (
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        {...props}
                    >
                        <rect width="18" height="11" x="3" y="11" rx="2" ry="2" />
                        <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                    </svg>
                ),
                Unlock: (props) => (
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        {...props}
                    >
                        <rect width="18" height="11" x="3" y="11" rx="2" ry="2" />
                        <path d="M7 11V7a5 5 0 0 1 9.9-1" />
                    </svg>
                ),
                CheckCircle2: (props) => (
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        {...props}
                    >
                        <circle cx="12" cy="12" r="10" />
                        <path d="m9 12 2 2 4-4" />
                    </svg>
                ),
                XCircle: (props) => (
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        {...props}
                    >
                        <circle cx="12" cy="12" r="10" />
                        <path d="m15 9-6 6" />
                        <path d="m9 9 6 6" />
                    </svg>
                ),
                ArrowRight: (props) => (
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        {...props}
                    >
                        <path d="M5 12h14" />
                        <path d="m12 5 7 7-7 7" />
                    </svg>
                ),
                RefreshCw: (props) => (
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        {...props}
                    >
                        <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" />
                        <path d="M21 3v5h-5" />
                        <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" />
                        <path d="M8 16H3v5" />
                    </svg>
                ),
                Play: (props) => (
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        {...props}
                    >
                        <polygon points="6 3 20 12 6 21 6 3" />
                    </svg>
                ),
                HelpCircle: (props) => (
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        {...props}
                    >
                        <circle cx="12" cy="12" r="10" />
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                        <path d="M12 17h.01" />
                    </svg>
                ),
            };

            // --- Constants & Types ---
            const GameStep = {
                IDLE: "IDLE",
                ENTERING: "ENTERING",
                HIDDEN: "HIDDEN",
                CHALLENGE: "CHALLENGE",
                EXITING: "EXITING",
                RESULT: "RESULT",
            };

            // --- Components ---

            // 1. CaveVisualizer
            const CaveVisualizer = ({ step, peggyPath, victorCall }) => {
                const getPeggyStyle = () => {
                    const baseStyle =
                        "absolute transition-all duration-1000 ease-in-out w-10 h-10 md:w-12 md:h-12 flex items-center justify-center rounded-full shadow-lg z-20 border-2 border-white/20 font-bold text-sm";

                    if (step === GameStep.IDLE) {
                        return `${baseStyle} top-[85%] left-1/2 -translate-x-1/2 bg-purple-600 text-white opacity-100 scale-100`;
                    }
                    if (step === GameStep.ENTERING) {
                        return `${baseStyle} top-[50%] left-1/2 -translate-x-1/2 bg-purple-600 text-white opacity-0 scale-50`;
                    }
                    if (step === GameStep.HIDDEN || step === GameStep.CHALLENGE) {
                        const isA = peggyPath === "A";
                        return `${baseStyle} top-[25%] ${isA ? "left-[25%]" : "left-[75%]"} bg-purple-600 opacity-0`;
                    }
                    if (step === GameStep.EXITING || step === GameStep.RESULT) {
                        const isCallA = victorCall === "A";
                        return `${baseStyle} top-[75%] ${
                            isCallA ? "left-[30%]" : "left-[70%]"
                        } bg-purple-600 opacity-100`;
                    }
                    return baseStyle;
                };

                return (
                    <div className="relative w-full aspect-[4/3] bg-slate-900 rounded-xl border-2 border-slate-800 overflow-hidden shadow-2xl">
                        {/* Cave SVG */}
                        <svg
                            className="absolute inset-0 w-full h-full text-slate-800 pointer-events-none"
                            viewBox="0 0 400 300"
                            preserveAspectRatio="xMidYMid slice"
                        >
                            <rect width="400" height="300" className="fill-slate-950" />
                            <path
                                d="M 200,280 L 200,180 Q 200,130 240,130 L 280,130 L 280,280 L 400,280 L 400,0 L 0,0 L 0,280 L 120,280 L 120,130 L 160,130 Q 200,130 200,180"
                                className="fill-slate-900 stroke-slate-700 stroke-[3]"
                            />
                            <path
                                d="M 200,50 L 200,130"
                                className="stroke-yellow-500/30 stroke-[4] stroke-dasharray-4"
                            />
                        </svg>

                        <div className="absolute top-[20%] left-1/2 -translate-x-1/2 text-yellow-500/50 text-xs font-mono tracking-widest uppercase">
                            Magic Door
                        </div>
                        <div className="absolute bottom-[25%] left-[20%] text-4xl font-bold text-sky-500/10 select-none">
                            A
                        </div>
                        <div className="absolute bottom-[25%] right-[20%] text-4xl font-bold text-rose-500/10 select-none">
                            B
                        </div>

                        {/* Victor */}
                        <div className="absolute bottom-2 left-1/2 -translate-x-1/2 z-30 flex flex-col items-center transition-all duration-500">
                            <div
                                className={`p-3 rounded-full border-4 border-slate-950 shadow-lg transition-colors duration-300 ${
                                    step === GameStep.CHALLENGE
                                        ? "bg-blue-500 scale-110 ring-4 ring-blue-500/30"
                                        : "bg-slate-700"
                                }`}
                            >
                                <Icons.Eye className="w-6 h-6 text-white" />
                            </div>
                            <span className="text-[10px] font-bold text-slate-400 bg-slate-950/80 px-2 py-0.5 rounded-full mt-2 border border-slate-800">
                                驗證者 (Victor)
                            </span>
                        </div>

                        {/* Peggy */}
                        <div className={getPeggyStyle()}>P</div>

                        {/* Status Overlay */}
                        {(step === GameStep.HIDDEN || step === GameStep.CHALLENGE) && (
                            <div className="absolute inset-0 flex items-center justify-center z-10 pointer-events-none">
                                <div className="bg-slate-950/60 backdrop-blur-[2px] px-6 py-3 rounded-xl border border-slate-700 text-slate-200 flex items-center gap-3 animate-pulse">
                                    <div className="w-2 h-2 bg-purple-500 rounded-full animate-ping" />
                                    Peggy 已隱藏在洞穴中
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // 2. ControlPanel
            const ControlPanel = ({ step, hasKey, setHasKey, onStartRound, onChallenge, onReset }) => {
                const isInteractive = step === GameStep.CHALLENGE;
                const canStart = step === GameStep.IDLE || step === GameStep.RESULT;

                return (
                    <div className="space-y-6">
                        <div className="bg-slate-800/40 border border-slate-700 p-5 rounded-xl">
                            <div className="flex items-center justify-between mb-4">
                                <label className="text-sm font-medium text-slate-300 flex items-center gap-2">
                                    <Icons.HelpCircle className="w-4 h-4 text-slate-500" />
                                    設定 Peggy 的身份
                                </label>
                                <div
                                    className={`px-3 py-1 rounded-full text-xs font-bold border ${
                                        hasKey
                                            ? "bg-green-500/10 border-green-500/50 text-green-400"
                                            : "bg-red-500/10 border-red-500/50 text-red-400"
                                    }`}
                                >
                                    {hasKey ? "誠實者 (持有密語)" : "騙子 (無密語)"}
                                </div>
                            </div>

                            <div className="grid grid-cols-2 gap-3">
                                <button
                                    onClick={() => canStart && setHasKey(true)}
                                    disabled={!canStart}
                                    className={`py-3 px-4 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-2 border
                  ${
                      hasKey
                          ? "bg-green-600 border-green-500 text-white shadow-[0_0_15px_rgba(22,163,74,0.3)]"
                          : "bg-slate-900 border-slate-700 text-slate-400 hover:border-slate-600"
                  }
                  ${!canStart ? "opacity-50 cursor-not-allowed" : ""}
                `}
                                >
                                    <Icons.Key className="w-4 h-4" /> 有鑰匙
                                </button>
                                <button
                                    onClick={() => canStart && setHasKey(false)}
                                    disabled={!canStart}
                                    className={`py-3 px-4 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-2 border
                  ${
                      !hasKey
                          ? "bg-red-600 border-red-500 text-white shadow-[0_0_15px_rgba(220,38,38,0.3)]"
                          : "bg-slate-900 border-slate-700 text-slate-400 hover:border-slate-600"
                  }
                  ${!canStart ? "opacity-50 cursor-not-allowed" : ""}
                `}
                                >
                                    <Icons.Lock className="w-4 h-4" /> 沒鑰匙
                                </button>
                            </div>
                        </div>

                        <div className="space-y-3">
                            {canStart && (
                                <button
                                    onClick={onStartRound}
                                    className="w-full group relative overflow-hidden bg-blue-600 hover:bg-blue-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-blue-900/20 transition-all transform active:scale-[0.98]"
                                >
                                    <div className="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300" />
                                    <span className="relative flex items-center justify-center gap-2">
                                        <Icons.Play className="w-5 h-5 fill-current" /> 開始回合
                                    </span>
                                </button>
                            )}

                            {step === GameStep.ENTERING && (
                                <div className="w-full bg-slate-800 text-slate-400 py-4 rounded-xl font-medium text-center animate-pulse border border-slate-700">
                                    Peggy 正在進入洞穴...
                                </div>
                            )}

                            {step === GameStep.HIDDEN && (
                                <div className="w-full bg-yellow-500/10 text-yellow-400 py-4 rounded-xl font-medium text-center border border-yellow-500/20">
                                    等待 Peggy 就位...
                                </div>
                            )}

                            {isInteractive && (
                                <div className="grid grid-cols-2 gap-4 animate-in fade-in slide-in-from-bottom-4 duration-500">
                                    <button
                                        onClick={() => onChallenge("A")}
                                        className="relative bg-slate-800 hover:bg-sky-900/30 border border-slate-600 hover:border-sky-500 text-sky-100 py-6 rounded-xl transition-all group overflow-hidden"
                                    >
                                        <div className="absolute inset-0 bg-sky-500/10 opacity-0 group-hover:opacity-100 transition-opacity" />
                                        <div className="relative flex flex-col items-center gap-1">
                                            <span className="text-xs text-slate-400 group-hover:text-sky-300">
                                                呼叫出口
                                            </span>
                                            <span className="text-2xl font-bold text-sky-400">A</span>
                                        </div>
                                    </button>
                                    <button
                                        onClick={() => onChallenge("B")}
                                        className="relative bg-slate-800 hover:bg-rose-900/30 border border-slate-600 hover:border-rose-500 text-rose-100 py-6 rounded-xl transition-all group overflow-hidden"
                                    >
                                        <div className="absolute inset-0 bg-rose-500/10 opacity-0 group-hover:opacity-100 transition-opacity" />
                                        <div className="relative flex flex-col items-center gap-1">
                                            <span className="text-xs text-slate-400 group-hover:text-rose-300">
                                                呼叫出口
                                            </span>
                                            <span className="text-2xl font-bold text-rose-400">B</span>
                                        </div>
                                    </button>
                                </div>
                            )}

                            {step === GameStep.EXITING && (
                                <div className="w-full bg-slate-800 text-slate-300 py-4 rounded-xl font-medium text-center border border-slate-700 flex items-center justify-center gap-2">
                                    <Icons.RefreshCw className="w-4 h-4 animate-spin" /> 驗證中...
                                </div>
                            )}
                        </div>

                        <div className="pt-4 flex justify-center">
                            <button
                                onClick={onReset}
                                className="text-xs text-slate-500 hover:text-slate-300 hover:underline flex items-center gap-1 transition-colors"
                            >
                                <Icons.RefreshCw className="w-3 h-3" /> 重置所有數據
                            </button>
                        </div>
                    </div>
                );
            };

            // 3. StatsBoard
            const StatsBoard = ({ history, confidence }) => {
                return (
                    <div className="bg-slate-800/30 border border-slate-700 rounded-xl p-6 h-full flex flex-col backdrop-blur-sm">
                        <h3 className="text-lg font-semibold text-white mb-6 flex items-center gap-2 border-b border-slate-700 pb-4">
                            <Icons.Shield className="w-5 h-5 text-emerald-400" />
                            驗證統計面板
                        </h3>

                        <div className="mb-8 space-y-4">
                            <div className="bg-slate-950/50 p-5 rounded-xl border border-slate-700/50 relative overflow-hidden group">
                                <div className="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                                    <Icons.Shield className="w-16 h-16 text-emerald-500" />
                                </div>
                                <div className="text-sm text-slate-400 mb-2">Peggy 誠實的機率 (信心水準)</div>
                                <div className="text-4xl font-mono font-bold text-emerald-400 tracking-tight">
                                    {(confidence * 100).toFixed(2)}%
                                </div>
                                <div className="text-xs text-slate-500 mt-3 flex items-center gap-2">
                                    <span className="bg-slate-800 px-2 py-1 rounded font-mono">1 - (1/2)^n</span>
                                    <span>n = 成功次數</span>
                                </div>
                            </div>

                            <div className="text-sm text-slate-400 leading-relaxed bg-blue-900/10 p-3 rounded-lg border border-blue-900/20">
                                <p>
                                    <span className="text-blue-400 font-bold">ZKP 核心概念：</span>
                                    即使 Peggy
                                    真的有鑰匙，你永遠沒看過鑰匙本身。你只是透過機率（她每次都能從正確出口出來）來確信她擁有鑰匙。
                                </p>
                            </div>
                        </div>

                        <div className="flex-1 overflow-hidden flex flex-col min-h-[200px]">
                            <h4 className="text-xs font-bold text-slate-500 uppercase tracking-wider mb-3 flex items-center justify-between">
                                <span>驗證紀錄 ({history.length})</span>
                                {history.length > 0 && (
                                    <span className="text-[10px] bg-slate-800 px-2 py-0.5 rounded-full text-slate-400">
                                        最新在前
                                    </span>
                                )}
                            </h4>

                            <div className="flex-1 overflow-y-auto pr-2 space-y-2 custom-scrollbar">
                                {history.length === 0 && (
                                    <div className="h-full flex flex-col items-center justify-center text-slate-600 text-sm border-2 border-dashed border-slate-800 rounded-lg">
                                        <p>尚無測試記錄</p>
                                        <p className="text-xs mt-1">請開始一個新的回合</p>
                                    </div>
                                )}
                                {[...history].reverse().map((round) => (
                                    <div
                                        key={round.roundNumber}
                                        className={`
                    relative flex items-center justify-between p-3 rounded-lg text-sm border transition-all
                    ${
                        round.success
                            ? "bg-emerald-900/10 border-emerald-900/30 hover:bg-emerald-900/20"
                            : "bg-red-900/10 border-red-900/30 hover:bg-red-900/20"
                    }
                  `}
                                    >
                                        <div className="flex items-center gap-4">
                                            <span className="text-slate-500 font-mono text-xs w-6">
                                                #{round.roundNumber}
                                            </span>
                                            <div className="flex flex-col gap-0.5">
                                                <div className="flex items-center gap-2 text-xs text-slate-400">
                                                    <span>
                                                        Peggy 位置:{" "}
                                                        <b
                                                            className={
                                                                round.peggyPath === "A"
                                                                    ? "text-sky-400"
                                                                    : "text-rose-400"
                                                            }
                                                        >
                                                            {round.peggyPath}
                                                        </b>
                                                    </span>
                                                    <Icons.ArrowRight className="w-3 h-3 opacity-50" />
                                                    <span>
                                                        Victor 要求:{" "}
                                                        <b
                                                            className={
                                                                round.victorCall === "A"
                                                                    ? "text-sky-400"
                                                                    : "text-rose-400"
                                                            }
                                                        >
                                                            {round.victorCall}
                                                        </b>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            {round.success ? (
                                                <Icons.CheckCircle2 className="w-5 h-5 text-emerald-500" />
                                            ) : (
                                                <Icons.XCircle className="w-5 h-5 text-red-500" />
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            };

            // 4. InfoSection
            const InfoSection = () => (
                <div className="grid md:grid-cols-3 gap-6 text-sm text-slate-400 mt-12 pb-12">
                    <div className="bg-slate-900 p-6 rounded-2xl border border-slate-800 hover:border-blue-500/30 transition-colors group">
                        <h4 className="text-blue-400 font-bold mb-3 text-base flex items-center gap-2">
                            <Icons.Unlock className="w-5 h-5 opacity-80 group-hover:opacity-100" />
                            什麼是零知識證明？
                        </h4>
                        <p className="leading-relaxed">
                            這是一種加密協議，允許一方（證明者）向另一方（驗證者）證明某個陳述是真實的， 而
                            <span className="text-slate-200 font-medium">無需透露除了「該陳述為真」以外的任何資訊</span>
                            。 在這個例子中，Peggy 證明她有鑰匙，但從未展示鑰匙。
                        </p>
                    </div>
                    <div className="bg-slate-900 p-6 rounded-2xl border border-slate-800 hover:border-purple-500/30 transition-colors group">
                        <h4 className="text-purple-400 font-bold mb-3 text-base flex items-center gap-2">
                            <Icons.RefreshCw className="w-5 h-5 opacity-80 group-hover:opacity-100" />
                            為什麼要重複測試？
                        </h4>
                        <p className="leading-relaxed">
                            如果 Peggy 是騙子，她只有 50% 的機率剛好選對路口來應付 Victor 的要求。
                            一次成功證明不了什麼，但連續 10 次猜對的機率僅為{" "}
                            <span className="font-mono text-purple-300">1/1024</span>。 ZKP 是基於機率的證明。
                        </p>
                    </div>
                    <div className="bg-slate-900 p-6 rounded-2xl border border-slate-800 hover:border-emerald-500/30 transition-colors group">
                        <h4 className="text-emerald-400 font-bold mb-3 text-base flex items-center gap-2">
                            <Icons.Shield className="w-5 h-5 opacity-80 group-hover:opacity-100" />
                            實際應用在哪裡？
                        </h4>
                        <p className="leading-relaxed">
                            區塊鏈隱私交易（如 Zcash）、身份驗證（無需傳輸密碼即可登入）、
                            以及擴容方案（ZK-Rollups）都使用了這個原理。它保護了隱私，同時確保了數據的正確性。
                        </p>
                    </div>
                </div>
            );

            // 5. Main App
            const App = () => {
                const [step, setStep] = useState(GameStep.IDLE);
                const [hasKey, setHasKey] = useState(true);
                const [peggyPath, setPeggyPath] = useState(null);
                const [victorCall, setVictorCall] = useState(null);
                const [history, setHistory] = useState([]);
                const [confidence, setConfidence] = useState(0);

                useEffect(() => {
                    const successCount = history.filter((h) => h.success).length;
                    setConfidence(successCount === 0 ? 0 : 1 - Math.pow(0.5, successCount));
                }, [history]);

                const handleStartRound = useCallback(() => {
                    setStep(GameStep.ENTERING);
                    setVictorCall(null);

                    const randomPath = Math.random() > 0.5 ? "A" : "B";
                    setPeggyPath(randomPath);

                    setTimeout(() => {
                        setStep(GameStep.HIDDEN);
                        setTimeout(() => setStep(GameStep.CHALLENGE), 800);
                    }, 1200);
                }, []);

                const handleChallenge = useCallback(
                    (calledPath) => {
                        setVictorCall(calledPath);
                        setStep(GameStep.EXITING);

                        setTimeout(() => {
                            let success = false;

                            if (hasKey) {
                                success = true;
                            } else {
                                success = peggyPath === calledPath;
                            }

                            const newRecord = {
                                roundNumber: history.length + 1,
                                peggyPath: peggyPath,
                                victorCall: calledPath,
                                hasKey: hasKey,
                                success: success,
                            };

                            setHistory((prev) => [...prev, newRecord]);
                            setStep(GameStep.RESULT);
                        }, 1500);
                    },
                    [hasKey, peggyPath, history]
                );

                const handleReset = () => {
                    setHistory([]);
                    setStep(GameStep.IDLE);
                    setPeggyPath(null);
                    setVictorCall(null);
                    setConfidence(0);
                };

                return (
                    <div className="min-h-screen p-4 md:p-8 selection:bg-blue-500/30">
                        <div className="max-w-6xl mx-auto">
                            <header className="mb-10 text-center space-y-4">
                                <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-900 border border-slate-800 text-xs text-slate-400 mb-2">
                                    <span className="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></span>
                                    Interactive ZKP Demo (Single File)
                                </div>
                                <h1 className="text-4xl md:text-6xl font-black bg-gradient-to-r from-blue-400 via-purple-400 to-emerald-400 bg-clip-text text-transparent drop-shadow-sm">
                                    零知識證明實驗室
                                </h1>
                                <p className="text-slate-400 max-w-2xl mx-auto text-lg font-light">
                                    透過經典的「阿里巴巴洞穴」寓言，親身體驗如何在
                                    <b className="text-slate-200">不洩漏秘密</b>的情況下證明你擁有秘密。
                                </p>
                            </header>

                            <main className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                                <div className="lg:col-span-7 space-y-6">
                                    <CaveVisualizer step={step} peggyPath={peggyPath} victorCall={victorCall} />
                                    <ControlPanel
                                        step={step}
                                        hasKey={hasKey}
                                        setHasKey={setHasKey}
                                        onStartRound={handleStartRound}
                                        onChallenge={handleChallenge}
                                        onReset={handleReset}
                                    />
                                </div>

                                <div className="lg:col-span-5 h-full min-h-[500px]">
                                    <StatsBoard history={history} confidence={confidence} />
                                </div>
                            </main>

                            <InfoSection />

                            <footer className="text-center text-slate-600 text-sm pb-8">
                                <p>© 2024 Interactive ZKP Explainer. Single HTML File.</p>
                            </footer>
                        </div>
                    </div>
                );
            };

            const root = ReactDOM.createRoot(document.getElementById("root"));
            root.render(<App />);
        </script>
    </body>
</html>
