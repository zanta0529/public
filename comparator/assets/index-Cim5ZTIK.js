(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();class m{calculateUnitPrice(e,t){if(typeof e!="number"||typeof t!="number"||!isFinite(e)||!isFinite(t)||e<=0||t<=0)return null;const r=e/t;return r<Number.EPSILON?null:r}compare(e,t,r,s){const i=this.calculateUnitPrice(e,t),l=this.calculateUnitPrice(r,s);let c=null;if(i!==null&&l!==null){const o=i-l;Math.abs(o)<1e-10?c="tie":o<0?c="A":c="B"}else i!==null?c="A":l!==null&&(c="B");return{unitPriceA:i,unitPriceB:l,bestBuy:c}}}class p{constructor(e){this.comparator=e,this.elements={},this.selectElements()}selectElements(){const e=["priceA","unitA","priceB","unitB","resultA","resultB","cardA","cardB","resetBtn","iconA","iconB"];this.elements=Object.fromEntries(e.map(r=>[r,document.getElementById(r)]));const t=e.filter(r=>!this.elements[r]);t.length>0&&console.error("ç¼ºå°‘å¿…è¦çš„ DOM å…ƒç´ :",t)}init(){[this.elements.priceA,this.elements.unitA,this.elements.priceB,this.elements.unitB].forEach(t=>{t.addEventListener("input",this.handleInput.bind(this))}),this.elements.resetBtn.addEventListener("click",this.resetAll.bind(this))}parseInputValues(){return{priceA:parseFloat(this.elements.priceA.value)||0,unitA:parseFloat(this.elements.unitA.value)||0,priceB:parseFloat(this.elements.priceB.value)||0,unitB:parseFloat(this.elements.unitB.value)||0}}handleInput(){const{priceA:e,unitA:t,priceB:r,unitB:s}=this.parseInputValues(),i=this.comparator.compare(e,t,r,s);this.updateView(i)}updateView(e){const{unitPriceA:t,unitPriceB:r,bestBuy:s}=e,{resultA:i,resultB:l,cardA:c,cardB:d,iconA:o,iconB:h}=this.elements,n={resultA:this.formatUnitPrice(t),resultB:this.formatUnitPrice(r),cardAClasses:{add:[],remove:["best-buy","worst-buy"]},cardBClasses:{add:[],remove:["best-buy","worst-buy"]},iconAText:"",iconBText:""};switch(s){case"A":n.cardAClasses.add.push("best-buy"),n.cardBClasses.add.push("worst-buy"),n.iconAText="âœ”",n.iconBText="âœ–";break;case"B":n.cardBClasses.add.push("best-buy"),n.cardAClasses.add.push("worst-buy"),n.iconBText="âœ”",n.iconAText="âœ–";break;case"tie":t!==null&&r!==null&&(n.cardAClasses.add.push("best-buy"),n.cardBClasses.add.push("best-buy"),n.iconAText="âœ”",n.iconBText="âœ”");break}requestAnimationFrame(()=>{i.textContent=n.resultA,l.textContent=n.resultB,o.textContent=n.iconAText,h.textContent=n.iconBText,c.classList.remove(...n.cardAClasses.remove),d.classList.remove(...n.cardBClasses.remove),n.cardAClasses.add.length&&c.classList.add(...n.cardAClasses.add),n.cardBClasses.add.length&&d.classList.add(...n.cardBClasses.add)})}formatUnitPrice(e){return e===null||!isFinite(e)?"--":e.toFixed(3)}resetAll(){this.elements.priceA.value="",this.elements.unitA.value="",this.elements.priceB.value="",this.elements.unitB.value="",this.handleInput()}}class u{static THEMES={dark:{icon:"â˜€ï¸",title:"åˆ‡æ›è‡³æ·ºè‰²ä¸»é¡Œ",next:"light"},light:{icon:"ðŸŒ™",title:"åˆ‡æ›è‡³æ·±è‰²ä¸»é¡Œ",next:"dark"}};constructor(e){this.toggleButton=e,this.currentTheme=this.loadTheme(),this.apply()}loadTheme(){try{const e=localStorage.getItem("theme");if(e==="dark"||e==="light")return e}catch(e){console.warn("ç„¡æ³•è®€å–ä¸»é¡Œè¨­å®š:",e)}return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,"dark"}apply(){const e=u.THEMES[this.currentTheme];document.documentElement.setAttribute("data-theme",this.currentTheme),this.toggleButton.textContent=e.icon,this.toggleButton.title=e.title}saveTheme(e){try{localStorage.setItem("theme",e)}catch(t){console.warn("ç„¡æ³•å„²å­˜ä¸»é¡Œè¨­å®š:",t)}}init(){this.toggleButton.addEventListener("click",this.toggleTheme.bind(this))}toggleTheme(){const e=u.THEMES[this.currentTheme];this.currentTheme=e.next,this.apply(),this.saveTheme(this.currentTheme)}}document.addEventListener("DOMContentLoaded",()=>{const a=new m;new p(a).init();const t=document.getElementById("themeToggleBtn");t&&new u(t).init();const r=document.getElementById("currentYear");r&&(r.textContent=new Date().getFullYear())});
